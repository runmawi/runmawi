"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t,e){"object"===("undefined"==typeof module?"undefined":_typeof(module))&&"object"===_typeof(module.exports)?module.exports=e(t,document):"function"==typeof define&&define.amd?define([],function(){return e(t,document)}):t.plyrAds=e(t,document)}("undefined"!=typeof window?window:void 0,function(t,e){function n(e,n){var i=this;if(this.adsManager,this.adsLoader,this.adDuration,this.intervalTimer,this.plyr=e,this.options=n,this.plyrContainer=e.getContainer(),this.adPaused=!1,this.skipAdButton,this.adDisplayContainer,!t.google)throw new Error("The Google IMA3 SDK is not loaded.");return this.init=function(){if(!i.options.adTagUrl)throw Error("No adTagUrl provided.");i.createAdDisplayContainer(),i.setUpIMA()},this.playAds=function(){i.adDisplayContainer.initialize(),i.adsManager.init(i.plyrContainer.offsetWidth,i.plyrContainer.offsetHeight,t.google.ima.ViewMode.NORMAL),i.adsManager.start()},this.playVideo=function(){i.skipAdButton&&i.skipAdButton.remove(),i.plyrContainer.firstChild.remove(),"youtube"===i.plyr.getType()&&navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/Android/i)?i.plyr.getEmbed().playVideoAt(0):i.plyr.play()},{init:this.init}}function i(){this.adDisplayContainer=new t.google.ima.AdDisplayContainer(this.plyrContainer),this.plyrContainer.firstChild.setAttribute("class","plyr-ads"),this.toggleListener(this.plyrContainer.firstChild,this.playAds)}function o(){var e=this.options.skipButton.delay;if(this.skipAdButton=s("button",this.plyrContainer,{class:"plyr-ads__skip-button"}),this.options.skipButton.delay>0){this.skipAdButton.innerHTML="You can skip to video in "+e--;var n=t.setInterval(function(){this.adPaused||(this.skipAdButton.innerHTML="You can skip to video in "+e--),e+1!==0&&0!==this.options.skipButton.delay||(this.skipAdButton.className+=" done",this.skipAdButton.innerHTML=this.options.skipButton.text,this.toggleListener(this.skipAdButton,this.playVideo),t.clearInterval(n))}.bind(this),1e3)}else this.skipAdButton.className+=" done",this.skipAdButton.innerHTML=this.options.skipButton.text,this.toggleListener(this.skipAdButton,this.playVideo)}function r(t,e){return t.insertBefore(e,t.firstChild)}function a(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.setAttribute(n,E.boolean(e[n])&&e[n]?"":e[n])}function s(t,n,i){var o=e.createElement(t);return a(o,i),r(n,o)}function d(){this.adsLoader=new t.google.ima.AdsLoader(this.adDisplayContainer),this.adsLoader.addEventListener(t.google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,function(t){this.onAdsManagerLoaded(t)}.bind(this),!1),this.adsLoader.addEventListener(t.google.ima.AdErrorEvent.Type.AD_ERROR,function(t){this.plyrContainer.firstChild.remove()}.bind(this),!1);var e=new t.google.ima.AdsRequest;e.adTagUrl=this.options.adTagUrl,this.adsLoader.requestAds(e)}function u(e){var n=new t.google.ima.AdsRenderingSettings;n.restoreCustomPlaybackStateOnAdBreakComplete=!0,this.adsManager=e.getAdsManager(n),this.adsManager.addEventListener(t.google.ima.AdErrorEvent.Type.AD_ERROR,function(t){this.onAdError(t)}.bind(this)),this.adsManager.addEventListener(t.google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,function(t){this.onContentResumeRequested(t)}.bind(this)),this.adsManager.addEventListener(t.google.ima.AdEvent.Type.SKIPPABLE_STATE_CHANGED,function(t){this.onContentSkippable(t)}.bind(this)),this.adsManager.addEventListener(t.google.ima.AdEvent.Type.ALL_ADS_COMPLETED,function(t){this.onAdEvent(t)}.bind(this)),this.adsManager.addEventListener(t.google.ima.AdEvent.Type.LOADED,function(t){this.onAdEvent(t)}.bind(this)),this.adsManager.addEventListener(t.google.ima.AdEvent.Type.STARTED,function(t){this.onAdEvent(t)}.bind(this)),this.adsManager.addEventListener(t.google.ima.AdEvent.Type.PAUSED,function(t){this.onAdEvent(t)}.bind(this)),this.adsManager.addEventListener(t.google.ima.AdEvent.Type.RESUMED,function(t){this.onAdEvent(t)}.bind(this)),this.adsManager.addEventListener(t.google.ima.AdEvent.Type.COMPLETE,function(t){this.onAdEvent(t)}.bind(this)),t.addEventListener("resize",function(){this.adsManager.resize(this.plyrContainer.offsetWidth,this.plyrContainer.offsetHeight,t.google.ima.ViewMode.NORMAL)}.bind(this))}function l(e){var n=e.getAd();switch(e.type){case t.google.ima.AdEvent.Type.LOADED:n.isLinear()||this.playVideo();break;case t.google.ima.AdEvent.Type.STARTED:n.isLinear()&&(n.g.duration>15||0===this.options.skipButton.delay)&&this.createAdSkipButton();break;case t.google.ima.AdEvent.Type.PAUSED:n.isLinear()&&(this.adPaused=!0);break;case t.google.ima.AdEvent.Type.RESUMED:n.isLinear()&&(this.adPaused=!1);break;case t.google.ima.AdEvent.Type.COMPLETE:this.playVideo(),n.isLinear()&&clearInterval(this.intervalTimer)}}function p(t){throw this.adsManager.destroy(),this.playVideo(),new Error(t.getError())}function h(){this.playVideo()}function c(){this.plyrAdSkipButton.style.display="block"}function y(){var t=arguments;if(t.length){if(1===t.length)return t[0];for(var e=Array.prototype.shift.call(t),n=t.length,i=0;i<n;i++){var o=t[i];for(var r in o)o[r]&&o[r].constructor&&o[r].constructor===Object?(e[r]=e[r]||{},y(e[r],o[r])):e[r]=o[r]}return e}}function f(t,e){var n=void 0,i=function i(o){("touchend"===o.type&&"touchstart"===n||"click"===o.type)&&e(),n=o.type,t.removeEventListener(o.type,i)},o=!0,r=!1,a=void 0;try{for(var s,d=g()[Symbol.iterator]();!(o=(s=d.next()).done);o=!0){var u=s.value;t.addEventListener(u,i,!1)}}catch(t){r=!0,a=t}finally{try{!o&&d.return&&d.return()}finally{if(r)throw a}}}function g(){var t=["click"];return(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/Android/i))&&(t=["touchstart","touchend","touchmove"]),t}function A(e,i){if(!t.plyr||!e)return!1;var o=y({},v,i);return e.forEach(function(t){if("audio"!==t.getType()){new n(t,o).init()}}),!1}var v={adTagUrl:"",skipButton:{enabled:!0,text:"Skip ad",delay:10}},E={object:function(t){return null!==t&&"object"===(void 0===t?"undefined":_typeof(t))},array:function(t){return null!==t&&"object"===(void 0===t?"undefined":_typeof(t))&&t.constructor===Array},number:function(t){return null!==t&&("number"==typeof t&&!isNaN(t-0)||"object"===(void 0===t?"undefined":_typeof(t))&&t.constructor===Number)},string:function(t){return null!==t&&("string"==typeof t||"object"===(void 0===t?"undefined":_typeof(t))&&t.constructor===String)},boolean:function(t){return null!==t&&"boolean"==typeof t},nodeList:function(t){return null!==t&&t instanceof NodeList},htmlElement:function(t){return null!==t&&t instanceof HTMLElement},function:function(t){return null!==t&&"function"==typeof t},undefined:function(t){return null!==t&&void 0===t}};return n.prototype.setUpIMA=d,n.prototype.createAdDisplayContainer=i,n.prototype.createAdSkipButton=o,n.prototype.onAdEvent=l,n.prototype.onAdError=p,n.prototype.onAdsManagerLoaded=u,n.prototype.onContentResumeRequested=h,n.prototype.onContentSkippable=c,n.prototype.toggleListener=f,{setup:A}});