!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;(t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Hls=e()}}(function(){var e;return(function e(t,r,i){function a(s,o){if(!r[s]){if(!t[s]){var l="function"==typeof require&&require;if(!o&&l)return l(s,!0);if(n)return n(s,!0);var u=Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var d=r[s]={exports:{}};t[s][0].call(d.exports,function(e){var r;return a(t[s][1][e]||e)},d,d.exports,e,t,r,i)}return r[s].exports}for(var n="function"==typeof require&&require,s=0;s<i.length;s++)a(i[s]);return a})({1:[function(e,t,r){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function a(e){return"function"==typeof e}function n(e){return"object"==typeof e&&null!==e}function s(e){return void 0===e}t.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(e){var t;if(t=e,"number"!=typeof t||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},i.prototype.emit=function(e){var t,r,i,o,l,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||n(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;var d=Error('Uncaught, unspecified "error" event. ('+t+")");throw d.context=t,d}if(s(r=this._events[e]))return!1;if(a(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),r.apply(this,o)}else if(n(r))for(l=0,o=Array.prototype.slice.call(arguments,1),i=(u=r.slice()).length;l<i;l++)u[l].apply(this,o);return!0},i.prototype.addListener=function(e,t){var r;if(!a(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,a(t.listener)?t.listener:t),this._events[e]?n(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,n(this._events[e])&&!this._events[e].warned&&(r=s(this._maxListeners)?i.defaultMaxListeners:this._maxListeners)&&r>0&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(e,t){if(!a(t))throw TypeError("listener must be a function");var r=!1;function i(){this.removeListener(e,i),r||(r=!0,t.apply(this,arguments))}return i.listener=t,this.on(e,i),this},i.prototype.removeListener=function(e,t){var r,i,s,o;if(!a(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(s=(r=this._events[e]).length,i=-1,r===t||a(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(n(r)){for(o=s;o-- >0;)if(r[o]===t||r[o].listener&&r[o].listener===t){i=o;break}if(i<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},i.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(a(r=this._events[e]))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},i.prototype.listeners=function(e){var t;return this._events&&this._events[e]?a(this._events[e])?[this._events[e]]:this._events[e].slice():[]},i.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(a(t))return 1;if(t)return t.length}return 0},i.listenerCount=function(e,t){return e.listenerCount(t)}},{}],2:[function(t,r,i){var a,n,s,o,l,u;a=this,n=/^((?:[^\/;?#]+:)?)(\/\/[^\/\;?#]*)?(.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,s=/^([^\/;?#]*)(.*)$/,o=/(?:\/|^)\.(?=\/)/g,l=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,u={buildAbsoluteURL:function(e,t,r){if(r=r||{},e=e.trim(),!(t=t.trim())){if(!r.alwaysNormalize)return e;var i=this.parseURL(e);if(!n)throw Error("Error trying to parse base URL.");return i.path=u.normalizePath(i.path),u.buildURLFromParts(i)}var a=this.parseURL(t);if(!a)throw Error("Error trying to parse relative URL.");if(a.scheme)return r.alwaysNormalize?(a.path=u.normalizePath(a.path),u.buildURLFromParts(a)):t;var n=this.parseURL(e);if(!n)throw Error("Error trying to parse base URL.");if(!n.netLoc&&n.path&&"/"!==n.path[0]){var o=s.exec(n.path);n.netLoc=o[1],n.path=o[2]}n.netLoc&&!n.path&&(n.path="/");var l={scheme:n.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};if(!a.netLoc&&(l.netLoc=n.netLoc,"/"!==a.path[0])){if(a.path){var d=n.path,f=d.substring(0,d.lastIndexOf("/")+1)+a.path;l.path=u.normalizePath(f)}else l.path=n.path,a.params||(l.params=n.params,a.query||(l.query=n.query))}return null===l.path&&(l.path=r.alwaysNormalize?u.normalizePath(a.path):a.path),u.buildURLFromParts(l)},parseURL:function(e){var t=n.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(o,"");e.length!==(e=e.replace(l,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},"object"==typeof i&&"object"==typeof r?r.exports=u:"function"==typeof e&&e.amd?e([],function(){return u}):"object"==typeof i?i.URLToolkit=u:a.URLToolkit=u},{}],3:[function(e,t,r){var i=arguments[3],a=arguments[4],n=arguments[5],s=JSON.stringify;t.exports=function(e,t){for(var r,o=Object.keys(n),l=0,u=o.length;l<u;l++){var d=o[l],f=n[d].exports;if(f===e||f&&f.default===e){r=d;break}}if(!r){r=Math.floor(4294967296*Math.random()).toString(16);for(var $={},l=0,u=o.length;l<u;l++){var d=o[l];$[d]=d}a[r]=[Function(["require","module","exports"],"("+e+")(self)"),$]}var c=Math.floor(4294967296*Math.random()).toString(16),h={};h[r]=r,a[c]=[Function(["require"],"var f = require("+s(r)+");(f.default ? f.default : f)(self);"),h];var g={};!function e(t){for(var r in g[t]=!0,a[t][1]){var i=a[t][1][r];g[i]||e(i)}}(c);var v="("+i+")({"+Object.keys(g).map(function(e){return s(e)+":["+a[e][0]+","+s(a[e][1])+"]"}).join(",")+"},{},["+s(c)+"])",p=window.URL||window.webkitURL||window.mozURL||window.msURL,x=new Blob([v],{type:"text/javascript"});if(t&&t.bare)return x;var y=p.createObjectURL(x),m=new Worker(y);return m.objectURL=y,m}},{}],4:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.hlsDefaultConfig=void 0;var i=e(5),a=k(i),n=e(8),s=k(n),o=e(9),l=k(o),u=e(10),d=k(u),f=e(56),$=k(f),c=e(7),h=k(c),g=e(6),v=k(g),p=e(48),x=k(p),y=e(16),m=k(y),_=e(15),E=k(_),T=e(14),b=k(T);function k(e){return e&&e.__esModule?e:{default:e}}r.hlsDefaultConfig={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,maxSeekHole:2,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.2,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,fragLoadingLoopThreshold:3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:$.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,fetchSetup:void 0,abrController:a.default,bufferController:s.default,capLevelController:l.default,fpsController:d.default,audioStreamController:v.default,audioTrackController:h.default,subtitleStreamController:b.default,subtitleTrackController:E.default,timelineController:m.default,cueHandler:x.default,enableCEA708Captions:!0,enableWebVTT:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",stretchShortVideoTrack:!1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0}},{10:10,14:14,15:15,16:16,48:48,5:5,56:56,6:6,7:7,8:8,9:9}],5:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=e(33),n=h(a),s=e(32),o=h(s),l=e(35),u=h(l),d=e(31),f=e(51),$=e(49),c=h($);function h(e){return e&&e.__esModule?e:{default:e}}var g=function(e){function t(e){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var r=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n.default.FRAG_LOADING,n.default.FRAG_LOADED,n.default.FRAG_BUFFERED,n.default.ERROR));return r.lastLoadedFragLevel=0,r._nextAutoLevel=-1,r.hls=e,r.onCheck=r._abandonRulesCheck.bind(r),r}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),i(t,[{key:"destroy",value:function e(){this.clearTimer(),o.default.prototype.destroy.call(this)}},{key:"onFragLoading",value:function e(t){var r=t.frag;if("main"===r.type){if(this.timer||(this.timer=setInterval(this.onCheck,100)),!this._bwEstimator){var i=this.hls,a=t.frag.level,n=i.levels[a].details.live,s=i.config,o=void 0,l=void 0;n?(o=s.abrEwmaFastLive,l=s.abrEwmaSlowLive):(o=s.abrEwmaFastVoD,l=s.abrEwmaSlowVoD),this._bwEstimator=new c.default(i,l,o,s.abrEwmaDefaultEstimate)}this.fragCurrent=r}}},{key:"_abandonRulesCheck",value:function e(){var t=this.hls,r=t.media,i=this.fragCurrent,a=i.loader,s=t.minAutoLevel;if(!a||a.stats&&a.stats.aborted){f.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer();return}var o=a.stats;if(r&&(!r.paused&&0!==r.playbackRate||!r.readyState)&&i.autoLevel&&i.level){var l=performance.now()-o.trequest,d=Math.abs(r.playbackRate);if(l>500*i.duration/d){var $=t.levels,c=Math.max(1,o.bw?o.bw/8:1e3*o.loaded/l),h=$[i.level],g=h.realBitrate?Math.max(h.realBitrate,h.bitrate):h.bitrate,v=o.total?o.total:Math.max(o.loaded,Math.round(i.duration*g/8)),p=r.currentTime,x=(v-o.loaded)/c,y=(u.default.bufferInfo(r,p,t.config.maxBufferHole).end-p)/d;if(y<2*i.duration/d&&x>y){var m=void 0,_=void 0;for(_=i.level-1;_>s;_--){var E=$[_].realBitrate?Math.max($[_].realBitrate,$[_].bitrate):$[_].bitrate;if((m=i.duration*E/(6.4*c))<y)break}m<x&&(f.logger.warn("loading too slow, abort fragment loading and switch to level "+_+":fragLoadedDelay["+_+"]<fragLoadedDelay["+(i.level-1)+"];bufferStarvationDelay:"+m.toFixed(1)+"<"+x.toFixed(1)+":"+y.toFixed(1)),t.nextLoadLevel=_,this._bwEstimator.sample(l,o.loaded),a.abort(),this.clearTimer(),t.trigger(n.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:i,stats:o}))}}}}},{key:"onFragLoaded",value:function e(t){var r=t.frag;if("main"===r.type&&!isNaN(r.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=r.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var i=this.hls.levels[r.level],a=(i.loaded?i.loaded.bytes:0)+t.stats.loaded,n=(i.loaded?i.loaded.duration:0)+t.frag.duration;i.loaded={bytes:a,duration:n},i.realBitrate=Math.round(8*a/n)}if(t.frag.bitrateTest){var s=t.stats;s.tparsed=s.tbuffered=s.tload,this.onFragBuffered(t)}}}},{key:"onFragBuffered",value:function e(t){var r=t.stats,i=t.frag;if(!0!==r.aborted&&1===i.loadCounter&&"main"===i.type&&!isNaN(i.sn)&&(!i.bitrateTest||r.tload===r.tbuffered)){var a=r.tparsed-r.trequest;f.logger.log("latency/loading/parsing/append/kbps:"+Math.round(r.tfirst-r.trequest)+"/"+Math.round(r.tload-r.tfirst)+"/"+Math.round(r.tparsed-r.tload)+"/"+Math.round(r.tbuffered-r.tparsed)+"/"+Math.round(8*r.loaded/(r.tbuffered-r.trequest))),this._bwEstimator.sample(a,r.loaded),r.bwEstimate=this._bwEstimator.getEstimate(),i.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}}},{key:"onError",value:function e(t){switch(t.details){case d.ErrorDetails.FRAG_LOAD_ERROR:case d.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}}},{key:"clearTimer",value:function e(){this.timer&&(clearInterval(this.timer),this.timer=null)}},{key:"_findBestLevel",value:function e(t,r,i,a,n,s,o,l,u){for(var d=n;d>=a;d--){var $=u[d].details,c=$?$.totalduration/$.fragments.length:r,h=!!$&&$.live,g=void 0;g=d<=t?o*i:l*i;var v=u[d].realBitrate?Math.max(u[d].realBitrate,u[d].bitrate):u[d].bitrate,p=v*c/g;if(f.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+d+"/"+Math.round(g)+"/"+v+"/"+c+"/"+s+"/"+p),g>v&&(!p||h||p<s))return d}return -1}},{key:"nextAutoLevel",get:function e(){var t=this._nextAutoLevel,r=this._bwEstimator;if(-1!==t&&(!r||!r.canEstimate()))return t;var i=this._nextABRAutoLevel;return -1!==t&&(i=Math.min(t,i)),i},set:function e(t){this._nextAutoLevel=t}},{key:"_nextABRAutoLevel",get:function e(){var t=this.hls,r=t.maxAutoLevel,i=t.levels,a=t.config,n=t.minAutoLevel,s=t.media,o=this.lastLoadedFragLevel,l=this.fragCurrent?this.fragCurrent.duration:0,d=s?s.currentTime:0,$=s&&0!==s.playbackRate?Math.abs(s.playbackRate):1,c=this._bwEstimator?this._bwEstimator.getEstimate():a.abrEwmaDefaultEstimate,h=(u.default.bufferInfo(s,d,a.maxBufferHole).end-d)/$,g=this._findBestLevel(o,l,c,n,r,h,a.abrBandWidthFactor,a.abrBandWidthUpFactor,i);if(g>=0)return g;f.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var v=l?Math.min(l,a.maxStarvationDelay):a.maxStarvationDelay,p=a.abrBandWidthFactor,x=a.abrBandWidthUpFactor;if(0===h){var y=this.bitrateTestDelay;y&&(v=(l?Math.min(l,a.maxLoadingDelay):a.maxLoadingDelay)-y,f.logger.trace("bitrate test took "+Math.round(1e3*y)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*v)+" ms"),p=x=1)}return Math.max(g=this._findBestLevel(o,l,c,n,r,h+v,p,x,i),0)}}]),t}(o.default);r.default=g},{31:31,32:32,33:33,35:35,49:49,51:51}],6:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=e(46),n=m(a),s=e(35),o=m(s),l=e(25),u=m(l),d=e(33),f=m(d),$=e(32),c=m($),h=e(36),g=m(h),v=e(52),p=m(v),x=e(31),y=e(51);function m(e){return e&&e.__esModule?e:{default:e}}var _={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS"},E=function(e){function t(e){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var r=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,f.default.MEDIA_ATTACHED,f.default.MEDIA_DETACHING,f.default.AUDIO_TRACKS_UPDATED,f.default.AUDIO_TRACK_SWITCHING,f.default.AUDIO_TRACK_LOADED,f.default.KEY_LOADED,f.default.FRAG_LOADED,f.default.FRAG_PARSING_INIT_SEGMENT,f.default.FRAG_PARSING_DATA,f.default.FRAG_PARSED,f.default.ERROR,f.default.BUFFER_CREATED,f.default.BUFFER_APPENDED,f.default.BUFFER_FLUSHED,f.default.INIT_PTS_FOUND));return r.config=e.config,r.audioCodecSwap=!1,r.ticks=0,r._state=_.STOPPED,r.ontick=r.tick.bind(r),r.initPTS=[],r.waitingFragment=null,r}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),i(t,[{key:"destroy",value:function e(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),c.default.prototype.destroy.call(this),this.state=_.STOPPED}},{key:"onInitPtsFound",value:function e(t){var r=t.id,i=t.frag.cc,a=t.initPTS;"main"===r&&(this.initPTS[i]=a,y.logger.log("InitPTS for cc:"+i+" found from video track:"+a),this.state===_.WAITING_INIT_PTS&&(y.logger.log("sending pending audio frag to demuxer"),this.state=_.FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null))}},{key:"startLoad",value:function e(t){if(this.tracks){var r=this.lastCurrentTime;this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.fragLoadError=0,r>0&&-1===t?(y.logger.log("audio:override startPosition with lastCurrentTime @"+r.toFixed(3)),this.state=_.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:t,this.state=_.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=t,this.state=_.STOPPED}},{key:"stopLoad",value:function e(){var t=this.fragCurrent;t&&(t.loader&&t.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=_.STOPPED}},{key:"tick",value:function e(){this.ticks++,1===this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function e(){var t,r,i,a=this.hls,s=a.config;switch(this.state){case _.ERROR:case _.PAUSED:case _.BUFFER_FLUSHING:break;case _.STARTING:this.state=_.WAITING_TRACK,this.loadedmetadata=!1;break;case _.IDLE:var l=this.tracks;if(!l||!this.media&&(this.startFragRequested||!s.startFragPrefetch))break;t=this.loadedmetadata?this.media.currentTime:this.nextLoadPosition;var u=this.mediaBuffer?this.mediaBuffer:this.media,d=o.default.bufferInfo(u,t,s.maxBufferHole),$=d.len,c=d.end,h=this.fragPrevious,g=s.maxMaxBufferLength,v=this.audioSwitch,p=this.trackId;if(($<g||v)&&p<l.length){if(void 0===(i=l[p].details)){this.state=_.WAITING_TRACK;break}if(!v&&!i.live&&h&&h.sn===i.endSN&&(!this.media.seeking||this.media.duration-c<h.duration/2)){this.hls.trigger(f.default.BUFFER_EOS,{type:"audio"}),this.state=_.ENDED;break}var m=i.fragments,E=m.length,T=m[0].start,b=m[E-1].start+m[E-1].duration,k=void 0;if(v){if(i.live&&!i.PTSKnown)y.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment"),c=0;else if(c=t,i.PTSKnown&&t<T){if(!(d.end>T)&&!d.nextStart)return;y.logger.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=T+.05}}if(i.initSegment&&!i.initSegment.data)k=i.initSegment;else if(c<=T){if(k=m[0],i.live&&k.loadIdx&&k.loadIdx===this.fragLoadIdx){var R=d.nextStart?d.nextStart:T;y.logger.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(R+.05)),this.media.currentTime=R+.05;return}}else{var S=void 0,A=s.maxFragLookUpTolerance,L=h?m[h.sn-m[0].sn+1]:void 0,D=function e(t){var r=Math.min(A,t.duration);return t.start+t.duration-r<=c?1:t.start-r>c&&t.start?-1:0};c<b?(c>b-A&&(A=0),S=L&&!D(L)?L:n.default.search(m,D)):S=m[E-1],S&&(k=S,T=S.start,h&&k.level===h.level&&k.sn===h.sn&&(k.sn<i.endSN?(k=m[k.sn+1-i.startSN],y.logger.log("SN just loaded, load next one: "+k.sn)):k=null))}if(k){if(k.decryptdata&&null!=k.decryptdata.uri&&null==k.decryptdata.key)y.logger.log("Loading key for "+k.sn+" of ["+i.startSN+" ,"+i.endSN+"],track "+p),this.state=_.KEY_LOADING,a.trigger(f.default.KEY_LOADING,{frag:k});else{if(y.logger.log("Loading "+k.sn+" of ["+i.startSN+" ,"+i.endSN+"],track "+p+", currentTime:"+t+",bufferEnd:"+c.toFixed(3)),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,k.loadCounter){k.loadCounter++;var F=s.fragLoadingLoopThreshold;if(k.loadCounter>F&&Math.abs(this.fragLoadIdx-k.loadIdx)<F){a.trigger(f.default.ERROR,{type:x.ErrorTypes.MEDIA_ERROR,details:x.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:k});return}}else k.loadCounter=1;k.loadIdx=this.fragLoadIdx,this.fragCurrent=k,this.startFragRequested=!0,isNaN(k.sn)||(this.nextLoadPosition=k.start+k.duration),a.trigger(f.default.FRAG_LOADING,{frag:k}),this.state=_.FRAG_LOADING}}}break;case _.WAITING_TRACK:(r=this.tracks[this.trackId])&&r.details&&(this.state=_.IDLE);break;case _.FRAG_LOADING_WAITING_RETRY:var w=performance.now(),I=this.retryDate,P=(u=this.media)&&u.seeking;(!I||w>=I||P)&&(y.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=_.IDLE);case _.WAITING_INIT_PTS:case _.STOPPED:case _.FRAG_LOADING:case _.PARSING:case _.PARSED:case _.ENDED:}}},{key:"onMediaAttached",value:function e(t){var r=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),r.addEventListener("seeking",this.onvseeking),r.addEventListener("ended",this.onvended);var i=this.config;this.tracks&&i.autoStartLoad&&this.startLoad(i.startPosition)}},{key:"onMediaDetaching",value:function e(){var t=this.media;t&&t.ended&&(y.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var r=this.tracks;r&&r.forEach(function(e){e.details&&e.details.fragments.forEach(function(e){e.loadCounter=void 0})}),t&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onMediaSeeking",value:function e(){this.state===_.ENDED&&(this.state=_.IDLE),this.media&&(this.lastCurrentTime=this.media.currentTime),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.tick()}},{key:"onMediaEnded",value:function e(){this.startPosition=this.lastCurrentTime=0}},{key:"onAudioTracksUpdated",value:function e(t){y.logger.log("audio tracks updated"),this.tracks=t.audioTracks}},{key:"onAudioTrackSwitching",value:function e(t){var r=!!t.url;this.trackId=t.id,this.state=_.IDLE,this.fragCurrent=null,this.state=_.PAUSED,this.waitingFragment=null,r?this.timer||(this.timer=setInterval(this.ontick,100)):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),r&&(this.audioSwitch=!0,this.state=_.IDLE,void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold)),this.tick()}},{key:"onAudioTrackLoaded",value:function e(t){var r=t.details,i=t.id,a=this.tracks[i],n=r.totalduration,s=0;if(y.logger.log("track "+i+" loaded ["+r.startSN+","+r.endSN+"],duration:"+n),r.live){var o=a.details;o&&r.fragments.length>0?(g.default.mergeDetails(o,r),s=r.fragments[0].start,r.PTSKnown?y.logger.log("live audio playlist sliding:"+s.toFixed(3)):y.logger.log("live audio playlist - outdated PTS, unknown sliding")):(r.PTSKnown=!1,y.logger.log("live audio playlist - first load, unknown sliding"))}else r.PTSKnown=!1;if(a.details=r,!this.startFragRequested){if(-1===this.startPosition){var l=r.startTimeOffset;isNaN(l)?this.startPosition=0:(y.logger.log("start time offset found in playlist, adjust startPosition to "+l),this.startPosition=l)}this.nextLoadPosition=this.startPosition}this.state===_.WAITING_TRACK&&(this.state=_.IDLE),this.tick()}},{key:"onKeyLoaded",value:function e(){this.state===_.KEY_LOADING&&(this.state=_.IDLE,this.tick())}},{key:"onFragLoaded",value:function e(t){var r=this.fragCurrent,i=t.frag;if(this.state===_.FRAG_LOADING&&r&&"audio"===i.type&&i.level===r.level&&i.sn===r.sn){var a=this.tracks[this.trackId],n=a.details,s=n.totalduration,o=r.level,l=r.sn,d=r.cc,$=this.config.defaultAudioCodec||a.audioCodec||"mp4a.40.2",c=this.stats=t.stats;if("initSegment"===l)this.state=_.IDLE,c.tparsed=c.tbuffered=performance.now(),n.initSegment.data=t.payload,this.hls.trigger(f.default.FRAG_BUFFERED,{stats:c,frag:r,id:"audio"}),this.tick();else{this.state=_.PARSING,this.appended=!1,this.demuxer||(this.demuxer=new u.default(this.hls,"audio"));var h=this.initPTS[d],g=n.initSegment?n.initSegment.data:[];n.initSegment||void 0!==h?(this.pendingBuffering=!0,y.logger.log("Demuxing "+l+" of ["+n.startSN+" ,"+n.endSN+"],track "+o),this.demuxer.push(t.payload,g,$,null,r,s,!1,h)):(y.logger.log("unknown video PTS for continuity counter "+d+", waiting for video PTS before demuxing audio frag "+l+" of ["+n.startSN+" ,"+n.endSN+"],track "+o),this.waitingFragment=t,this.state=_.WAITING_INIT_PTS)}}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function e(t){var r=this.fragCurrent,i=t.frag;if(r&&"audio"===t.id&&i.sn===r.sn&&i.level===r.level&&this.state===_.PARSING){var a=t.tracks,n=void 0;if(a.video&&delete a.video,n=a.audio){n.levelCodec="mp4a.40.2",n.id=t.id,this.hls.trigger(f.default.BUFFER_CODECS,a),y.logger.log("audio track:audio,container:"+n.container+",codecs[level/parsed]=["+n.levelCodec+"/"+n.codec+"]");var s=n.initSegment;if(s){var o={type:"audio",data:s,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[o]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(f.default.BUFFER_APPENDING,o))}this.tick()}}}},{key:"onFragParsingData",value:function e(t){var r=this,i=this.fragCurrent,a=t.frag;if(i&&"audio"===t.id&&"audio"===t.type&&a.sn===i.sn&&a.level===i.level&&this.state===_.PARSING){var n=this.trackId,s=this.tracks[n],o=this.hls;isNaN(t.endPTS)&&(t.endPTS=t.startPTS+i.duration,t.endDTS=t.startDTS+i.duration),y.logger.log("parsed "+t.type+",PTS:["+t.startPTS.toFixed(3)+","+t.endPTS.toFixed(3)+"],DTS:["+t.startDTS.toFixed(3)+"/"+t.endDTS.toFixed(3)+"],nb:"+t.nb),g.default.updateFragPTSDTS(s.details,i,t.startPTS,t.endPTS);var l=this.audioSwitch,u=this.media,d=!1;if(l&&u){if(u.readyState){var $=u.currentTime;y.logger.log("switching audio track : currentTime:"+$),$>=t.startPTS&&(y.logger.log("switching audio track : flushing all audio"),this.state=_.BUFFER_FLUSHING,o.trigger(f.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),d=!0,this.audioSwitch=!1,o.trigger(f.default.AUDIO_TRACK_SWITCHED,{id:n}))}else this.audioSwitch=!1,o.trigger(f.default.AUDIO_TRACK_SWITCHED,{id:n})}var c=this.pendingData;this.audioSwitch||([t.data1,t.data2].forEach(function(e){e&&e.length&&c.push({type:t.type,data:e,parent:"audio",content:"data"})}),d||!c.length||(c.forEach(function(e){r.state===_.PARSING&&(r.pendingBuffering=!0,r.hls.trigger(f.default.BUFFER_APPENDING,e))}),this.pendingData=[],this.appended=!0)),this.tick()}}},{key:"onFragParsed",value:function e(t){var r=this.fragCurrent,i=t.frag;r&&"audio"===t.id&&i.sn===r.sn&&i.level===r.level&&this.state===_.PARSING&&(this.stats.tparsed=performance.now(),this.state=_.PARSED,this._checkAppendedParsed())}},{key:"onBufferCreated",value:function e(t){var r=t.tracks.audio;r&&(this.mediaBuffer=r.buffer,this.loadedmetadata=!0)}},{key:"onBufferAppended",value:function e(t){if("audio"===t.parent){var r=this.state;(r===_.PARSING||r===_.PARSED)&&(this.pendingBuffering=t.pending>0,this._checkAppendedParsed())}}},{key:"_checkAppendedParsed",value:function e(){if(this.state===_.PARSED&&(!this.appended||!this.pendingBuffering)){var t=this.fragCurrent,r=this.stats,i=this.hls;if(t){this.fragPrevious=t,r.tbuffered=performance.now(),i.trigger(f.default.FRAG_BUFFERED,{stats:r,frag:t,id:"audio"});var a=this.mediaBuffer?this.mediaBuffer:this.media;y.logger.log("audio buffered : "+p.default.toString(a.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,i.trigger(f.default.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=_.IDLE}this.tick()}}},{key:"onError",value:function e(t){var r=t.frag;if(!r||"audio"===r.type)switch(t.details){case x.ErrorDetails.FRAG_LOAD_ERROR:case x.ErrorDetails.FRAG_LOAD_TIMEOUT:if(!t.fatal){var i=this.fragLoadError;i?i++:i=1;var a=this.config;if(i<=a.fragLoadingMaxRetry){this.fragLoadError=i,r.loadCounter=0;var n=Math.min(Math.pow(2,i-1)*a.fragLoadingRetryDelay,a.fragLoadingMaxRetryTimeout);y.logger.warn("audioStreamController: frag loading failed, retry in "+n+" ms"),this.retryDate=performance.now()+n,this.state=_.FRAG_LOADING_WAITING_RETRY}else y.logger.error("audioStreamController: "+t.details+" reaches max retry, redispatch as fatal ..."),t.fatal=!0,this.state=_.ERROR}break;case x.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case x.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case x.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case x.ErrorDetails.KEY_LOAD_ERROR:case x.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==_.ERROR&&(this.state=t.fatal?_.ERROR:_.IDLE,y.logger.warn("audioStreamController: "+t.details+" while loading frag,switch to "+this.state+" state ..."));break;case x.ErrorDetails.BUFFER_FULL_ERROR:if("audio"===t.parent&&(this.state===_.PARSING||this.state===_.PARSED)){var s=this.mediaBuffer,l=this.media.currentTime;if(s&&o.default.isBuffered(s,l)&&o.default.isBuffered(s,l+.5)){var u=this.config;u.maxMaxBufferLength>=u.maxBufferLength&&(u.maxMaxBufferLength/=2,y.logger.warn("audio:reduce max buffer length to "+u.maxMaxBufferLength+"s"),this.fragLoadIdx+=2*u.fragLoadingLoopThreshold),this.state=_.IDLE}else y.logger.warn("buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=_.BUFFER_FLUSHING,this.hls.trigger(f.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"})}}}},{key:"onBufferFlushed",value:function e(){var t=this,r=this.pendingData;r&&r.length?(y.logger.log("appending pending audio data on Buffer Flushed"),r.forEach(function(e){t.hls.trigger(f.default.BUFFER_APPENDING,e)}),this.appended=!0,this.pendingData=[],this.state=_.PARSED):(this.state=_.IDLE,this.fragPrevious=null,this.tick())}},{key:"state",set:function e(t){if(this.state!==t){var r=this.state;this._state=t,y.logger.log("audio stream:"+r+"->"+t)}},get:function e(){return this._state}}]),t}(c.default);r.default=E},{25:25,31:31,32:32,33:33,35:35,36:36,46:46,51:51,52:52}],7:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=e(33),n=u(a),s=e(32),o=u(s),l=e(51);function u(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(e){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var r=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n.default.MANIFEST_LOADING,n.default.MANIFEST_LOADED,n.default.AUDIO_TRACK_LOADED));return r.ticks=0,r.ontick=r.tick.bind(r),r}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),i(t,[{key:"destroy",value:function e(){o.default.prototype.destroy.call(this)}},{key:"tick",value:function e(){this.ticks++,1===this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function e(){this.updateTrack(this.trackId)}},{key:"onManifestLoading",value:function e(){this.tracks=[],this.trackId=-1}},{key:"onManifestLoaded",value:function e(t){var r=this,i=t.audioTracks||[],a=!1;this.tracks=i,this.hls.trigger(n.default.AUDIO_TRACKS_UPDATED,{audioTracks:i});var s=0;i.forEach(function(e){if(e.default){r.audioTrack=s,a=!0;return}s++}),!1===a&&i.length&&(l.logger.log("no default audio track defined, use first audio track as default"),this.audioTrack=0)}},{key:"onAudioTrackLoaded",value:function e(t){t.id<this.tracks.length&&(l.logger.log("audioTrack "+t.id+" loaded"),this.tracks[t.id].details=t.details,t.details.live&&!this.timer&&(this.timer=setInterval(this.ontick,1e3*t.details.targetduration)),!t.details.live&&this.timer&&(clearInterval(this.timer),this.timer=null))}},{key:"setAudioTrackInternal",value:function e(t){if(t>=0&&t<this.tracks.length){this.timer&&(clearInterval(this.timer),this.timer=null),this.trackId=t,l.logger.log("switching to audioTrack "+t);var r=this.tracks[t],i=this.hls,a=r.type,s=r.url,o={id:t,type:a,url:s};i.trigger(n.default.AUDIO_TRACK_SWITCH,o),i.trigger(n.default.AUDIO_TRACK_SWITCHING,o);var u=r.details;s&&(void 0===u||!0===u.live)&&(l.logger.log("(re)loading playlist for audioTrack "+t),i.trigger(n.default.AUDIO_TRACK_LOADING,{url:s,id:t}))}}},{key:"updateTrack",value:function e(t){if(t>=0&&t<this.tracks.length){this.timer&&(clearInterval(this.timer),this.timer=null),this.trackId=t,l.logger.log("updating audioTrack "+t);var r=this.tracks[t],i=r.url,a=r.details;i&&(void 0===a||!0===a.live)&&(l.logger.log("(re)loading playlist for audioTrack "+t),this.hls.trigger(n.default.AUDIO_TRACK_LOADING,{url:i,id:t}))}}},{key:"audioTracks",get:function e(){return this.tracks}},{key:"audioTrack",get:function e(){return this.trackId},set:function e(t){(this.trackId!==t||void 0===this.tracks[t].details)&&this.setAudioTrackInternal(t)}}]),t}(o.default);r.default=d},{32:32,33:33,51:51}],8:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=e(33),n=d(a),s=e(32),o=d(s),l=e(51),u=e(31);function d(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(e){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var r=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n.default.MEDIA_ATTACHING,n.default.MEDIA_DETACHING,n.default.MANIFEST_PARSED,n.default.BUFFER_RESET,n.default.BUFFER_APPENDING,n.default.BUFFER_CODECS,n.default.BUFFER_EOS,n.default.BUFFER_FLUSHING,n.default.LEVEL_PTS_UPDATED,n.default.LEVEL_UPDATED));return r._msDuration=null,r._levelDuration=null,r.onsbue=r.onSBUpdateEnd.bind(r),r.onsbe=r.onSBUpdateError.bind(r),r.pendingTracks={},r.tracks={},r}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),i(t,[{key:"destroy",value:function e(){o.default.prototype.destroy.call(this)}},{key:"onLevelPtsUpdated",value:function e(t){var r=t.type,i=this.tracks.audio;if("audio"===r&&i&&"audio/mpeg"===i.container){var a=this.sourceBuffer.audio;if(Math.abs(a.timestampOffset-t.start)>.1){var n=a.updating;try{a.abort()}catch(s){n=!0,l.logger.warn("can not abort audio buffer: "+s)}n?this.audioTimestampOffset=t.start:(l.logger.warn("change mpeg audio timestamp offset from "+a.timestampOffset+" to "+t.start),a.timestampOffset=t.start)}}}},{key:"onManifestParsed",value:function e(t){var r=t.audio,i=t.video,a=0;t.altAudio&&(r||i)&&(a=(r?1:0)+(i?1:0),l.logger.log(a+" sourceBuffer(s) expected")),this.sourceBufferNb=a}},{key:"onMediaAttaching",value:function e(t){var r=this.media=t.media;if(r){var i=this.mediaSource=new MediaSource;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),i.addEventListener("sourceopen",this.onmso),i.addEventListener("sourceended",this.onmse),i.addEventListener("sourceclose",this.onmsc),r.src=URL.createObjectURL(i)}}},{key:"onMediaDetaching",value:function e(){l.logger.log("media source detaching");var t=this.mediaSource;if(t){if("open"===t.readyState)try{t.endOfStream()}catch(r){l.logger.warn("onMediaDetaching:"+r.message+" while calling endOfStream")}t.removeEventListener("sourceopen",this.onmso),t.removeEventListener("sourceended",this.onmse),t.removeEventListener("sourceclose",this.onmsc),this.media&&(URL.revokeObjectURL(this.media.src),this.media.removeAttribute("src"),this.media.load()),this.mediaSource=null,this.media=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(n.default.MEDIA_DETACHED)}},{key:"onMediaSourceOpen",value:function e(){l.logger.log("media source opened"),this.hls.trigger(n.default.MEDIA_ATTACHED,{media:this.media});var t=this.mediaSource;t&&t.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()}},{key:"checkPendingTracks",value:function e(){var t=this.pendingTracks,r=Object.keys(t).length;r&&(this.sourceBufferNb<=r||0===this.sourceBufferNb)&&(this.createSourceBuffers(t),this.pendingTracks={},this.doAppending())}},{key:"onMediaSourceClose",value:function e(){l.logger.log("media source closed")}},{key:"onMediaSourceEnded",value:function e(){l.logger.log("media source ended")}},{key:"onSBUpdateEnd",value:function e(){if(this.audioTimestampOffset){var t=this.sourceBuffer.audio;l.logger.warn("change mpeg audio timestamp offset from "+t.timestampOffset+" to "+this.audioTimestampOffset),t.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset}this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var r=this.parent,i=this.segments.reduce(function(e,t){return t.parent===r?e+1:e},0);this.hls.trigger(n.default.BUFFER_APPENDED,{parent:r,pending:i}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration()}},{key:"onSBUpdateError",value:function e(t){l.logger.error("sourceBuffer error:",t),this.hls.trigger(n.default.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})}},{key:"onBufferReset",value:function e(){var t=this.sourceBuffer;for(var r in t){var i=t[r];try{this.mediaSource.removeSourceBuffer(i),i.removeEventListener("updateend",this.onsbue),i.removeEventListener("error",this.onsbe)}catch(a){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}},{key:"onBufferCodecs",value:function e(t){if(0===Object.keys(this.sourceBuffer).length){for(var r in t)this.pendingTracks[r]=t[r];var i=this.mediaSource;i&&"open"===i.readyState&&this.checkPendingTracks()}}},{key:"createSourceBuffers",value:function e(t){var r=this.sourceBuffer,i=this.mediaSource;for(var a in t)if(!r[a]){var s=t[a],o=s.levelCodec||s.codec,d=s.container+";codecs="+o;l.logger.log("creating sourceBuffer("+d+")");try{var f=r[a]=i.addSourceBuffer(d);f.addEventListener("updateend",this.onsbue),f.addEventListener("error",this.onsbe),this.tracks[a]={codec:o,container:s.container},s.buffer=f}catch($){l.logger.error("error while trying to add sourceBuffer:"+$.message),this.hls.trigger(n.default.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:$,mimeType:d})}}this.hls.trigger(n.default.BUFFER_CREATED,{tracks:t})}},{key:"onBufferAppending",value:function e(t){this._needsFlush||(this.segments?this.segments.push(t):this.segments=[t],this.doAppending())}},{key:"onBufferAppendFail",value:function e(t){l.logger.error("sourceBuffer error:",t.event),this.hls.trigger(n.default.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})}},{key:"onBufferEos",value:function e(t){var r=this.sourceBuffer,i=t.type;for(var a in r)i&&a!==i||r[a].ended||(r[a].ended=!0,l.logger.log(a+" sourceBuffer now EOS"));this.checkEos()}},{key:"checkEos",value:function e(){var t=this.sourceBuffer,r=this.mediaSource;if(!r||"open"!==r.readyState){this._needsEos=!1;return}for(var i in t){var a=t[i];if(!a.ended)return;if(a.updating){this._needsEos=!0;return}}l.logger.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment");try{r.endOfStream()}catch(n){l.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}},{key:"onBufferFlushing",value:function e(t){this.flushRange.push({start:t.startOffset,end:t.endOffset,type:t.type}),this.flushBufferCounter=0,this.doFlush()}},{key:"onLevelUpdated",value:function e(t){var r=t.details;0!==r.fragments.length&&(this._levelDuration=r.totalduration+r.fragments[0].start,this.updateMediaElementDuration())}},{key:"updateMediaElementDuration",value:function e(){var t=this.media,r=this.mediaSource,i=this.sourceBuffer,a=this._levelDuration;if(null!==a&&t&&r&&i&&0!==t.readyState&&"open"===r.readyState){for(var n in i)if(i[n].updating)return;null===this._msDuration&&(this._msDuration=r.duration);var s=t.duration;(a>this._msDuration&&a>s||s===1/0||isNaN(s))&&(l.logger.log("Updating mediasource duration to "+a.toFixed(3)),this._msDuration=r.duration=a)}}},{key:"doFlush",value:function e(){for(;this.flushRange.length;){var t=this.flushRange[0];if(this.flushBuffer(t.start,t.end,t.type))this.flushRange.shift(),this.flushBufferCounter=0;else{this._needsFlush=!0;return}}if(0===this.flushRange.length){this._needsFlush=!1;var r=0,i=this.sourceBuffer;try{for(var a in i)r+=i[a].buffered.length}catch(s){l.logger.error("error while accessing sourceBuffer.buffered")}this.appended=r,this.hls.trigger(n.default.BUFFER_FLUSHED)}}},{key:"doAppending",value:function e(){var t=this.hls,r=this.sourceBuffer,i=this.segments;if(Object.keys(r).length){if(this.media.error){this.segments=[],l.logger.error("trying to append although a media error occured, flush segment and abort");return}if(this.appending)return;if(i&&i.length){var a=i.shift();try{var s=r[a.type];s?s.updating?i.unshift(a):(s.ended=!1,this.parent=a.parent,s.appendBuffer(a.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(o){l.logger.error("error while trying to append buffer:"+o.message),i.unshift(a);var d={type:u.ErrorTypes.MEDIA_ERROR,parent:a.parent};if(22!==o.code){if(this.appendError?this.appendError++:this.appendError=1,d.details=u.ErrorDetails.BUFFER_APPEND_ERROR,this.appendError>t.config.appendErrorMaxRetry){l.logger.log("fail "+t.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),i=[],d.fatal=!0,t.trigger(n.default.ERROR,d);return}d.fatal=!1,t.trigger(n.default.ERROR,d)}else{this.segments=[],d.details=u.ErrorDetails.BUFFER_FULL_ERROR,d.fatal=!1,t.trigger(n.default.ERROR,d);return}}}}}},{key:"flushBuffer",value:function e(t,r,i){var a,n,s,o,u,d,f=this.sourceBuffer;if(Object.keys(f).length){if(l.logger.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+t+"/"+r),this.flushBufferCounter<this.appended){for(var $ in f)if(!i||$===i){if((a=f[$]).ended=!1,a.updating)return l.logger.warn("cannot flush, sb updating in progress"),!1;try{for(n=0;n<a.buffered.length;n++)if(s=a.buffered.start(n),o=a.buffered.end(n),-1!==navigator.userAgent.toLowerCase().indexOf("firefox")&&r===Number.POSITIVE_INFINITY?(u=t,d=r):(u=Math.max(s,t),d=Math.min(o,r)),Math.min(d,o)-u>.5)return this.flushBufferCounter++,l.logger.log("flush "+$+" ["+u+","+d+"], of ["+s+","+o+"], pos:"+this.media.currentTime),a.remove(u,d),!1}catch(c){l.logger.warn("exception while accessing sourcebuffer, it might have been removed from MediaSource")}}}else l.logger.warn("abort flushing too many retries");l.logger.log("buffer flushed")}return!0}}]),t}(o.default);r.default=f},{31:31,32:32,33:33,51:51}],9:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=e(33),n=l(a),s=e(32),o=l(s);function l(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e){return!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t),function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n.default.FPS_DROP_LEVEL_CAPPING,n.default.MEDIA_ATTACHING,n.default.MANIFEST_PARSED))}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),i(t,[{key:"destroy",value:function e(){this.hls.config.capLevelToPlayerSize&&(this.media=this.restrictedLevels=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer)))}},{key:"onFpsDropLevelCapping",value:function e(t){this.restrictedLevels||(this.restrictedLevels=[]),this.isLevelRestricted(t.droppedLevel)||this.restrictedLevels.push(t.droppedLevel)}},{key:"onMediaAttaching",value:function e(t){this.media=t.media instanceof HTMLVideoElement?t.media:null}},{key:"onManifestParsed",value:function e(t){var r=this.hls;r.config.capLevelToPlayerSize&&(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.levels=t.levels,r.firstLevel=this.getMaxLevel(t.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}},{key:"detectPlayerSize",value:function e(){if(this.media){var t=this.levels?this.levels.length:0;if(t){var r=this.hls;r.autoLevelCapping=this.getMaxLevel(t-1),r.autoLevelCapping>this.autoLevelCapping&&r.streamController.nextLevelSwitch(),this.autoLevelCapping=r.autoLevelCapping}}}},{key:"getMaxLevel",value:function e(t){var r=0,i=void 0,a=void 0,n=this.mediaWidth,s=this.mediaHeight,o=0,l=0;for(i=0;i<=t&&(a=this.levels[i],!this.isLevelRestricted(i))&&(r=i,o=a.width,l=a.height,!(n<=o)&&!(s<=l));i++);return r}},{key:"isLevelRestricted",value:function e(t){return!!this.restrictedLevels&&-1!==this.restrictedLevels.indexOf(t)}},{key:"contentScaleFactor",get:function e(){var t=1;try{t=window.devicePixelRatio}catch(r){}return t}},{key:"mediaWidth",get:function e(){var t=void 0,r=this.media;return r&&(t=r.width||r.clientWidth||r.offsetWidth,t*=this.contentScaleFactor),t}},{key:"mediaHeight",get:function e(){var t=void 0,r=this.media;return r&&(t=r.height||r.clientHeight||r.offsetHeight,t*=this.contentScaleFactor),t}}]),t}(o.default);r.default=u},{32:32,33:33}],10:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=e(33),n=u(a),s=e(32),o=u(s),l=e(51);function u(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(e){return!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t),function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n.default.MEDIA_ATTACHING))}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),i(t,[{key:"destroy",value:function e(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1}},{key:"onMediaAttaching",value:function e(t){var r=this.hls.config;r.capLevelOnFPSDrop&&("function"==typeof(this.video=t.media instanceof HTMLVideoElement?t.media:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod))}},{key:"checkFPS",value:function e(t,r,i){var a=performance.now();if(r){if(this.lastTime){var s=a-this.lastTime,o=i-this.lastDroppedFrames,u=r-this.lastDecodedFrames,d=this.hls;if(d.trigger(n.default.FPS_DROP,{currentDropped:o,currentDecoded:u,totalDroppedFrames:i}),1e3*o/s>0&&o>d.config.fpsDroppedMonitoringThreshold*u){var f=d.currentLevel;l.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+f),f>0&&(-1===d.autoLevelCapping||d.autoLevelCapping>=f)&&(f-=1,d.trigger(n.default.FPS_DROP_LEVEL_CAPPING,{level:f,droppedLevel:d.currentLevel}),d.autoLevelCapping=f,d.streamController.nextLevelSwitch())}}this.lastTime=a,this.lastDroppedFrames=i,this.lastDecodedFrames=r}}},{key:"checkFPSInterval",value:function e(){var t=this.video;if(t){if(this.isVideoPlaybackQualityAvailable){var r=t.getVideoPlaybackQuality();this.checkFPS(t,r.totalVideoFrames,r.droppedVideoFrames)}else this.checkFPS(t,t.webkitDecodedFrameCount,t.webkitDroppedFrameCount)}}}]),t}(o.default);r.default=d},{32:32,33:33,51:51}],11:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=e(33),n=l(a),s=e(32),o=l(s);function l(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var r=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n.default.MEDIA_ATTACHED,n.default.MEDIA_DETACHING,n.default.FRAG_PARSING_METADATA));return r.id3Track=void 0,r.media=void 0,r}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),i(t,[{key:"destroy",value:function e(){o.default.prototype.destroy.call(this)}},{key:"onMediaAttached",value:function e(t){this.media=t.media,this.media&&(this.id3Track=this.media.addTextTrack("metadata","id3"),this.id3Track.mode="hidden")}},{key:"onMediaDetaching",value:function e(){this.media=void 0}},{key:"onFragParsingMetadata",value:function e(t){var r=t.frag,i=t.samples,a=r.start,n=r.start+r.duration;a===n&&(n+=1e-4);for(var s=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,o=0;o<i.length;o++){var l=this.parseID3Frame(i[o].data),u=this.decodeID3Frame(l);if(u){var d=new s(a,n,"");d.value=u,this.id3Track.addCue(d)}}}},{key:"parseID3Frame",value:function e(t){if(!(t.length<21)&&73===t[0]&&68===t[1]&&51===t[2]){var r;return{type:String.fromCharCode(t[10],t[11],t[12],t[13]),data:t=t.subarray(20)}}}},{key:"decodeID3Frame",value:function e(t){return"TXXX"===t.type?this.decodeTxxxFrame(t):"PRIV"===t.type?this.decodePrivFrame(t):"T"===t.type[0]?this.decodeTextFrame(t):void 0}},{key:"decodeTxxxFrame",value:function e(t){if(!(t.size<2)&&3===t.data[0]){var r=1,i=this.utf8ArrayToStr(t.data.subarray(r));r+=i.length+1;var a=this.utf8ArrayToStr(t.data.subarray(r));return{key:"TXXX",description:i,data:a}}}},{key:"decodeTextFrame",value:function e(t){if(!(t.size<2)&&3===t.data[0]){var r=t.data.subarray(1);return{key:t.type,data:this.utf8ArrayToStr(r)}}}},{key:"decodePrivFrame",value:function e(t){if(!(t.size<2)){var r=this.utf8ArrayToStr(t.data),i=t.data.subarray(r.length+1);return{key:"PRIV",info:r,data:i.buffer}}}},{key:"utf8ArrayToStr",value:function e(t){for(var r=void 0,i=void 0,a="",n=0,s=t.length;n<s;){var o=t[n++];switch(o>>4){case 0:return a;case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(o);break;case 12:case 13:a+=String.fromCharCode((31&o)<<6|63&(r=t[n++]));break;case 14:a+=String.fromCharCode((15&o)<<12|(63&(r=t[n++]))<<6|(63&(i=t[n++]))<<0)}}return a}}]),t}(o.default);r.default=u},{32:32,33:33}],12:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=e(33),n=$(a),s=e(32),o=$(s),l=e(51),u=e(31),d=e(35),f=$(d);function $(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(e){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var r=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n.default.MANIFEST_LOADED,n.default.LEVEL_LOADED,n.default.FRAG_LOADED,n.default.ERROR));return r.ontick=r.tick.bind(r),r._manualLevel=-1,r}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),i(t,[{key:"destroy",value:function e(){this.timer&&(clearTimeout(this.timer),this.timer=null),this._manualLevel=-1}},{key:"startLoad",value:function e(){this.canload=!0;var t=this._levels;t&&t.forEach(function(e){e.loadError=0;var t=e.details;t&&t.live&&(e.details=void 0)}),this.timer&&this.tick()}},{key:"stopLoad",value:function e(){this.canload=!1}},{key:"onManifestLoaded",value:function e(t){var r,i=[],a=[],s={},o=!1,d=!1,f=this.hls,$=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),c=function e(t,r){return MediaSource.isTypeSupported(t+"/mp4;codecs="+r)};if(t.levels.forEach(function(e){e.videoCodec&&(o=!0),$&&e.audioCodec&&-1!==e.audioCodec.indexOf("mp4a.40.34")&&(e.audioCodec=void 0),(e.audioCodec||e.attrs&&e.attrs.AUDIO)&&(d=!0);var t=s[e.bitrate];void 0===t?(s[e.bitrate]=i.length,e.url=[e.url],e.urlId=0,i.push(e)):i[t].url.push(e.url)}),o&&d?i.forEach(function(e){e.videoCodec&&a.push(e)}):a=i,(a=a.filter(function(e){var t=e.audioCodec,r=e.videoCodec;return(!t||c("audio",t))&&(!r||c("video",r))})).length){r=a[0].bitrate,a.sort(function(e,t){return e.bitrate-t.bitrate}),this._levels=a;for(var h=0;h<a.length;h++)if(a[h].bitrate===r){this._firstLevel=h,l.logger.log("manifest loaded,"+a.length+" level(s) found, first bitrate:"+r);break}f.trigger(n.default.MANIFEST_PARSED,{levels:a,firstLevel:this._firstLevel,stats:t.stats,audio:d,video:o,altAudio:t.audioTracks.length>0})}else f.trigger(n.default.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:f.url,reason:"no level with compatible codecs found in manifest"})}},{key:"setLevelInternal",value:function e(t){var r=this._levels,i=this.hls;if(t>=0&&t<r.length){if(this.timer&&(clearTimeout(this.timer),this.timer=null),this._level!==t){l.logger.log("switching to level "+t),this._level=t;var a=r[t];a.level=t,i.trigger(n.default.LEVEL_SWITCH,a),i.trigger(n.default.LEVEL_SWITCHING,a)}var s=r[t],o=s.details;if(!o||!0===o.live){var d=s.urlId;i.trigger(n.default.LEVEL_LOADING,{url:s.url[d],level:t,id:d})}}else i.trigger(n.default.ERROR,{type:u.ErrorTypes.OTHER_ERROR,details:u.ErrorDetails.LEVEL_SWITCH_ERROR,level:t,fatal:!1,reason:"invalid level idx"})}},{key:"onError",value:function e(t){if(!t.fatal){var r=t.details,i=this.hls,a=void 0,n=void 0,s=!1;switch(r){case u.ErrorDetails.FRAG_LOAD_ERROR:case u.ErrorDetails.FRAG_LOAD_TIMEOUT:case u.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case u.ErrorDetails.KEY_LOAD_ERROR:case u.ErrorDetails.KEY_LOAD_TIMEOUT:a=t.frag.level;break;case u.ErrorDetails.LEVEL_LOAD_ERROR:case u.ErrorDetails.LEVEL_LOAD_TIMEOUT:a=t.context.level,s=!0;break;case u.ErrorDetails.REMUX_ALLOC_ERROR:a=t.level}if(void 0!==a){(n=this._levels[a]).loadError?n.loadError++:n.loadError=1;var o=n.url.length;if(o>1&&n.loadError<o)n.urlId=(n.urlId+1)%o,n.details=void 0,l.logger.warn("level controller,"+r+" for level "+a+": switching to redundant stream id "+n.urlId);else if(-1===this._manualLevel&&a)l.logger.warn("level controller,"+r+": switch-down for next fragment"),i.nextAutoLevel=Math.max(0,a-1);else if(n&&n.details&&n.details.live)l.logger.warn("level controller,"+r+" on live stream, discard"),s&&(this._level=void 0);else if(r===u.ErrorDetails.LEVEL_LOAD_ERROR||r===u.ErrorDetails.LEVEL_LOAD_TIMEOUT){var d=i.media;if(d&&f.default.isBuffered(d,d.currentTime)&&f.default.isBuffered(d,d.currentTime+.5)){var $=i.config.levelLoadingRetryDelay;l.logger.warn("level controller,"+r+", but media buffered, retry in "+$+"ms"),this.timer=setTimeout(this.ontick,$)}else l.logger.error("cannot recover "+r+" error"),this._level=void 0,this.timer&&(clearTimeout(this.timer),this.timer=null),t.fatal=!0}}}}},{key:"onFragLoaded",value:function e(t){var r=t.frag;if(r&&"main"===r.type){var i=this._levels[r.level];i&&(i.loadError=0)}}},{key:"onLevelLoaded",value:function e(t){var r=t.level;if(r===this._level){var i=this._levels[r];i.loadError=0;var a=t.details;if(a.live){var n=1e3*(a.averagetargetduration?a.averagetargetduration:a.targetduration),s=i.details;s&&a.endSN===s.endSN&&(n/=2,l.logger.log("same live playlist, reload twice faster")),n-=performance.now()-t.stats.trequest,n=Math.max(1e3,Math.round(n)),l.logger.log("live playlist, reload in "+n+" ms"),this.timer=setTimeout(this.ontick,n)}else this.timer=null}}},{key:"tick",value:function e(){var t=this._level;if(void 0!==t&&this.canload){var r=this._levels[t];if(r&&r.url){var i=r.urlId;this.hls.trigger(n.default.LEVEL_LOADING,{url:r.url[i],level:t,id:i})}}}},{key:"levels",get:function e(){return this._levels}},{key:"level",get:function e(){return this._level},set:function e(t){var r=this._levels;r&&r.length>t&&(this._level!==t||void 0===r[t].details)&&this.setLevelInternal(t)}},{key:"manualLevel",get:function e(){return this._manualLevel},set:function e(t){this._manualLevel=t,void 0===this._startLevel&&(this._startLevel=t),-1!==t&&(this.level=t)}},{key:"firstLevel",get:function e(){return this._firstLevel},set:function e(t){this._firstLevel=t}},{key:"startLevel",get:function e(){if(void 0!==this._startLevel)return this._startLevel;var t=this.hls.config.startLevel;return void 0!==t?t:this._firstLevel},set:function e(t){this._startLevel=t}},{key:"nextLoadLevel",get:function e(){return -1!==this._manualLevel?this._manualLevel:this.hls.nextAutoLevel},set:function e(t){this.level=t,-1===this._manualLevel&&(this.hls.nextAutoLevel=t)}}]),t}(o.default);r.default=c},{31:31,32:32,33:33,35:35,51:51}],13:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=e(46),n=m(a),s=e(35),o=m(s),l=e(25),u=m(l),d=e(33),f=m(d),$=e(32),c=m($),h=e(36),g=m(h),v=e(52),p=m(v),x=e(31),y=e(51);function m(e){return e&&e.__esModule?e:{default:e}}var _={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_LEVEL:"WAITING_LEVEL",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR"},E=function(e){function t(e){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var r=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,f.default.MEDIA_ATTACHED,f.default.MEDIA_DETACHING,f.default.MANIFEST_LOADING,f.default.MANIFEST_PARSED,f.default.LEVEL_LOADED,f.default.KEY_LOADED,f.default.FRAG_LOADED,f.default.FRAG_LOAD_EMERGENCY_ABORTED,f.default.FRAG_PARSING_INIT_SEGMENT,f.default.FRAG_PARSING_DATA,f.default.FRAG_PARSED,f.default.ERROR,f.default.AUDIO_TRACK_SWITCHING,f.default.AUDIO_TRACK_SWITCHED,f.default.BUFFER_CREATED,f.default.BUFFER_APPENDED,f.default.BUFFER_FLUSHED));return r.config=e.config,r.audioCodecSwap=!1,r.ticks=0,r._state=_.STOPPED,r.ontick=r.tick.bind(r),r}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),i(t,[{key:"destroy",value:function e(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),c.default.prototype.destroy.call(this),this.state=_.STOPPED}},{key:"startLoad",value:function e(t){if(this.levels){var r=this.lastCurrentTime,i=this.hls;if(this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var a=i.startLevel;-1===a&&(a=0,this.bitrateTest=!0),this.level=i.nextLoadLevel=a,this.loadedmetadata=!1}r>0&&-1===t&&(y.logger.log("override startPosition with lastCurrentTime @"+r.toFixed(3)),t=r),this.state=_.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}else this.forceStartLoad=!0,this.state=_.STOPPED}},{key:"stopLoad",value:function e(){var t=this.fragCurrent;t&&(t.loader&&t.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=_.STOPPED,this.forceStartLoad=!1}},{key:"tick",value:function e(){this.ticks++,1===this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function e(){switch(this.state){case _.ERROR:break;case _.BUFFER_FLUSHING:this.fragLoadError=0;break;case _.IDLE:this._doTickIdle();break;case _.WAITING_LEVEL:var t=this.levels[this.level];t&&t.details&&(this.state=_.IDLE);break;case _.FRAG_LOADING_WAITING_RETRY:var r=performance.now(),i=this.retryDate;(!i||r>=i||this.media&&this.media.seeking)&&(y.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=_.IDLE);case _.ERROR:case _.STOPPED:case _.FRAG_LOADING:case _.PARSING:case _.PARSED:case _.ENDED:}this._checkBuffer(),this._checkFragmentChanged()}},{key:"_doTickIdle",value:function e(){var t=this.hls,r=t.config,i=this.media;if(void 0===this.levelLastLoaded||i||!this.startFragRequested&&r.startFragPrefetch){var a=void 0;a=this.loadedmetadata?i.currentTime:this.nextLoadPosition;var n=t.nextLoadLevel,s=this.levels[n],l=s.bitrate,u=void 0;u=Math.min(u=l?Math.max(8*r.maxBufferSize/l,r.maxBufferLength):r.maxBufferLength,r.maxMaxBufferLength);var d=o.default.bufferInfo(this.mediaBuffer?this.mediaBuffer:i,a,r.maxBufferHole),$=d.len;if(!($>=u)){y.logger.trace("buffer length of "+$.toFixed(3)+" is below max of "+u.toFixed(3)+". checking for more payload ..."),this.level=t.nextLoadLevel=n;var c=s.details;if(void 0===c||c.live&&this.levelLastLoaded!==n){this.state=_.WAITING_LEVEL;return}var h=this.fragPrevious;if(!c.live&&h&&h.sn===c.endSN&&Math.min(i.duration,h.start+h.duration)-Math.max(d.end,h.start)<=Math.max(.2,h.duration/2)){var g={};this.altAudio&&(g.type="video"),this.hls.trigger(f.default.BUFFER_EOS,g),this.state=_.ENDED;return}this._fetchPayloadOrEos(a,d,c)}}}},{key:"_fetchPayloadOrEos",value:function e(t,r,i){var a=this.fragPrevious,n=this.level,s=i.fragments,o=s.length;if(0!==o){var l=s[0].start,u=s[o-1].start+s[o-1].duration,d=r.end,f=void 0;if(i.initSegment&&!i.initSegment.data)f=i.initSegment;else if(i.live){var $=this.config.initialLiveManifestSize;if(o<$){y.logger.warn("Can not start playback of a level, reason: not enough fragments "+o+" < "+$);return}if(null===(f=this._ensureFragmentAtLivePoint(i,d,l,u,a,s,o)))return}else d<l&&(f=s[0]);f||(f=this._findFragment(l,a,o,s,d,u,i)),f&&this._loadFragmentOrKey(f,n,i,t,d)}}},{key:"_ensureFragmentAtLivePoint",value:function e(t,r,i,a,n,s,o){var l=this.hls.config,u=this.media,d=void 0,f=void 0!==l.liveMaxLatencyDuration?l.liveMaxLatencyDuration:l.liveMaxLatencyDurationCount*t.targetduration;if(r<Math.max(i-l.maxFragLookUpTolerance,a-f)){var $=this.liveSyncPosition=this.computeLivePosition(i,t);y.logger.log("buffer end: "+r.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+$.toFixed(3)),r=$,u&&u.readyState&&u.duration>$&&(u.currentTime=$)}if(t.PTSKnown&&r>a&&u&&u.readyState)return null;if(this.startFragRequested&&!t.PTSKnown){if(n){var c=n.sn+1;c>=t.startSN&&c<=t.endSN&&(d=s[c-t.startSN],y.logger.log("live playlist, switching playlist, load frag with next SN: "+d.sn))}d||(d=s[Math.min(o-1,Math.round(o/2))],y.logger.log("live playlist, switching playlist, unknown, load middle frag : "+d.sn))}return d}},{key:"_findFragment",value:function e(t,r,i,a,s,o,l){var u=this.hls.config,d=void 0,f=void 0,$=u.maxFragLookUpTolerance,c=r?a[r.sn-a[0].sn+1]:void 0,h=function e(t){var r=Math.min($,t.duration);return t.start+t.duration-r<=s?1:t.start-r>s&&t.start?-1:0};if(s<o?(s>o-$&&($=0),f=c&&!h(c)?c:n.default.search(a,h)):f=a[i-1],f){var g=(d=f).sn-l.startSN,v=r&&d.level===r.level,p=a[g-1],x=a[g+1];if(v&&d.sn===r.sn){if(d.sn<l.endSN){var m=r.deltaPTS;m&&m>u.maxBufferHole&&r.dropped&&g?(d=p,y.logger.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this"),r.loadCounter--):(d=x,y.logger.log("SN just loaded, load next one: "+d.sn))}else d=null}else d.dropped&&!v&&(x&&x.backtracked?(y.logger.warn("Already backtracked from fragment "+(g+1)+", will not backtrack to fragment "+g+". Loading fragment "+(g+1)),d=x):(y.logger.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),d.dropped=0,p?(p.loadCounter&&p.loadCounter--,d=p):d=null))}return d}},{key:"_loadFragmentOrKey",value:function e(t,r,i,a,n){var s=this.hls,o=s.config;if(t.decryptdata&&null!=t.decryptdata.uri&&null==t.decryptdata.key)y.logger.log("Loading key for "+t.sn+" of ["+i.startSN+" ,"+i.endSN+"],level "+r),this.state=_.KEY_LOADING,s.trigger(f.default.KEY_LOADING,{frag:t});else{if(y.logger.log("Loading "+t.sn+" of ["+i.startSN+" ,"+i.endSN+"],level "+r+", currentTime:"+a.toFixed(3)+",bufferEnd:"+n.toFixed(3)),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,t.loadCounter){t.loadCounter++;var l=o.fragLoadingLoopThreshold;if(t.loadCounter>l&&Math.abs(this.fragLoadIdx-t.loadIdx)<l){s.trigger(f.default.ERROR,{type:x.ErrorTypes.MEDIA_ERROR,details:x.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:t});return}}else t.loadCounter=1;t.loadIdx=this.fragLoadIdx,this.fragCurrent=t,this.startFragRequested=!0,isNaN(t.sn)||(this.nextLoadPosition=t.start+t.duration),t.autoLevel=s.autoLevelEnabled,t.bitrateTest=this.bitrateTest,s.trigger(f.default.FRAG_LOADING,{frag:t}),this.demuxer||(this.demuxer=new u.default(s,"main")),this.state=_.FRAG_LOADING;return}}},{key:"getBufferedFrag",value:function e(t){return n.default.search(this._bufferedFrags,function(e){return t<e.startPTS?-1:t>e.endPTS?1:0})}},{key:"followingBufferedFrag",value:function e(t){return t?this.getBufferedFrag(t.endPTS+.5):null}},{key:"_checkFragmentChanged",value:function e(){var t,r,i=this.media;if(i&&i.readyState&&!1===i.seeking&&((r=i.currentTime)>i.playbackRate*this.lastCurrentTime&&(this.lastCurrentTime=r),o.default.isBuffered(i,r)?t=this.getBufferedFrag(r):o.default.isBuffered(i,r+.1)&&(t=this.getBufferedFrag(r+.1)),t)){var a=t;if(a!==this.fragPlaying){this.hls.trigger(f.default.FRAG_CHANGED,{frag:a});var n=a.level;this.fragPlaying&&this.fragPlaying.level===n||this.hls.trigger(f.default.LEVEL_SWITCHED,{level:n}),this.fragPlaying=a}}}},{key:"immediateLevelSwitch",value:function e(){if(y.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var t=this.media,r=void 0;t?(r=t.paused,t.pause()):r=!0,this.previouslyPaused=r}var i=this.fragCurrent;i&&i.loader&&i.loader.abort(),this.fragCurrent=null,this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}},{key:"immediateLevelSwitchEnd",value:function e(){var t=this.media;t&&t.buffered.length&&(this.immediateSwitch=!1,o.default.isBuffered(t,t.currentTime)&&(t.currentTime-=1e-4),this.previouslyPaused||t.play())}},{key:"nextLevelSwitch",value:function e(){var t=this.media;if(t&&t.readyState){var r=void 0,i=void 0,a=void 0;if(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,(i=this.getBufferedFrag(t.currentTime))&&i.startPTS>1&&this.flushMainBuffer(0,i.startPTS-1),t.paused)r=0;else{var n=this.hls.nextLoadLevel,s=this.levels[n],o=this.fragLastKbps;r=o&&this.fragCurrent?this.fragCurrent.duration*s.bitrate/(1e3*o)+1:0}if((a=this.getBufferedFrag(t.currentTime+r))&&(a=this.followingBufferedFrag(a))){var l=this.fragCurrent;l&&l.loader&&l.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(a.startPTS,Number.POSITIVE_INFINITY)}}}},{key:"flushMainBuffer",value:function e(t,r){this.state=_.BUFFER_FLUSHING;var i={startOffset:t,endOffset:r};this.altAudio&&(i.type="video"),this.hls.trigger(f.default.BUFFER_FLUSHING,i)}},{key:"onMediaAttached",value:function e(t){var r=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),r.addEventListener("seeking",this.onvseeking),r.addEventListener("seeked",this.onvseeked),r.addEventListener("ended",this.onvended);var i=this.config;this.levels&&i.autoStartLoad&&this.hls.startLoad(i.startPosition)}},{key:"onMediaDetaching",value:function e(){var t=this.media;t&&t.ended&&(y.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var r=this.levels;r&&r.forEach(function(e){e.details&&e.details.fragments.forEach(function(e){e.loadCounter=void 0,e.backtracked=void 0})}),t&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("seeked",this.onvseeked),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onMediaSeeking",value:function e(){var t=this.media,r=t?t.currentTime:void 0,i=this.config;if(y.logger.log("media seeking to "+r.toFixed(3)),this.state===_.FRAG_LOADING){var a=this.mediaBuffer?this.mediaBuffer:t,n=o.default.bufferInfo(a,r,this.config.maxBufferHole),s=this.fragCurrent;if(0===n.len&&s){var l=i.maxFragLookUpTolerance,u=s.start-l,d=s.start+s.duration+l;r<u||r>d?(s.loader&&(y.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),s.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=_.IDLE):y.logger.log("seeking outside of buffer but within currently loaded fragment range")}}else this.state===_.ENDED&&(this.state=_.IDLE);t&&(this.lastCurrentTime=r),this.state!==_.FRAG_LOADING&&void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*i.fragLoadingLoopThreshold),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=r),this.tick()}},{key:"onMediaSeeked",value:function e(){y.logger.log("media seeked to "+this.media.currentTime.toFixed(3)),this.tick()}},{key:"onMediaEnded",value:function e(){y.logger.log("media ended"),this.startPosition=this.lastCurrentTime=0}},{key:"onManifestLoading",value:function e(){y.logger.log("trigger BUFFER_RESET"),this.hls.trigger(f.default.BUFFER_RESET),this._bufferedFrags=[],this.stalled=!1,this.startPosition=this.lastCurrentTime=0}},{key:"onManifestParsed",value:function e(t){var r,i=!1,a=!1;t.levels.forEach(function(e){(r=e.audioCodec)&&(-1!==r.indexOf("mp4a.40.2")&&(i=!0),-1!==r.indexOf("mp4a.40.5")&&(a=!0))}),this.audioCodecSwitch=i&&a,this.audioCodecSwitch&&y.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startLevelLoaded=!1,this.startFragRequested=!1;var n=this.config;(n.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(n.startPosition)}},{key:"onLevelLoaded",value:function e(t){var r=t.details,i=t.level,a=this.levels[i],n=r.totalduration,s=0;if(y.logger.log("level "+i+" loaded ["+r.startSN+","+r.endSN+"],duration:"+n),this.levelLastLoaded=i,r.live){var o=a.details;o&&r.fragments.length>0?(g.default.mergeDetails(o,r),s=r.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(s,o),r.PTSKnown?y.logger.log("live playlist sliding:"+s.toFixed(3)):y.logger.log("live playlist - outdated PTS, unknown sliding")):(r.PTSKnown=!1,y.logger.log("live playlist - first load, unknown sliding"))}else r.PTSKnown=!1;if(a.details=r,this.hls.trigger(f.default.LEVEL_UPDATED,{details:r,level:i}),!1===this.startFragRequested){if(-1===this.startPosition||-1===this.lastCurrentTime){var l=r.startTimeOffset;isNaN(l)?r.live?(this.startPosition=this.computeLivePosition(s,r),y.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0:(l<0&&(y.logger.log("negative start time offset "+l+", count from end of last fragment"),l=s+n+l),y.logger.log("start time offset found in playlist, adjust startPosition to "+l),this.startPosition=l),this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===_.WAITING_LEVEL&&(this.state=_.IDLE),this.tick()}},{key:"onKeyLoaded",value:function e(){this.state===_.KEY_LOADING&&(this.state=_.IDLE,this.tick())}},{key:"onFragLoaded",value:function e(t){var r=this.fragCurrent,i=t.frag;if(this.state===_.FRAG_LOADING&&r&&"main"===i.type&&i.level===r.level&&i.sn===r.sn){var a=t.stats,n=this.levels[r.level],s=n.details;if(y.logger.log("Loaded  "+r.sn+" of ["+s.startSN+" ,"+s.endSN+"],level "+r.level),this.bitrateTest=!1,this.stats=a,!0===i.bitrateTest&&this.hls.nextLoadLevel)this.state=_.IDLE,this.startFragRequested=!1,a.tparsed=a.tbuffered=performance.now(),this.hls.trigger(f.default.FRAG_BUFFERED,{stats:a,frag:r,id:"main"}),this.tick();else if("initSegment"===i.sn)this.state=_.IDLE,a.tparsed=a.tbuffered=performance.now(),s.initSegment.data=t.payload,this.hls.trigger(f.default.FRAG_BUFFERED,{stats:a,frag:r,id:"main"}),this.tick();else{this.state=_.PARSING;var o=s.totalduration,l=r.level,d=r.sn,$=this.config.defaultAudioCodec||n.audioCodec;this.audioCodecSwap&&(y.logger.log("swapping playlist audio codec"),void 0===$&&($=this.lastAudioCodec),$&&($=-1!==$.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),this.pendingBuffering=!0,this.appended=!1,y.logger.log("Parsing "+d+" of ["+s.startSN+" ,"+s.endSN+"],level "+l+", cc "+r.cc);var c=this.demuxer;c||(c=this.demuxer=new u.default(this.hls,"main"));var h=this.media,g=!(h&&h.seeking)&&(s.PTSKnown||!s.live),v=s.initSegment?s.initSegment.data:[];c.push(t.payload,v,$,n.videoCodec,r,o,g,void 0)}}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function e(t){var r=this.fragCurrent,i=t.frag;if(r&&"main"===t.id&&i.sn===r.sn&&i.level===r.level&&this.state===_.PARSING){var a,n,s=t.tracks;if(s.audio&&this.altAudio&&delete s.audio,n=s.audio){var o=this.levels[this.level].audioCodec,l=navigator.userAgent.toLowerCase();o&&this.audioCodecSwap&&(y.logger.log("swapping playlist audio codec"),o=-1!==o.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==n.metadata.channelCount&&-1===l.indexOf("firefox")&&(o="mp4a.40.5"),-1!==l.indexOf("android")&&"audio/mpeg"!==n.container&&(o="mp4a.40.2",y.logger.log("Android: force audio codec to "+o)),n.levelCodec=o,n.id=t.id}for(a in(n=s.video)&&(n.levelCodec=this.levels[this.level].videoCodec,n.id=t.id),this.hls.trigger(f.default.BUFFER_CODECS,s),s){n=s[a],y.logger.log("main track:"+a+",container:"+n.container+",codecs[level/parsed]=["+n.levelCodec+"/"+n.codec+"]");var u=n.initSegment;u&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(f.default.BUFFER_APPENDING,{type:a,data:u,parent:"main",content:"initSegment"}))}this.tick()}}},{key:"onFragParsingData",value:function e(t){var r=this,i=this.fragCurrent,a=t.frag;if(i&&"main"===t.id&&a.sn===i.sn&&a.level===i.level&&!("audio"===t.type&&this.altAudio)&&this.state===_.PARSING){var n=this.levels[this.level],s=i;if(isNaN(t.endPTS)&&(t.endPTS=t.startPTS+i.duration,t.endDTS=t.startDTS+i.duration),y.logger.log("Parsed "+t.type+",PTS:["+t.startPTS.toFixed(3)+","+t.endPTS.toFixed(3)+"],DTS:["+t.startDTS.toFixed(3)+"/"+t.endDTS.toFixed(3)+"],nb:"+t.nb+",dropped:"+(t.dropped||0)),"video"===t.type){if(s.dropped=t.dropped,s.dropped){if(s.backtracked)y.logger.warn("Already backtracked on this fragment, appending with the gap");else{s.backtracked=!0,this.nextLoadPosition=t.startPTS,this.state=_.IDLE,this.tick();return}}else s.backtracked=!1}var o=g.default.updateFragPTSDTS(n.details,s,t.startPTS,t.endPTS,t.startDTS,t.endDTS),l=this.hls;l.trigger(f.default.LEVEL_PTS_UPDATED,{details:n.details,level:this.level,drift:o,type:t.type,start:t.startPTS,end:t.endPTS}),[t.data1,t.data2].forEach(function(e){e&&e.length&&r.state===_.PARSING&&(r.appended=!0,r.pendingBuffering=!0,l.trigger(f.default.BUFFER_APPENDING,{type:t.type,data:e,parent:"main",content:"data"}))}),this.tick()}}},{key:"onFragParsed",value:function e(t){var r=this.fragCurrent,i=t.frag;r&&"main"===t.id&&i.sn===r.sn&&i.level===r.level&&this.state===_.PARSING&&(this.stats.tparsed=performance.now(),this.state=_.PARSED,this._checkAppendedParsed())}},{key:"onAudioTrackSwitching",value:function e(t){var r=!!t.url,i=t.id;if(!r){if(this.mediaBuffer!==this.media){y.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var a=this.fragCurrent;a.loader&&(y.logger.log("switching to main audio track, cancel main fragment load"),a.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=_.IDLE}var n=this.hls;n.trigger(f.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),n.trigger(f.default.AUDIO_TRACK_SWITCHED,{id:i}),this.altAudio=!1}}},{key:"onAudioTrackSwitched",value:function e(t){var r=t.id,i=!!this.hls.audioTracks[r].url;if(i){var a=this.videoBuffer;a&&this.mediaBuffer!==a&&(y.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=a)}this.altAudio=i,this.tick()}},{key:"onBufferCreated",value:function e(t){var r=t.tracks,i=void 0,a=void 0,n=!1;for(var s in r){var o=r[s];"main"===o.id?(a=s,i=o,"video"===s&&(this.videoBuffer=r[s].buffer)):n=!0}n&&i?(y.logger.log("alternate track found, use "+a+".buffered to schedule main fragment loading"),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media}},{key:"onBufferAppended",value:function e(t){if("main"===t.parent){var r=this.state;(r===_.PARSING||r===_.PARSED)&&(this.pendingBuffering=t.pending>0,this._checkAppendedParsed())}}},{key:"_checkAppendedParsed",value:function e(){if(this.state===_.PARSED&&(!this.appended||!this.pendingBuffering)){var t=this.fragCurrent;if(t){var r=this.mediaBuffer?this.mediaBuffer:this.media;y.logger.log("main buffered : "+p.default.toString(r.buffered));var i=this._bufferedFrags.filter(function(e){return o.default.isBuffered(r,(e.startPTS+e.endPTS)/2)});i.push(t),this._bufferedFrags=i.sort(function(e,t){return e.startPTS-t.startPTS}),this.fragPrevious=t;var a=this.stats;a.tbuffered=performance.now(),this.fragLastKbps=Math.round(8*a.total/(a.tbuffered-a.tfirst)),this.hls.trigger(f.default.FRAG_BUFFERED,{stats:a,frag:t,id:"main"}),this.state=_.IDLE}this.tick()}}},{key:"onError",value:function e(t){var r=t.frag||this.fragCurrent;if(!r||"main"===r.type){var i=this.media,a=i&&o.default.isBuffered(i,i.currentTime)&&o.default.isBuffered(i,i.currentTime+.5);switch(t.details){case x.ErrorDetails.FRAG_LOAD_ERROR:case x.ErrorDetails.FRAG_LOAD_TIMEOUT:case x.ErrorDetails.KEY_LOAD_ERROR:case x.ErrorDetails.KEY_LOAD_TIMEOUT:if(!t.fatal){var n=this.fragLoadError;n?n++:n=1;var s=this.config;if(n<=s.fragLoadingMaxRetry||a||r.autoLevel&&r.level){this.fragLoadError=n,r.loadCounter=0;var l=Math.min(Math.pow(2,n-1)*s.fragLoadingRetryDelay,s.fragLoadingMaxRetryTimeout);y.logger.warn("mediaController: frag loading failed, retry in "+l+" ms"),this.retryDate=performance.now()+l,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.state=_.FRAG_LOADING_WAITING_RETRY}else y.logger.error("mediaController: "+t.details+" reaches max retry, redispatch as fatal ..."),t.fatal=!0,this.state=_.ERROR}break;case x.ErrorDetails.FRAG_LOOP_LOADING_ERROR:t.fatal||(a?(this._reduceMaxBufferLength(r.duration),this.state=_.IDLE):r.autoLevel&&0!==r.level||(t.fatal=!0,this.state=_.ERROR));break;case x.ErrorDetails.LEVEL_LOAD_ERROR:case x.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==_.ERROR&&(t.fatal?(this.state=_.ERROR,y.logger.warn("streamController: "+t.details+",switch to "+this.state+" state ...")):this.state===_.WAITING_LEVEL&&(this.state=_.IDLE));break;case x.ErrorDetails.BUFFER_FULL_ERROR:"main"===t.parent&&(this.state===_.PARSING||this.state===_.PARSED)&&(a?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=_.IDLE):(y.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}}},{key:"_reduceMaxBufferLength",value:function e(t){var r=this.config;r.maxMaxBufferLength>=t&&(r.maxMaxBufferLength/=2,y.logger.warn("main:reduce max buffer length to "+r.maxMaxBufferLength+"s"),this.fragLoadIdx+=2*r.fragLoadingLoopThreshold)}},{key:"_checkBuffer",value:function e(){var t=this.media;if(t&&t.readyState){var r=t.currentTime,i=this.mediaBuffer?this.mediaBuffer:t,a=i.buffered;if(!this.loadedmetadata&&a.length){this.loadedmetadata=!0;var n=t.seeking?r:this.startPosition,s=o.default.isBuffered(i,n);r===n&&s||(y.logger.log("target start position:"+n),s||(n=a.start(0),y.logger.log("target start position not buffered, seek to buffered.start(0) "+n)),y.logger.log("adjust currentTime from "+r+" to "+n),t.currentTime=n)}else if(this.immediateSwitch)this.immediateLevelSwitchEnd();else{var l=o.default.bufferInfo(t,r,0),u=!(t.paused||t.ended||0===t.buffered.length),d=r!==this.lastCurrentTime,$=this.config;if(d)this.stallReported&&(y.logger.warn("playback not stuck anymore @"+r+", after "+Math.round(performance.now()-this.stalled)+"ms"),this.stallReported=!1),this.stalled=void 0,this.nudgeRetry=0;else if(u){var c=performance.now(),h=this.hls;if(this.stalled){var g=c-this.stalled,v=l.len,p=this.nudgeRetry||0;if(v<=.5&&g>1e3*$.lowBufferWatchdogPeriod){this.stallReported||(this.stallReported=!0,y.logger.warn("playback stalling in low buffer @"+r),h.trigger(f.default.ERROR,{type:x.ErrorTypes.MEDIA_ERROR,details:x.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:v}));var m=l.nextStart,_=m-r;if(m&&_<$.maxSeekHole&&_>0){this.nudgeRetry=++p;var E=p*$.nudgeOffset;y.logger.log("adjust currentTime from "+t.currentTime+" to next buffered @ "+m+" + nudge "+E),t.currentTime=m+E,this.stalled=void 0,h.trigger(f.default.ERROR,{type:x.ErrorTypes.MEDIA_ERROR,details:x.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,hole:m+E-r})}}else if(v>.5&&g>1e3*$.highBufferWatchdogPeriod){if(this.stallReported||(this.stallReported=!0,y.logger.warn("playback stalling in high buffer @"+r),h.trigger(f.default.ERROR,{type:x.ErrorTypes.MEDIA_ERROR,details:x.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:v})),this.stalled=void 0,this.nudgeRetry=++p,p<$.nudgeMaxRetry){var T=t.currentTime,b=T+p*$.nudgeOffset;y.logger.log("adjust currentTime from "+T+" to "+b),t.currentTime=b,h.trigger(f.default.ERROR,{type:x.ErrorTypes.MEDIA_ERROR,details:x.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else y.logger.error("still stuck in high buffer @"+r+" after "+$.nudgeMaxRetry+", raise fatal error"),h.trigger(f.default.ERROR,{type:x.ErrorTypes.MEDIA_ERROR,details:x.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}}else this.stalled=c,this.stallReported=!1}}}}},{key:"onFragLoadEmergencyAborted",value:function e(){this.state=_.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()}},{key:"onBufferFlushed",value:function e(){var t=this.mediaBuffer?this.mediaBuffer:this.media;this._bufferedFrags=this._bufferedFrags.filter(function(e){return o.default.isBuffered(t,(e.startPTS+e.endPTS)/2)}),this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.state=_.IDLE,this.fragPrevious=null}},{key:"swapAudioCodec",value:function e(){this.audioCodecSwap=!this.audioCodecSwap}},{key:"computeLivePosition",value:function e(t,r){var i=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*r.targetduration;return t+Math.max(0,r.totalduration-i)}},{key:"state",set:function e(t){if(this.state!==t){var r=this.state;this._state=t,y.logger.log("main stream:"+r+"->"+t),this.hls.trigger(f.default.STREAM_STATE_TRANSITION,{previousState:r,nextState:t})}},get:function e(){return this._state}},{key:"currentLevel",get:function e(){var t=this.media;if(t){var r=this.getBufferedFrag(t.currentTime);if(r)return r.level}return -1}},{key:"nextBufferedFrag",get:function e(){var t=this.media;return t?this.followingBufferedFrag(this.getBufferedFrag(t.currentTime)):null}},{key:"nextLevel",get:function e(){var t=this.nextBufferedFrag;return t?t.level:-1}},{key:"liveSyncPosition",get:function e(){return this._liveSyncPosition},set:function e(t){this._liveSyncPosition=t}}]),t}(c.default);r.default=E},{25:25,31:31,32:32,33:33,35:35,36:36,46:46,51:51,52:52}],14:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=e(33),n=u(a),s=e(32),o=u(s),l=e(51);function u(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(e){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var r=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n.default.ERROR,n.default.SUBTITLE_TRACKS_UPDATED,n.default.SUBTITLE_TRACK_SWITCH,n.default.SUBTITLE_TRACK_LOADED,n.default.SUBTITLE_FRAG_PROCESSED));return r.config=e.config,r.vttFragSNsProcessed={},r.vttFragQueues=void 0,r.currentlyProcessing=null,r.currentTrackId=-1,r}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),i(t,[{key:"destroy",value:function e(){o.default.prototype.destroy.call(this)}},{key:"clearVttFragQueues",value:function e(){var t=this;this.vttFragQueues={},this.tracks.forEach(function(e){t.vttFragQueues[e.id]=[]})}},{key:"nextFrag",value:function e(){if(null===this.currentlyProcessing&&this.currentTrackId>-1&&this.vttFragQueues[this.currentTrackId].length){var t=this.currentlyProcessing=this.vttFragQueues[this.currentTrackId].shift();this.hls.trigger(n.default.FRAG_LOADING,{frag:t})}}},{key:"onSubtitleFragProcessed",value:function e(t){t.success&&this.vttFragSNsProcessed[t.frag.trackId].push(t.frag.sn),this.currentlyProcessing=null,this.nextFrag()}},{key:"onError",value:function e(t){var r=t.frag;(!r||"subtitle"===r.type)&&this.currentlyProcessing&&(this.currentlyProcessing=null,this.nextFrag())}},{key:"onSubtitleTracksUpdated",value:function e(t){var r=this;l.logger.log("subtitle tracks updated"),this.tracks=t.subtitleTracks,this.clearVttFragQueues(),this.vttFragSNsProcessed={},this.tracks.forEach(function(e){r.vttFragSNsProcessed[e.id]=[]})}},{key:"onSubtitleTrackSwitch",value:function e(t){this.currentTrackId=t.id,this.clearVttFragQueues()}},{key:"onSubtitleTrackLoaded",value:function e(t){var r=this.vttFragSNsProcessed[t.id],i=this.vttFragQueues[t.id],a=this.currentlyProcessing?this.currentlyProcessing.sn:-1;t.details.fragments.forEach(function(e){var n,s;n=e,!(r.indexOf(n.sn)>-1||e.sn===a||(s=e,i.some(function(e){return e.sn===s.sn})))&&(e.trackId=t.id,i.push(e))}),this.nextFrag()}}]),t}(o.default);r.default=d},{32:32,33:33,51:51}],15:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=e(33),n=u(a),s=e(32),o=u(s),l=e(51);function u(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(e){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var r=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n.default.MEDIA_ATTACHED,n.default.MEDIA_DETACHING,n.default.MANIFEST_LOADING,n.default.MANIFEST_LOADED,n.default.SUBTITLE_TRACK_LOADED));return r.tracks=[],r.trackId=-1,r.media=void 0,r}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),i(t,[{key:"destroy",value:function e(){o.default.prototype.destroy.call(this)}},{key:"onMediaAttached",value:function e(t){var r=this;this.media=t.media,this.media&&this.media.textTracks.addEventListener("change",function(){if(r.media){for(var e=-1,t=function e(t){for(var r=[],i=0;i<t.length;i++)"subtitles"===t[i].kind&&r.push(t[i]);return r}(r.media.textTracks),i=0;i<t.length;i++)"showing"===t[i].mode&&(e=i);r.subtitleTrack=e}})}},{key:"onMediaDetaching",value:function e(){this.media=void 0}},{key:"onManifestLoading",value:function e(){this.tracks=[],this.trackId=-1}},{key:"onManifestLoaded",value:function e(t){var r=this,i=t.subtitles||[],a=!1;this.tracks=i,this.trackId=-1,this.hls.trigger(n.default.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:i}),i.forEach(function(e){e.default&&(r.subtitleTrack=e.id,a=!0)})}},{key:"onTick",value:function e(){var t=this.trackId,r=this.tracks[t];if(r){var i=r.details;(void 0===i||!0===i.live)&&(l.logger.log("(re)loading playlist for subtitle track "+t),this.hls.trigger(n.default.SUBTITLE_TRACK_LOADING,{url:r.url,id:t}))}}},{key:"onSubtitleTrackLoaded",value:function e(t){var r=this;t.id<this.tracks.length&&(l.logger.log("subtitle track "+t.id+" loaded"),this.tracks[t.id].details=t.details,t.details.live&&!this.timer&&(this.timer=setInterval(function(){r.onTick()},1e3*t.details.targetduration,this)),!t.details.live&&this.timer&&(clearInterval(this.timer),this.timer=null))}},{key:"setSubtitleTrackInternal",value:function e(t){if(t>=0&&t<this.tracks.length){this.timer&&(clearInterval(this.timer),this.timer=null),this.trackId=t,l.logger.log("switching to subtitle track "+t);var r=this.tracks[t];this.hls.trigger(n.default.SUBTITLE_TRACK_SWITCH,{id:t});var i=r.details;(void 0===i||!0===i.live)&&(l.logger.log("(re)loading playlist for subtitle track "+t),this.hls.trigger(n.default.SUBTITLE_TRACK_LOADING,{url:r.url,id:t}))}}},{key:"subtitleTracks",get:function e(){return this.tracks}},{key:"subtitleTrack",get:function e(){return this.trackId},set:function e(t){this.trackId!==t&&this.setSubtitleTrackInternal(t)}}]),t}(o.default);r.default=d},{32:32,33:33,51:51}],16:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=e(33),n=c(a),s=e(32),o=c(s),l=e(47),u=c(l),d=e(55),f=c(d),$=e(51);function c(e){return e&&e.__esModule?e:{default:e}}function h(e){if(e&&e.cues)for(;e.cues.length>0;)e.removeCue(e.cues[0])}function g(e,t,r,i){return Math.min(t,i)-Math.max(e,r)}var v=function(e){function t(e){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var r=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n.default.MEDIA_ATTACHING,n.default.MEDIA_DETACHING,n.default.FRAG_PARSING_USERDATA,n.default.MANIFEST_LOADING,n.default.MANIFEST_LOADED,n.default.FRAG_LOADED,n.default.LEVEL_SWITCHING,n.default.INIT_PTS_FOUND));if(r.hls=e,r.config=e.config,r.enabled=!0,r.Cues=e.config.cueHandler,r.textTracks=[],r.tracks=[],r.unparsedVttFrags=[],r.initPTS=void 0,r.cueRanges=[],r.config.enableCEA708Captions){var i=r,a=function e(t,r){var i=null;try{i=new window.Event("addtrack")}catch(a){(i=document.createEvent("Event")).initEvent("addtrack",!1,!1)}i.track=t,r.dispatchEvent(i)};r.cea608Parser=new u.default(0,{newCue:function e(t,r,n){if(!i.textTrack1){var s=i.getExistingTrack("1");if(s)i.textTrack1=s,h(i.textTrack1),a(i.textTrack1,i.media);else{var o=i.createTextTrack("captions",i.config.captionsTextTrack1Label,i.config.captionsTextTrack1LanguageCode);o&&(o.textTrack1=!0,i.textTrack1=o)}}i.addCues("textTrack1",t,r,n)}},{newCue:function e(t,r,n){if(!i.textTrack2){var s=i.getExistingTrack("2");if(s)i.textTrack2=s,h(i.textTrack2),a(i.textTrack2,i.media);else{var o=i.createTextTrack("captions",i.config.captionsTextTrack2Label,i.config.captionsTextTrack1LanguageCode);o&&(o.textTrack2=!0,i.textTrack2=o)}}i.addCues("textTrack2",t,r,n)}})}return r}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),i(t,[{key:"addCues",value:function e(t,r,i,a){for(var n=this.cueRanges,s=!1,o=n.length;o--;){var l=n[o],u=g(l[0],l[1],r,i);if(u>=0&&(l[0]=Math.min(l[0],r),l[1]=Math.max(l[1],i),s=!0,u/(i-r)>.5))return}s||n.push([r,i]),this.Cues.newCue(this[t],r,i,a)}},{key:"onInitPtsFound",value:function e(t){var r=this;void 0===this.initPTS&&(this.initPTS=t.initPTS),this.unparsedVttFrags.length&&(this.unparsedVttFrags.forEach(function(e){r.onFragLoaded(e)}),this.unparsedVttFrags=[])}},{key:"getExistingTrack",value:function e(t){var r=this.media;if(r)for(var i=0;i<r.textTracks.length;i++){var a=r.textTracks[i];if(!0===a["textTrack"+t])return a}return null}},{key:"createTextTrack",value:function e(t,r,i){var a=this.media;if(a)return a.addTextTrack(t,r,i)}},{key:"destroy",value:function e(){o.default.prototype.destroy.call(this)}},{key:"onMediaAttaching",value:function e(t){this.media=t.media}},{key:"onMediaDetaching",value:function e(){h(this.textTrack1),h(this.textTrack2)}},{key:"onManifestLoading",value:function e(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0};var t=this.media;if(t){var r=t.textTracks;if(r)for(var i=0;i<r.length;i++)h(r[i])}}},{key:"onManifestLoaded",value:function e(t){var r=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=void 0,this.cueRanges=[],this.config.enableWebVTT){this.tracks=t.subtitles||[];var i=this.media?this.media.textTracks:[];this.tracks.forEach(function(e,t){var a=void 0;if(t<i.length){var n,s,o=i[t];n=o,s=e,n&&n.label===s.name&&!(n.textTrack1||n.textTrack2)&&(a=o)}a||(a=r.createTextTrack("subtitles",e.name,e.lang)),a.mode=e.default?"showing":"hidden",r.textTracks.push(a)})}}},{key:"onLevelSwitching",value:function e(){this.enabled="NONE"!==this.hls.currentLevel.closedCaptions}},{key:"onFragLoaded",value:function e(t){var r=t.frag,i=t.payload;if("main"===r.type){var a=r.sn;a!==this.lastSn+1&&this.cea608Parser.reset(),this.lastSn=a}else if("subtitle"===r.type){if(i.byteLength){if(void 0===this.initPTS){this.unparsedVttFrags.push(t);return}var s=this.vttCCs;s[r.cc]||(s[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc);var o=this.textTracks,l=this.hls;f.default.parse(i,this.initPTS,s,r.cc,function(e){e.forEach(function(e){o[r.trackId].addCue(e)}),l.trigger(n.default.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:r})},function(e){$.logger.log("Failed to parse VTT cue: "+e),l.trigger(n.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r})})}else this.hls.trigger(n.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r})}}},{key:"onFragParsingUserdata",value:function e(t){if(this.enabled&&this.config.enableCEA708Captions)for(var r=0;r<t.samples.length;r++){var i=this.extractCea608Data(t.samples[r].bytes);this.cea608Parser.addData(t.samples[r].pts,i)}}},{key:"extractCea608Data",value:function e(t){for(var r,i,a,n,s,o=31&t[0],l=2,u=[],d=0;d<o;d++)r=t[l++],i=127&t[l++],a=127&t[l++],n=(4&r)!=0,s=3&r,(0!==i||0!==a)&&n&&0===s&&(u.push(i),u.push(a));return u}}]),t}(o.default);r.default=v},{32:32,33:33,47:47,51:51,55:55}],17:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=function(){function e(t,r){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.subtle=t,this.aesIV=r}return i(e,[{key:"decrypt",value:function e(t,r){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},r,t)}}]),e}();r.default=a},{}],18:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=function(){function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}return i(e,[{key:"uint8ArrayToUint32Array_",value:function e(t){for(var r=new DataView(t),i=new Uint32Array(4),a=0;a<4;a++)i[a]=r.getUint32(4*a);return i}},{key:"initTable",value:function e(){var t=this.sBox,r=this.invSBox,i=this.subMix,a=i[0],n=i[1],s=i[2],o=i[3],l=this.invSubMix,u=l[0],d=l[1],f=l[2],$=l[3],c=new Uint32Array(256),h=0,g=0,v=0;for(v=0;v<256;v++)v<128?c[v]=v<<1:c[v]=v<<1^283;for(v=0;v<256;v++){var p=g^g<<1^g<<2^g<<3^g<<4;p=p>>>8^255&p^99,t[h]=p,r[p]=h;var x=c[h],y=c[x],m=c[y],_=257*c[p]^16843008*p;a[h]=_<<24|_>>>8,n[h]=_<<16|_>>>16,s[h]=_<<8|_>>>24,o[h]=_,_=16843009*m^65537*y^257*x^16843008*h,u[p]=_<<24|_>>>8,d[p]=_<<16|_>>>16,f[p]=_<<8|_>>>24,$[p]=_,h?(h=x^c[c[c[m^x]]],g^=c[c[g]]):h=g=1}}},{key:"expandKey",value:function e(t){for(var r=this.uint8ArrayToUint32Array_(t),i=!0,a=0;a<r.length&&i;)i=r[a]===this.key[a],a++;if(!i){this.key=r;var n=this.keySize=r.length;if(4!==n&&6!==n&&8!==n)throw Error("Invalid aes key size="+n);var s=this.ksRows=(n+6+1)*4,o=void 0,l=void 0,u=this.keySchedule=new Uint32Array(s),d=this.invKeySchedule=new Uint32Array(s),f=this.sBox,$=this.rcon,c=this.invSubMix,h=c[0],g=c[1],v=c[2],p=c[3],x=void 0,y=void 0;for(o=0;o<s;o++){if(o<n){x=u[o]=r[o];continue}y=x,o%n==0?(y=f[(y=y<<8|y>>>24)>>>24]<<24|f[y>>>16&255]<<16|f[y>>>8&255]<<8|f[255&y],y^=$[o/n|0]<<24):n>6&&o%n==4&&(y=f[y>>>24]<<24|f[y>>>16&255]<<16|f[y>>>8&255]<<8|f[255&y]),u[o]=x=(u[o-n]^y)>>>0}for(l=0;l<s;l++)o=s-l,y=3&l?u[o]:u[o-4],l<4||o<=4?d[l]=y:d[l]=h[f[y>>>24]]^g[f[y>>>16&255]]^v[f[y>>>8&255]]^p[f[255&y]],d[l]=d[l]>>>0}}},{key:"networkToHostOrderSwap",value:function e(t){return t<<24|(65280&t)<<8|(16711680&t)>>8|t>>>24}},{key:"decrypt",value:function e(t,r,i){for(var a,n,s=this.keySize+6,o=this.invKeySchedule,l=this.invSBox,u=this.invSubMix,d=u[0],f=u[1],$=u[2],c=u[3],h=this.uint8ArrayToUint32Array_(i),g=h[0],v=h[1],p=h[2],x=h[3],y=new Int32Array(t),m=new Int32Array(y.length),_=void 0,E=void 0,T=void 0,b=void 0,k=void 0,R=void 0,S=void 0,A=void 0,L=void 0,D=void 0,F=void 0,w=void 0,I=this.networkToHostOrderSwap;r<y.length;){for(n=1,L=I(y[r]),D=I(y[r+1]),F=I(y[r+2]),w=I(y[r+3]),k=L^o[0],R=w^o[1],S=F^o[2],A=D^o[3],a=4;n<s;n++)_=d[k>>>24]^f[R>>16&255]^$[S>>8&255]^c[255&A]^o[a],E=d[R>>>24]^f[S>>16&255]^$[A>>8&255]^c[255&k]^o[a+1],T=d[S>>>24]^f[A>>16&255]^$[k>>8&255]^c[255&R]^o[a+2],b=d[A>>>24]^f[k>>16&255]^$[R>>8&255]^c[255&S]^o[a+3],k=_,R=E,S=T,A=b,a+=4;_=l[k>>>24]<<24^l[R>>16&255]<<16^l[S>>8&255]<<8^l[255&A]^o[a],E=l[R>>>24]<<24^l[S>>16&255]<<16^l[A>>8&255]<<8^l[255&k]^o[a+1],T=l[S>>>24]<<24^l[A>>16&255]<<16^l[k>>8&255]<<8^l[255&R]^o[a+2],b=l[A>>>24]<<24^l[k>>16&255]<<16^l[R>>8&255]<<8^l[255&S]^o[a+3],a+=3,m[r]=I(_^g),m[r+1]=I(b^v),m[r+2]=I(T^p),m[r+3]=I(E^x),g=L,v=D,p=F,x=w,r+=4}return m.buffer}},{key:"destroy",value:function e(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0}}]),e}();r.default=a},{}],19:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=e(17),n=$(a),s=e(20),o=$(s),l=e(18),u=$(l),d=e(31),f=e(51);function $(e){return e&&e.__esModule?e:{default:e}}var c=function(){function e(t,r){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.observer=t,this.config=r,this.logEnabled=!0;try{var i=crypto||self.crypto;this.subtle=i.subtle||i.webkitSubtle}catch(a){}this.disableWebCrypto=!this.subtle}return i(e,[{key:"isSync",value:function e(){return this.disableWebCrypto&&this.config.enableSoftwareAES}},{key:"decrypt",value:function e(t,r,i,a){var s=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(f.logger.log("JS AES decrypt"),this.logEnabled=!1);var l=this.decryptor;l||(this.decryptor=l=new u.default),l.expandKey(r),a(l.decrypt(t,0,i))}else{this.logEnabled&&(f.logger.log("WebCrypto AES decrypt"),this.logEnabled=!1);var d=this.subtle;this.key!==r&&(this.key=r,this.fastAesKey=new o.default(d,r)),this.fastAesKey.expandKey().then(function(e){new n.default(d,i).decrypt(t,e).catch(function(e){s.onWebCryptoError(e,t,r,i,a)}).then(function(e){a(e)})}).catch(function(e){s.onWebCryptoError(e,t,r,i,a)})}}},{key:"onWebCryptoError",value:function e(t,r,i,a,n){this.config.enableSoftwareAES?(f.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(r,i,a,n)):(f.logger.error("decrypting error : "+t.message),this.observer.trigger(Event.ERROR,{type:d.ErrorTypes.MEDIA_ERROR,details:d.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:t.message}))}},{key:"destroy",value:function e(){var t=this.decryptor;t&&(t.destroy(),this.decryptor=void 0)}}]),e}();r.default=c},{17:17,18:18,20:20,31:31,51:51}],20:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=function(){function e(t,r){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.subtle=t,this.key=r}return i(e,[{key:"expandKey",value:function e(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}]),e}();r.default=a},{}],21:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=e(22),n=u(a),s=e(51),o=e(27),l=u(o);function u(e){return e&&e.__esModule?e:{default:e}}var d=function(){function e(t,r,i){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.observer=t,this.config=i,this.remuxer=r}return i(e,[{key:"resetInitSegment",value:function e(t,r,i,a){this._aacTrack={container:"audio/adts",type:"audio",id:-1,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:r,duration:a,inputTimeScale:9e4}}},{key:"resetTimeStamp",value:function e(){}},{key:"append",value:function e(t,r,i,a){var o,u,d,f,$,c,h,g,v,p,x=new l.default(t),y=90*x.timeStamp;for(o=this._aacTrack,c=x.length,v=t.length;c<v-1&&(255!==t[c]||(240&t[c+1])!=240);c++);for(o.samplerate||(u=n.default.getAudioConfig(this.observer,t,c,o.manifestCodec),o.config=u.config,o.samplerate=u.samplerate,o.channelCount=u.channelCount,o.codec=u.codec,s.logger.log("parsed codec:"+o.codec+",rate:"+u.samplerate+",nb channel:"+u.channelCount)),$=0,f=9216e4/o.samplerate;c+5<v;)if(h=1&t[c+1]?7:9,d=(3&t[c+3])<<11|t[c+4]<<3|(224&t[c+5])>>>5,(d-=h)>0&&c+h+d<=v)for(g=y+$*f,p={unit:t.subarray(c+h,c+h+d),pts:g,dts:g},o.samples.push(p),o.len+=d,c+=d+h,$++;c<v-1&&(255!==t[c]||(240&t[c+1])!=240);c++);else break;this.remuxer.remux(o,{samples:[]},{samples:[{pts:y,dts:y,unit:x.payload}],inputTimeScale:9e4},{samples:[]},r,i,a)}},{key:"destroy",value:function e(){}}],[{key:"probe",value:function e(t){var r,i,a=new l.default(t);if(a.hasTimeStamp){for(r=a.length,i=t.length;r<i-1;r++)if(255===t[r]&&(240&t[r+1])==240)return!0}return!1}}]),e}();r.default=d},{22:22,27:27,51:51}],22:[function(e,t,r){"use strict";var i=e(51),a=e(31);t.exports={getAudioConfig:function e(t,r,n,s){var o,l,u,d,f,$=navigator.userAgent.toLowerCase(),c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];if(o=((192&r[n+2])>>>6)+1,(l=(60&r[n+2])>>>2)>c.length-1){t.trigger(Event.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+l});return}return d=(1&r[n+2])<<2,d|=(192&r[n+3])>>>6,i.logger.log("manifest codec:"+s+",ADTS data:type:"+o+",sampleingIndex:"+l+"["+c[l]+"Hz],channelConfig:"+d),/firefox/i.test($)?l>=6?(o=5,f=[,,,,],u=l-3):(o=2,f=[,,],u=l):-1!==$.indexOf("android")?(o=2,f=[,,],u=l):(o=5,f=[,,,,],s&&(-1!==s.indexOf("mp4a.40.29")||-1!==s.indexOf("mp4a.40.5"))||!s&&l>=6?u=l-3:((s&&-1!==s.indexOf("mp4a.40.2")&&l>=6&&1===d||!s&&1===d)&&(o=2,f=[,,]),u=l)),f[0]=o<<3,f[0]|=(14&l)>>1,f[1]|=(1&l)<<7,f[1]|=d<<3,5===o&&(f[1]|=(14&u)>>1,f[2]=(1&u)<<7,f[2]|=8,f[3]=0),{config:f,samplerate:c[l],channelCount:d,codec:"mp4a.40."+o,manifestCodec:s}}}},{31:31,51:51}],23:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=e(33),n=y(a),s=e(31),o=e(19),l=y(o),u=e(21),d=y(u),f=e(28),$=y(f),c=e(30),h=y(c),g=e(43),v=y(g),p=e(44),x=y(p);function y(e){return e&&e.__esModule?e:{default:e}}var m=function(){function e(t,r,i,a){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.observer=t,this.typeSupported=r,this.config=i,this.vendor=a}return i(e,[{key:"destroy",value:function e(){var t=this.demuxer;t&&t.destroy()}},{key:"push",value:function e(t,r,i,a,s,o,u,d,f,$,c,h){if(t.byteLength>0&&null!=r&&null!=r.key&&"AES-128"===r.method){var g,v=this.decrypter;null==v&&(v=this.decrypter=new l.default(this.observer,this.config));var p=this;try{g=performance.now()}catch(x){g=Date.now()}v.decrypt(t,r.key.buffer,r.iv.buffer,function(e){var t;try{t=performance.now()}catch(l){t=Date.now()}p.observer.trigger(n.default.FRAG_DECRYPTED,{stats:{tstart:g,tdecrypt:t}}),p.pushDecrypted(new Uint8Array(e),r,new Uint8Array(i),a,s,o,u,d,f,$,c,h)})}else this.pushDecrypted(new Uint8Array(t),r,new Uint8Array(i),a,s,o,u,d,f,$,c,h)}},{key:"pushDecrypted",value:function e(t,r,i,a,o,l,u,f,c,g,p,y){var m=this.demuxer;if(!m||u&&!this.probe(t)){var _=this.observer,E=this.typeSupported,T=this.config,b=[{demux:h.default,remux:v.default},{demux:d.default,remux:v.default},{demux:$.default,remux:x.default}];for(var k in b){var R=b[k],S=R.demux.probe;if(S(t)){var A=this.remuxer=new R.remux(_,T,E,this.vendor);m=new R.demux(_,A,T,E),this.probe=S;break}}if(!m){_.trigger(n.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});return}this.demuxer=m}var L=this.remuxer;(u||f)&&(m.resetInitSegment(i,a,o,g),L.resetInitSegment()),u&&(m.resetTimeStamp(),L.resetTimeStamp(y)),"function"==typeof m.setDecryptData&&m.setDecryptData(r),m.append(t,l,c,p)}}]),e}();r.default=m},{19:19,21:21,28:28,30:30,31:31,33:33,43:43,44:44}],24:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=e(23),a=d(i),n=e(33),s=d(n),o=e(51),l=e(1),u=d(l);function d(e){return e&&e.__esModule?e:{default:e}}var f=function e(t){var r=new u.default;r.trigger=function e(t){for(var i=arguments.length,a=Array(i>1?i-1:0),n=1;n<i;n++)a[n-1]=arguments[n];r.emit.apply(r,[t,t].concat(a))},r.off=function e(t){for(var i=arguments.length,a=Array(i>1?i-1:0),n=1;n<i;n++)a[n-1]=arguments[n];r.removeListener.apply(r,[t].concat(a))};var i=function e(r,i){t.postMessage({event:r,data:i})};t.addEventListener("message",function(e){var n=e.data;switch(n.cmd){case"init":var s=JSON.parse(n.config);t.demuxer=new a.default(r,n.typeSupported,s,n.vendor);try{(0,o.enableLogs)(!0===s.debug)}catch(l){console.warn("demuxerWorker: unable to enable logs")}i("init",null);break;case"demux":t.demuxer.push(n.data,n.decryptdata,n.initSegment,n.audioCodec,n.videoCodec,n.timeOffset,n.discontinuity,n.trackSwitch,n.contiguous,n.duration,n.accurateTimeOffset,n.defaultInitPTS)}}),r.on(s.default.FRAG_DECRYPTED,i),r.on(s.default.FRAG_PARSING_INIT_SEGMENT,i),r.on(s.default.FRAG_PARSED,i),r.on(s.default.ERROR,i),r.on(s.default.FRAG_PARSING_METADATA,i),r.on(s.default.FRAG_PARSING_USERDATA,i),r.on(s.default.INIT_PTS_FOUND,i),r.on(s.default.FRAG_PARSING_DATA,function(e,r){var i=[],a={event:e,data:r};r.data1&&(a.data1=r.data1.buffer,i.push(r.data1.buffer),delete r.data1),r.data2&&(a.data2=r.data2.buffer,i.push(r.data2.buffer),delete r.data2),t.postMessage(a,i)})};r.default=f},{1:1,23:23,33:33,51:51}],25:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=e(33),n=h(a),s=e(23),o=h(s),l=e(24),u=h(l),d=e(51),f=e(31),$=e(1),c=h($);function h(e){return e&&e.__esModule?e:{default:e}}var g=function(){function t(r,i){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t),this.hls=r,this.id=i;var a=this.observer=new c.default,s=r.config;a.trigger=function e(t){for(var r=arguments.length,i=Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];a.emit.apply(a,[t,t].concat(i))},a.off=function e(t){for(var r=arguments.length,i=Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];a.removeListener.apply(a,[t].concat(i))};var l=(function(e,t){(t=t||{}).frag=this.frag,t.id=this.id,r.trigger(e,t)}).bind(this);a.on(n.default.FRAG_DECRYPTED,l),a.on(n.default.FRAG_PARSING_INIT_SEGMENT,l),a.on(n.default.FRAG_PARSING_DATA,l),a.on(n.default.FRAG_PARSED,l),a.on(n.default.ERROR,l),a.on(n.default.FRAG_PARSING_METADATA,l),a.on(n.default.FRAG_PARSING_USERDATA,l),a.on(n.default.INIT_PTS_FOUND,l);var $={mp4:MediaSource.isTypeSupported("video/mp4"),mpeg:MediaSource.isTypeSupported("audio/mpeg"),mp3:MediaSource.isTypeSupported('audio/mp4; codecs="mp3"')},h=navigator.vendor;if(s.enableWorker&&"undefined"!=typeof Worker){d.logger.log("demuxing in webworker");var g=void 0;try{var v=e(3);g=this.w=v(u.default),this.onwmsg=this.onWorkerMessage.bind(this),g.addEventListener("message",this.onwmsg),g.onerror=function(e){r.trigger(n.default.ERROR,{type:f.ErrorTypes.OTHER_ERROR,details:f.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:e.message+" ("+e.filename+":"+e.lineno+")"}})},g.postMessage({cmd:"init",typeSupported:$,vendor:h,id:i,config:JSON.stringify(s)})}catch(p){d.logger.error("error while initializing DemuxerWorker, fallback on DemuxerInline"),g&&URL.revokeObjectURL(g.objectURL),this.demuxer=new o.default(a,$,s,h),this.w=void 0}}else this.demuxer=new o.default(a,$,s,h)}return i(t,[{key:"destroy",value:function e(){var t=this.w;if(t)t.removeEventListener("message",this.onwmsg),t.terminate(),this.w=null;else{var r=this.demuxer;r&&(r.destroy(),this.demuxer=null)}var i=this.observer;i&&(i.removeAllListeners(),this.observer=null)}},{key:"push",value:function e(t,r,i,a,n,s,o,l){var u=this.w,f=isNaN(n.startDTS)?n.start:n.startDTS,$=n.decryptdata,c=this.frag,h=!(c&&n.cc===c.cc),g=!(c&&n.level===c.level),v=c&&n.sn===c.sn+1,p=!g&&v;if(h&&d.logger.log(this.id+":discontinuity detected"),g&&d.logger.log(this.id+":switch detected"),this.frag=n,u)u.postMessage({cmd:"demux",data:t,decryptdata:$,initSegment:r,audioCodec:i,videoCodec:a,timeOffset:f,discontinuity:h,trackSwitch:g,contiguous:p,duration:s,accurateTimeOffset:o,defaultInitPTS:l},[t]);else{var x=this.demuxer;x&&x.push(t,$,r,i,a,f,h,g,p,s,o,l)}}},{key:"onWorkerMessage",value:function e(t){var r=t.data,i=this.hls;switch(r.event){case"init":URL.revokeObjectURL(this.w.objectURL);break;case n.default.FRAG_PARSING_DATA:r.data.data1=new Uint8Array(r.data1),r.data2&&(r.data.data2=new Uint8Array(r.data2));default:r.data=r.data||{},r.data.frag=this.frag,r.data.id=this.id,i.trigger(r.event,r.data)}}}]),t}();r.default=g},{1:1,23:23,24:24,3:3,31:31,33:33,51:51}],26:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=e(51),n=function(){function e(t){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}return i(e,[{key:"loadWord",value:function e(){var t=this.data,r=this.bytesAvailable,i=t.byteLength-r,a=new Uint8Array(4),n=Math.min(4,r);if(0===n)throw Error("no bytes available");a.set(t.subarray(i,i+n)),this.word=new DataView(a.buffer).getUint32(0),this.bitsAvailable=8*n,this.bytesAvailable-=n}},{key:"skipBits",value:function e(t){var r;this.bitsAvailable>t?(this.word<<=t,this.bitsAvailable-=t):(t-=this.bitsAvailable,r=t>>3,t-=r>>3,this.bytesAvailable-=r,this.loadWord(),this.word<<=t,this.bitsAvailable-=t)}},{key:"readBits",value:function e(t){var r=Math.min(this.bitsAvailable,t),i=this.word>>>32-r;return(t>32&&a.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=r,this.bitsAvailable>0?this.word<<=r:this.bytesAvailable>0&&this.loadWord(),(r=t-r)>0&&this.bitsAvailable)?i<<r|this.readBits(r):i}},{key:"skipLZ",value:function e(){var t;for(t=0;t<this.bitsAvailable;++t)if(0!=(this.word&2147483648>>>t))return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()}},{key:"skipUEG",value:function e(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function e(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function e(){var t=this.skipLZ();return this.readBits(t+1)-1}},{key:"readEG",value:function e(){var t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)}},{key:"readBoolean",value:function e(){return 1===this.readBits(1)}},{key:"readUByte",value:function e(){return this.readBits(8)}},{key:"readUShort",value:function e(){return this.readBits(16)}},{key:"readUInt",value:function e(){return this.readBits(32)}},{key:"skipScalingList",value:function e(t){var r,i,a=8,n=8;for(r=0;r<t;r++)0!==n&&(n=(a+(i=this.readEG())+256)%256),a=0===n?a:n}},{key:"readSPS",value:function e(){var t,r,i,a,n,s,o,l,u,d=0,f=0,$=0,c=0,h=this.readUByte.bind(this),g=this.readBits.bind(this),v=this.readUEG.bind(this),p=this.readBoolean.bind(this),x=this.skipBits.bind(this),y=this.skipEG.bind(this),m=this.skipUEG.bind(this),_=this.skipScalingList.bind(this);if(h(),t=h(),r=g(5),x(3),i=h(),m(),100===t||110===t||122===t||244===t||44===t||83===t||86===t||118===t||128===t){var E=v();if(3===E&&x(1),m(),m(),x(1),p())for(u=0,l=3!==E?8:12;u<l;u++)p()&&_(u<6?16:64)}m();var T=v();if(0===T)v();else if(1===T)for(x(1),y(),y(),a=v(),u=0;u<a;u++)y();m(),x(1),n=v(),s=v(),0===(o=g(1))&&x(1),x(1),p()&&(d=v(),f=v(),$=v(),c=v());var b=[1,1];if(p()&&p()){var k=h();switch(k){case 1:b=[1,1];break;case 2:b=[12,11];break;case 3:b=[10,11];break;case 4:b=[16,11];break;case 5:b=[40,33];break;case 6:b=[24,11];break;case 7:b=[20,11];break;case 8:b=[32,11];break;case 9:b=[80,33];break;case 10:b=[18,11];break;case 11:b=[15,11];break;case 12:b=[64,33];break;case 13:b=[160,99];break;case 14:b=[4,3];break;case 15:b=[3,2];break;case 16:b=[2,1];break;case 255:b=[h()<<8|h(),h()<<8|h()]}}return{width:Math.ceil((n+1)*16-2*d-2*f),height:(2-o)*(s+1)*16-(o?2:4)*($+c),pixelRatio:b}}},{key:"readSliceType",value:function e(){return this.readUByte(),this.readUEG(),this.readUEG()}}]),e}();r.default=n},{51:51}],27:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=e(51),n=function(){function e(t){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this._hasTimeStamp=!1;for(var r,i,n,s,o,l,u,d,f=0;;)if(u=this.readUTF(t,f,3),f+=3,"ID3"===u)f+=3,r=127&t[f++],i=127&t[f++],o=(r<<21)+(i<<14)+((n=127&t[f++])<<7)+(s=127&t[f++]),l=f+o,this._parseID3Frames(t,f,l),f=l;else if("3DI"===u)f+=7,a.logger.log("3DI footer found, end: "+f);else{f-=3,(d=f)&&(this.hasTimeStamp||a.logger.warn("ID3 tag found, but no timestamp"),this._length=d,this._payload=t.subarray(0,d));return}}return i(e,[{key:"readUTF",value:function e(t,r,i){var a="",n=r,s=r+i;do a+=String.fromCharCode(t[n++]);while(n<s);return a}},{key:"_parseID3Frames",value:function e(t,r,i){for(var n,s,o,l,u;r+8<=i;)if(n=this.readUTF(t,r,4),r+=4,s=t[r++]<<24+t[r++]<<16+t[r++]<<8+t[r++],l=t[r++]<<8+t[r++],o=r,"PRIV"===n&&"com.apple.streaming.transportStreamTimestamp"===this.readUTF(t,r,44)){r+=44,r+=4;var d=1&t[r++];this._hasTimeStamp=!0,u=((t[r++]<<23)+(t[r++]<<15)+(t[r++]<<7)+t[r++])/45,d&&(u+=47721858.84),u=Math.round(u),a.logger.trace("ID3 timestamp found: "+u),this._timeStamp=u}}},{key:"hasTimeStamp",get:function e(){return this._hasTimeStamp}},{key:"timeStamp",get:function e(){return this._timeStamp}},{key:"length",get:function e(){return this._length}},{key:"payload",get:function e(){return this._payload}}]),e}();r.default=n},{51:51}],28:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i,a,n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=(i=e(33),i&&i.__esModule?i:{default:i}),o=function(){function e(t,r){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.observer=t,this.remuxer=r}return n(e,[{key:"resetTimeStamp",value:function e(){}},{key:"resetInitSegment",value:function t(r,i,a,n){var o=this.initData=e.parseInitSegment(r),l={};o.audio&&(l.audio={container:"audio/mp4",codec:i,initSegment:r}),o.video&&(l.video={container:"video/mp4",codec:a,initSegment:r}),this.observer.trigger(s.default.FRAG_PARSING_INIT_SEGMENT,{tracks:l})}},{key:"append",value:function t(r,i,a,n){var s=this.initData,o=e.startDTS(s,r);this.remuxer.remux(s.audio,s.video,null,null,o,a,n,r)}},{key:"destroy",value:function e(){}}],[{key:"probe",value:function t(r){return!!(r.length>=8)&&["moof","ftyp","styp"].indexOf(e.bin2str(r.subarray(4,8)))>=0}},{key:"bin2str",value:function e(t){return String.fromCharCode.apply(null,t)}},{key:"findBox",value:function t(r,i){var a,n,s,o,l,u=[];if(!i.length)return null;for(a=0;a<r.byteLength;)n=r[a]<<24,n|=r[a+1]<<16,n|=r[a+2]<<8,n|=r[a+3],s=e.bin2str(r.subarray(a+4,a+8)),o=n>1?a+n:r.byteLength,s===i[0]&&(1===i.length?u.push(r.subarray(a+8,o)):(l=e.findBox(r.subarray(a+8,o),i.slice(1))).length&&(u=u.concat(l))),a=o;return u}},{key:"parseInitSegment",value:function t(r){var i=[];return e.findBox(r,["moov","trak"]).forEach(function(t){var r=e.findBox(t,["tkhd"])[0];if(r){var a=r[0],n=0===a?12:20,s=r[n]<<24|r[n+1]<<16|r[n+2]<<8|r[n+3];s=s<0?4294967296+s:s;var o=e.findBox(t,["mdia","mdhd"])[0];if(o){var l=o[n=0===(a=o[0])?12:20]<<24|o[n+1]<<16|o[n+2]<<8|o[n+3],u=e.findBox(t,["mdia","hdlr"])[0];if(u){var d={soun:"audio",vide:"video"}[e.bin2str(u.subarray(8,12))];d&&(i[s]={timescale:l,type:d},i[d]={timescale:l,id:s})}}}}),i}},{key:"startDTS",value:function t(r,i){var a,n,s;return a=e.findBox(i,["moof","traf"]),n=[].concat.apply([],a.map(function(t){return e.findBox(t,["tfhd"]).map(function(i){var a,n,s;return n=r[a=i[4]<<24|i[5]<<16|i[6]<<8|i[7]].timescale||9e4,(s=(s=e.findBox(t,["tfdt"]).map(function(e){var t,r;return t=e[0],r=e[4]<<24|e[5]<<16|e[6]<<8|e[7],1===t&&(r*=4294967296,r+=e[8]<<24|e[9]<<16|e[10]<<8|e[11]),r})[0])||1/0)/n})})),isFinite(s=Math.min.apply(null,n))?s:0}}]),e}();r.default=o},{33:33}],29:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i,a,n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=(i=e(19),i&&i.__esModule?i:{default:i}),o=function(){function e(t,r,i,a){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.decryptdata=i,this.discardEPB=a,this.decrypter=new s.default(t,r)}return n(e,[{key:"decryptBuffer",value:function e(t,r){this.decrypter.decrypt(t,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,r)}},{key:"decryptAacSample",value:function e(t,r,i,a){var n=t[r].unit,s=n.subarray(16,n.length-n.length%16),o=s.buffer.slice(s.byteOffset,s.byteOffset+s.length),l=this;this.decryptBuffer(o,function(e){e=new Uint8Array(e),n.set(e,16),a||l.decryptAacSamples(t,r+1,i)})}},{key:"decryptAacSamples",value:function e(t,r,i){for(;;r++){if(r>=t.length){i();return}if(!(t[r].unit.length<32)){var a=this.decrypter.isSync();if(this.decryptAacSample(t,r,i,a),!a)return}}}},{key:"getAvcEncryptedData",value:function e(t){for(var r=16*Math.floor((t.length-48)/160)+16,i=new Int8Array(r),a=0,n=32;n<=t.length-16;n+=160,a+=16)i.set(t.subarray(n,n+16),a);return i}},{key:"getAvcDecryptedUnit",value:function e(t,r){r=new Uint8Array(r);for(var i=0,a=32;a<=t.length-16;a+=160,i+=16)t.set(r.subarray(i,i+16),a);return t}},{key:"decryptAvcSample",value:function e(t,r,i,a,n,s){var o=this.discardEPB(n.data),l=this.getAvcEncryptedData(o),u=this;this.decryptBuffer(l.buffer,function(e){n.data=u.getAvcDecryptedUnit(o,e),s||u.decryptAvcSamples(t,r,i+1,a)})}},{key:"decryptAvcSamples",value:function e(t,r,i,a){for(;;r++,i=0){if(r>=t.length){a();return}for(var n=t[r].units;!(i>=n.length);i++){var s=n[i];if(!(s.length<=48)&&(1===s.type||5===s.type)){var o=this.decrypter.isSync();if(this.decryptAvcSample(t,r,i,a,s,o),!o)return}}}}}]),e}();r.default=o},{19:19}],30:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=e(22),n=h(a),s=e(33),o=h(s),l=e(26),u=h(l),d=e(29),f=h(d),$=e(51),c=e(31);function h(e){return e&&e.__esModule?e:{default:e}}var g=function(){function e(t,r,i,a){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.observer=t,this.config=i,this.typeSupported=a,this.remuxer=r,this.sampleAes=null}return i(e,[{key:"setDecryptData",value:function e(t){null!=t&&null!=t.key&&"SAMPLE-AES"===t.method?this.sampleAes=new f.default(this.observer,this.config,t,this.discardEPB):this.sampleAes=null}},{key:"resetInitSegment",value:function e(t,r,i,a){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack={container:"video/mp2t",type:"video",id:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,dropped:0},this._audioTrack={container:"video/mp2t",type:"audio",id:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,isAAC:!0},this._id3Track={type:"id3",id:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0},this._txtTrack={type:"text",id:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0},this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=r,this.videoCodec=i,this._duration=a}},{key:"resetTimeStamp",value:function e(){}},{key:"append",value:function e(t,r,i,a){var n,s,l,u,d,f,h=t.length,g=!1;this.contiguous=i;var v=this.pmtParsed,p=this._avcTrack,x=this._audioTrack,y=this._id3Track,m=p.id,_=x.id,E=y.id,T=this._pmtId,b=p.pesData,k=x.pesData,R=y.pesData,S=this._parsePAT,A=this._parsePMT,L=this._parsePES,D=this._parseAVCPES.bind(this),F=this._parseAACPES.bind(this),w=this._parseMPEGPES.bind(this),I=this._parseID3PES.bind(this);for(h-=h%188,n=0;n<h;n+=188)if(71===t[n]){if(s=!!(64&t[n+1]),l=((31&t[n+1])<<8)+t[n+2],(u=(48&t[n+3])>>4)>1){if((d=n+5+t[n+4])===n+188)continue}else d=n+4;switch(l){case m:s&&(b&&(f=L(b))&&D(f,!1),b={data:[],size:0}),b&&(b.data.push(t.subarray(d,n+188)),b.size+=n+188-d);break;case _:s&&(k&&(f=L(k))&&(x.isAAC?F(f):w(f)),k={data:[],size:0}),k&&(k.data.push(t.subarray(d,n+188)),k.size+=n+188-d);break;case E:s&&(R&&(f=L(R))&&I(f),R={data:[],size:0}),R&&(R.data.push(t.subarray(d,n+188)),R.size+=n+188-d);break;case 0:s&&(d+=t[d]+1),T=this._pmtId=S(t,d);break;case T:s&&(d+=t[d]+1);var P=A(t,d,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);(m=P.avc)>0&&(p.id=m),(_=P.audio)>0&&(x.id=_,x.isAAC=P.isAAC),(E=P.id3)>0&&(y.id=E),g&&!v&&($.logger.log("reparse from beginning"),g=!1,n=-188),v=this.pmtParsed=!0;break;case 17:case 8191:break;default:g=!0}}else this.observer.trigger(o.default.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});b&&(f=L(b))?(D(f,!0),p.pesData=null):p.pesData=b,k&&(f=L(k))?(x.isAAC?F(f):w(f),x.pesData=null):(k&&k.size&&$.logger.log("last AAC PES packet truncated,might overlap between fragments"),x.pesData=k),R&&(f=L(R))?(I(f),y.pesData=null):y.pesData=R,null==this.sampleAes?this.remuxer.remux(x,p,y,this._txtTrack,r,i,a):this.decryptAndRemux(x,p,y,this._txtTrack,r,i,a)}},{key:"decryptAndRemux",value:function e(t,r,i,a,n,s,o){if(t.samples&&t.isAAC){var l=this;this.sampleAes.decryptAacSamples(t.samples,0,function(){l.decryptAndRemuxAvc(t,r,i,a,n,s,o)})}else this.decryptAndRemuxAvc(t,r,i,a,n,s,o)}},{key:"decryptAndRemuxAvc",value:function e(t,r,i,a,n,s,o){if(r.samples){var l=this;this.sampleAes.decryptAvcSamples(r.samples,0,0,function(){l.remuxer.remux(t,r,i,a,n,s,o)})}else this.remuxer.remux(t,r,i,a,n,s,o)}},{key:"destroy",value:function e(){this._initPTS=this._initDTS=void 0,this._duration=0}},{key:"_parsePAT",value:function e(t,r){return(31&t[r+10])<<8|t[r+11]}},{key:"_parsePMT",value:function e(t,r,i,a){var n,s,o,l,u={audio:-1,avc:-1,id3:-1,isAAC:!0};for(n=(15&t[r+1])<<8|t[r+2],s=r+3+n-4,o=(15&t[r+10])<<8|t[r+11],r+=12+o;r<s;){switch(l=(31&t[r+1])<<8|t[r+2],t[r]){case 207:if(!a){$.logger.log("unkown stream type:"+t[r]);break}case 15:-1===u.audio&&(u.audio=l);break;case 21:-1===u.id3&&(u.id3=l);break;case 219:if(!a){$.logger.log("unkown stream type:"+t[r]);break}case 27:-1===u.avc&&(u.avc=l);break;case 3:case 4:i?-1===u.audio&&(u.audio=l,u.isAAC=!1):$.logger.log("MPEG audio found, not supported in this browser for now");break;case 36:$.logger.warn("HEVC stream type found, not supported for now");break;default:$.logger.log("unkown stream type:"+t[r])}r+=((15&t[r+3])<<8|t[r+4])+5}return u}},{key:"_parsePES",value:function e(t){var r,i,a,n,s,o,l,u,d,f=0,c=t.data;if(!t||0===t.size)return null;for(;c[0].length<19&&c.length>1;){var h=new Uint8Array(c[0].length+c[1].length);h.set(c[0]),h.set(c[1],c[0].length),c[0]=h,c.splice(1,1)}if(1!==(a=((r=c[0])[0]<<16)+(r[1]<<8)+r[2])||(n=(r[4]<<8)+r[5])&&n>t.size-6)return null;192&(i=r[7])&&((l=(14&r[9])*536870912+(255&r[10])*4194304+(254&r[11])*16384+(255&r[12])*128+(254&r[13])/2)>4294967295&&(l-=8589934592),64&i?((u=(14&r[14])*536870912+(255&r[15])*4194304+(254&r[16])*16384+(255&r[17])*128+(254&r[18])/2)>4294967295&&(u-=8589934592),l-u>54e5&&($.logger.warn(Math.round((l-u)/9e4)+"s delta between PTS and DTS, align them"),l=u)):u=l),d=(s=r[8])+9,t.size-=d,o=new Uint8Array(t.size);for(var g=0,v=c.length;g<v;g++){var p=(r=c[g]).byteLength;if(d){if(d>p){d-=p;continue}r=r.subarray(d),p-=d,d=0}o.set(r,f),f+=p}return n&&(n-=s+3),{data:o,pts:l,dts:u,len:n}}},{key:"pushAccesUnit",value:function e(t,r){if(t.units.length&&t.frame){var i=r.samples,a=i.length;!this.config.forceKeyFrameOnDiscontinuity||!0===t.key||r.sps&&(a||this.contiguous)?(t.id=a,i.push(t)):r.dropped++}t.debug.length&&$.logger.log(t.pts+"/"+t.dts+":"+t.debug)}},{key:"_parseAVCPES",value:function e(t,r){var i,a,n,s=this,o=this._avcTrack,l=this._parseAVCNALu(t.data),d=this.avcSample;t.data=null,l.forEach(function(e){switch(e.type){case 1:a=!0,d.frame=!0;var r=e.data;if(r.length>4){var l=new u.default(r).readSliceType();(2===l||4===l||7===l||9===l)&&(d.key=!0)}break;case 5:a=!0,d||(d=s.avcSample=s._createAVCSample(!0,t.pts,t.dts,"")),d.key=!0,d.frame=!0;break;case 6:a=!0,(i=new u.default(s.discardEPB(e.data))).readUByte();for(var f=0,$=0,c=!1,h=0;!c&&i.bytesAvailable>1;){f=0;do f+=h=i.readUByte();while(255===h);$=0;do $+=h=i.readUByte();while(255===h);if(4===f&&0!==i.bytesAvailable){if(c=!0,181===i.readUByte()&&49===i.readUShort()&&1195456820===i.readUInt()&&3===i.readUByte()){var g=i.readUByte(),v=i.readUByte(),p=31&g,x=[g,v];for(n=0;n<p;n++)x.push(i.readUByte()),x.push(i.readUByte()),x.push(i.readUByte());s._insertSampleInOrder(s._txtTrack.samples,{type:3,pts:t.pts,bytes:x})}}else if($<i.bytesAvailable)for(n=0;n<$;n++)i.readUByte()}break;case 7:if(a=!0,!o.sps){var y=(i=new u.default(e.data)).readSPS();o.width=y.width,o.height=y.height,o.pixelRatio=y.pixelRatio,o.sps=[e.data],o.duration=s._duration;var m=e.data.subarray(1,4),_="avc1.";for(n=0;n<3;n++){var E=m[n].toString(16);E.length<2&&(E="0"+E),_+=E}o.codec=_}break;case 8:a=!0,o.pps||(o.pps=[e.data]);break;case 9:a=!1,d&&s.pushAccesUnit(d,o),d=s.avcSample=s._createAVCSample(!1,t.pts,t.dts,"");break;case 12:a=!1;break;default:a=!1,d&&(d.debug+="unknown NAL "+e.type+" ")}d&&a&&d.units.push(e)}),r&&d&&(this.pushAccesUnit(d,o),this.avcSample=null)}},{key:"_createAVCSample",value:function e(t,r,i,a){return{key:t,pts:r,dts:i,units:[],debug:a}}},{key:"_insertSampleInOrder",value:function e(t,r){var i=t.length;if(i>0){if(r.pts>=t[i-1].pts)t.push(r);else for(var a=i-1;a>=0;a--)if(r.pts<t[a].pts){t.splice(a,0,r);break}}else t.push(r)}},{key:"_getLastNalUnit",value:function e(){var t=this.avcSample,r=void 0;if(!t||0===t.units.length){var i=this._avcTrack.samples;t=i[i.length-1]}if(t){var a=t.units;r=a[a.length-1]}return r}},{key:"_parseAVCNALu",value:function e(t){var r,i,a,n,s,o=0,l=t.byteLength,u=this._avcTrack,d=u.naluState||0,f=d,$=[],c=-1;for(-1===d&&(c=0,s=31&t[0],d=0,o=1);o<l;){if(r=t[o++],!d){d=r?0:1;continue}if(1===d){d=r?0:2;continue}if(r){if(1===r){if(c>=0)a={data:t.subarray(c,o-d-1),type:s},$.push(a);else{var h=this._getLastNalUnit();if(h&&(f&&o<=4-f&&h.state&&(h.data=h.data.subarray(0,h.data.byteLength-f)),(i=o-d-1)>0)){var g=new Uint8Array(h.data.byteLength+i);g.set(h.data,0),g.set(t.subarray(0,i),h.data.byteLength),h.data=g}}o<l?(n=31&t[o],c=o,s=n,d=0):d=-1}else d=0}else d=3}if(c>=0&&d>=0&&(a={data:t.subarray(c,l),type:s,state:d},$.push(a)),0===$.length){var v=this._getLastNalUnit();if(v){var p=new Uint8Array(v.data.byteLength+t.byteLength);p.set(v.data,0),p.set(t,v.data.byteLength),v.data=p}}return u.naluState=d,$}},{key:"discardEPB",value:function e(t){for(var r,i,a=t.byteLength,n=[],s=1;s<a-2;)0===t[s]&&0===t[s+1]&&3===t[s+2]?(n.push(s+2),s+=2):s++;if(0===n.length)return t;r=a-n.length,i=new Uint8Array(r);var o=0;for(s=0;s<r;o++,s++)o===n[0]&&(o++,n.shift()),i[s]=t[o];return i}},{key:"_parseAACPES",value:function e(t){var r,i,a,s,l,u,d,f,h,g,v,p=this._audioTrack,x=t.data,y=t.pts,m=this.aacOverFlow,_=this.aacLastPTS;if(m){var E=new Uint8Array(m.byteLength+x.byteLength);E.set(m,0),E.set(x,m.byteLength),x=E}for(d=0,g=x.length;d<g-1&&(255!==x[d]||(240&x[d+1])!=240);d++);if(!d||(d<g-1?(r="AAC PES did not start with ADTS header,offset:"+d,i=!1):(r="no ADTS header found in AAC PES",i=!0),$.logger.warn("parsing error:"+r),this.observer.trigger(o.default.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.FRAG_PARSING_ERROR,fatal:i,reason:r}),!i)){if(!p.samplerate){var T=this.audioCodec;a=n.default.getAudioConfig(this.observer,x,d,T),p.config=a.config,p.samplerate=a.samplerate,p.channelCount=a.channelCount,p.codec=a.codec,p.manifestCodec=a.manifestCodec,p.duration=this._duration,$.logger.log("parsed codec:"+p.codec+",rate:"+a.samplerate+",nb channel:"+a.channelCount)}if(u=0,l=9216e4/p.samplerate,m&&_){var b=_+l;Math.abs(b-y)>1&&($.logger.log("AAC: align PTS for overlapping frames by "+Math.round((b-y)/90)),y=b)}for(;d+5<g;)if(f=1&x[d+1]?7:9,s=(3&x[d+3])<<11|x[d+4]<<3|(224&x[d+5])>>>5,(s-=f)>0&&d+f+s<=g)for(h=y+u*l,v={unit:x.subarray(d+f,d+f+s),pts:h,dts:h},p.samples.push(v),p.len+=s,d+=s+f,u++;d<g-1&&(255!==x[d]||(240&x[d+1])!=240);d++);else break;m=d<g?x.subarray(d,g):null,this.aacOverFlow=m,this.aacLastPTS=h}}},{key:"_parseMPEGPES",value:function e(t){for(var r,i=t.data,a=t.pts,n=i.length,s=0,o=0;o<n&&(r=this._parseMpeg(i,o,n,s++,a))>0;)o+=r}},{key:"_onMpegFrame",value:function e(t,r,i,a,n,s){var o=s+n*(1152/i*1e3),l=this._audioTrack;l.config=[],l.channelCount=a,l.samplerate=i,l.duration=this._duration,l.samples.push({unit:t,pts:o,dts:o}),l.len+=t.length}},{key:"_onMpegNoise",value:function e(t){$.logger.warn("mpeg audio has noise: "+t.length+" bytes")}},{key:"_parseMpeg",value:function e(t,r,i,a,n){if(r+2>i)return -1;if(255===t[r]||(224&t[r+1])==224){if(r+24>i)return -1;var s=t[r+1]>>3&3,o=t[r+1]>>1&3,l=t[r+2]>>4&15,u=t[r+2]>>2&3,d=!!(2&t[r+2]);if(1!==s&&0!==l&&15!==l&&3!==u){var f=1e3*[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160][14*(3===s?3-o:3===o?3:4)+l-1],$=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3][3*(3===s?0:2===s?1:2)+u],c=d?1:0,h=t[r+3]>>6==3?1:2,g=3===o?(3===s?12:6)*f/$+c<<2:(3===s?144:72)*f/$+c|0;return r+g>i?-1:(this._onMpegFrame&&this._onMpegFrame(t.subarray(r,r+g),f,$,h,a,n),g)}}for(var v=r+2;v<i;){if(255===t[v-1]&&(224&t[v])==224)return this._onMpegNoise&&this._onMpegNoise(t.subarray(r,v-1)),v-r-1;v++}return -1}},{key:"_parseID3PES",value:function e(t){this._id3Track.samples.push(t)}}],[{key:"probe",value:function e(t){return!!(t.length>=564)&&71===t[0]&&71===t[188]&&71===t[376]}}]),e}();r.default=g},{22:22,26:26,29:29,31:31,33:33,51:51}],31:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},r.ErrorDetails={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException",WEBVTT_EXCEPTION:"webVTTException"}},{}],32:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i,a,n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),o=e(51),l=e(31),u=(i=e(33),i&&i.__esModule?i:{default:i}),d=function(){function e(t){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.hls=t,this.onEvent=this.onEvent.bind(this);for(var r=arguments.length,i=Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];this.handledEvents=i,this.useGenericHandler=!0,this.registerListeners()}return s(e,[{key:"destroy",value:function e(){this.unregisterListeners()}},{key:"isEventHandler",value:function e(){return"object"===n(this.handledEvents)&&this.handledEvents.length&&"function"==typeof this.onEvent}},{key:"registerListeners",value:function e(){this.isEventHandler()&&this.handledEvents.forEach((function(e){if("hlsEventGeneric"===e)throw Error("Forbidden event name: "+e);this.hls.on(e,this.onEvent)}).bind(this))}},{key:"unregisterListeners",value:function e(){this.isEventHandler()&&this.handledEvents.forEach((function(e){this.hls.off(e,this.onEvent)}).bind(this))}},{key:"onEvent",value:function e(t,r){this.onEventGeneric(t,r)}},{key:"onEventGeneric",value:function e(t,r){var i=function e(t,r){var i="on"+t.replace("hls","");if("function"!=typeof this[i])throw Error("Event "+t+" has no generic handler in this "+this.constructor.name+" class (tried "+i+")");return this[i].bind(this,r)};try{i.call(this,t,r).call()}catch(a){o.logger.error("internal error happened while processing "+t+":"+a.message),this.hls.trigger(u.default.ERROR,{type:l.ErrorTypes.OTHER_ERROR,details:l.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:t,err:a})}}}]),e}();r.default=d},{31:31,33:33,51:51}],33:[function(e,t,r){"use strict";t.exports={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCH:"hlsLevelSwitch",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCH:"hlsAudioTrackSwitch",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"}},{}],34:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=function(){function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e)}return i(e,null,[{key:"getSilentFrame",value:function e(t,r){if("mp4a.40.2"===t){if(1===r)return new Uint8Array([0,200,0,128,35,128]);if(2===r)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===r)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);else if(4===r)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);else if(5===r)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);else if(6===r)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===r)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===r)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===r)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}}]),e}();r.default=a},{}],35:[function(e,t,r){"use strict";t.exports={isBuffered:function e(t,r){if(t){for(var i=t.buffered,a=0;a<i.length;a++)if(r>=i.start(a)&&r<=i.end(a))return!0}return!1},bufferInfo:function e(t,r,i){if(!t)return{len:0,start:r,end:r,nextStart:void 0};var a,n=t.buffered,s=[];for(a=0;a<n.length;a++)s.push({start:n.start(a),end:n.end(a)});return this.bufferedInfo(s,r,i)},bufferedInfo:function e(t,r,i){var a,n,s,o,l,u=[];for(t.sort(function(e,t){var r=e.start-t.start;return r||t.end-e.end}),l=0;l<t.length;l++){var d=u.length;if(d){var f=u[d-1].end;t[l].start-f<i?t[l].end>f&&(u[d-1].end=t[l].end):u.push(t[l])}else u.push(t[l])}for(l=0,a=0,n=s=r;l<u.length;l++){var $=u[l].start,c=u[l].end;if(r+i>=$&&r<c)n=$,a=(s=c)-r;else if(r+i<$){o=$;break}}return{len:a,start:n,end:s,nextStart:o}}}},{}],36:[function(e,t,r){"use strict";var i=e(51),a={mergeDetails:function e(t,r){var n,s=Math.max(t.startSN,r.startSN)-r.startSN,o=Math.min(t.endSN,r.endSN)-r.startSN,l=r.startSN-t.startSN,u=t.fragments,d=r.fragments,f=0;if(o<s){r.PTSKnown=!1;return}for(var $=s;$<=o;$++){var c=u[l+$],h=d[$];h&&c&&(f=c.cc-h.cc,isNaN(c.startPTS)||(h.start=h.startPTS=c.startPTS,h.endPTS=c.endPTS,h.duration=c.duration,n=h))}if(f)for(i.logger.log("discontinuity sliding from playlist, take drift into account"),$=0;$<d.length;$++)d[$].cc+=f;if(n)a.updateFragPTSDTS(r,n,n.startPTS,n.endPTS,n.startDTS,n.endDTS);else if(l>=0&&l<u.length){var g=u[l].start;for($=0;$<d.length;$++)d[$].start+=g}r.PTSKnown=t.PTSKnown},updateFragPTSDTS:function e(t,r,i,n,s,o){if(!isNaN(r.startPTS)){var l,u,d,f=Math.abs(r.startPTS-i);isNaN(r.deltaPTS)?r.deltaPTS=f:r.deltaPTS=Math.max(f,r.deltaPTS),i=Math.min(i,r.startPTS),n=Math.max(n,r.endPTS),s=Math.min(s,r.startDTS),o=Math.max(o,r.endDTS)}var $=i-r.start;r.start=r.startPTS=i,r.endPTS=n,r.startDTS=s,r.endDTS=o,r.duration=n-i;var c=r.sn;if(!t||c<t.startSN||c>t.endSN)return 0;for(l=c-t.startSN,r=(u=t.fragments)[l],d=l;d>0;d--)a.updatePTS(u,d,d-1);for(d=l;d<u.length-1;d++)a.updatePTS(u,d,d+1);return t.PTSKnown=!0,$},updatePTS:function e(t,r,a){var n=t[r],s=t[a],o=s.startPTS;isNaN(o)?a>r?s.start=n.start+n.duration:s.start=Math.max(n.start-s.duration,0):a>r?(n.duration=o-n.start,n.duration<0&&i.logger.warn("negative duration computed for frag "+n.sn+",level "+n.level+", there should be some duration drift between playlist and fragment!")):(s.duration=n.start-o,s.duration<0&&i.logger.warn("negative duration computed for frag "+s.sn+",level "+s.level+", there should be some duration drift between playlist and fragment!"))}};t.exports=a},{51:51}],37:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=e(2),n=k(a),s=e(33),o=k(s),l=e(31),u=e(41),d=k(u),f=e(39),$=k(f),c=e(40),h=k(c),g=e(13),v=k(g),p=e(12),x=k(p),y=e(11),m=k(y),_=e(51),E=e(1),T=k(E),b=e(4);function k(e){return e&&e.__esModule?e:{default:e}}var R=function(){function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e);var i=e.DefaultConfig;if((r.liveSyncDurationCount||r.liveMaxLatencyDurationCount)&&(r.liveSyncDuration||r.liveMaxLatencyDuration))throw Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var a in i)!(a in r)&&(r[a]=i[a]);if(void 0!==r.liveMaxLatencyDurationCount&&r.liveMaxLatencyDurationCount<=r.liveSyncDurationCount)throw Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==r.liveMaxLatencyDuration&&(r.liveMaxLatencyDuration<=r.liveSyncDuration||void 0===r.liveSyncDuration))throw Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');(0,_.enableLogs)(r.debug),this.config=r,this._autoLevelCapping=-1;var n=this.observer=new T.default;n.trigger=function e(t){for(var r=arguments.length,i=Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];n.emit.apply(n,[t,t].concat(i))},n.off=function e(t){for(var r=arguments.length,i=Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];n.removeListener.apply(n,[t].concat(i))},this.on=n.on.bind(n),this.off=n.off.bind(n),this.trigger=n.trigger.bind(n);var s,o=this.abrController=new r.abrController(this),l=new r.bufferController(this),u=new r.capLevelController(this),f=new r.fpsController(this),c=new d.default(this),g=new $.default(this),p=new h.default(this),y=new m.default(this),E=[this.levelController=new x.default(this),this.streamController=new v.default(this)],b=r.audioStreamController;b&&E.push(new b(this)),this.networkControllers=E;var k=[c,g,p,o,l,u,f,y];if(b=r.audioTrackController){var R=new b(this);this.audioTrackController=R,k.push(R)}if(b=r.subtitleTrackController){var S=new b(this);this.subtitleTrackController=S,k.push(S)}[r.subtitleStreamController,r.timelineController].forEach(function(e){e&&k.push(new e(t))}),this.coreComponents=k}return i(e,null,[{key:"isSupported",value:function e(){return window.MediaSource=window.MediaSource||window.WebKitMediaSource,window.MediaSource&&"function"==typeof window.MediaSource.isTypeSupported&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')}},{key:"version",get:function e(){return"0.7.6"}},{key:"Events",get:function e(){return o.default}},{key:"ErrorTypes",get:function e(){return l.ErrorTypes}},{key:"ErrorDetails",get:function e(){return l.ErrorDetails}},{key:"DefaultConfig",get:function t(){return e.defaultConfig?e.defaultConfig:b.hlsDefaultConfig},set:function t(r){e.defaultConfig=r}}]),i(e,[{key:"destroy",value:function e(){_.logger.log("destroy"),this.trigger(o.default.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(e){e.destroy()}),this.url=null,this.observer.removeAllListeners(),this._autoLevelCapping=-1}},{key:"attachMedia",value:function e(t){_.logger.log("attachMedia"),this.media=t,this.trigger(o.default.MEDIA_ATTACHING,{media:t})}},{key:"detachMedia",value:function e(){_.logger.log("detachMedia"),this.trigger(o.default.MEDIA_DETACHING),this.media=null}},{key:"loadSource",value:function e(t){t=n.default.buildAbsoluteURL(window.location.href,t,{alwaysNormalize:!0}),_.logger.log("loadSource:"+t),this.url=t,this.trigger(o.default.MANIFEST_LOADING,{url:t})}},{key:"startLoad",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;_.logger.log("startLoad("+t+")"),this.networkControllers.forEach(function(e){e.startLoad(t)})}},{key:"stopLoad",value:function e(){_.logger.log("stopLoad"),this.networkControllers.forEach(function(e){e.stopLoad()})}},{key:"swapAudioCodec",value:function e(){_.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}},{key:"recoverMediaError",value:function e(){_.logger.log("recoverMediaError");var t=this.media;this.detachMedia(),this.attachMedia(t)}},{key:"levels",get:function e(){return this.levelController.levels}},{key:"currentLevel",get:function e(){return this.streamController.currentLevel},set:function e(t){_.logger.log("set currentLevel:"+t),this.loadLevel=t,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function e(){return this.streamController.nextLevel},set:function e(t){_.logger.log("set nextLevel:"+t),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function e(){return this.levelController.level},set:function e(t){_.logger.log("set loadLevel:"+t),this.levelController.manualLevel=t}},{key:"nextLoadLevel",get:function e(){return this.levelController.nextLoadLevel},set:function e(t){this.levelController.nextLoadLevel=t}},{key:"firstLevel",get:function e(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function e(t){_.logger.log("set firstLevel:"+t),this.levelController.firstLevel=t}},{key:"startLevel",get:function e(){return this.levelController.startLevel},set:function e(t){_.logger.log("set startLevel:"+t);var r=this;-1!==t&&(t=Math.max(t,r.minAutoLevel)),r.levelController.startLevel=t}},{key:"autoLevelCapping",get:function e(){return this._autoLevelCapping},set:function e(t){_.logger.log("set autoLevelCapping:"+t),this._autoLevelCapping=t}},{key:"autoLevelEnabled",get:function e(){return -1===this.levelController.manualLevel}},{key:"manualLevel",get:function e(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function e(){for(var t=this.levels,r=this.config.minAutoBitrate,i=t?t.length:0,a=0;a<i;a++)if((t[a].realBitrate?Math.max(t[a].realBitrate,t[a].bitrate):t[a].bitrate)>r)return a;return 0}},{key:"maxAutoLevel",get:function e(){var t=this.levels,r=this.autoLevelCapping,i=void 0;return -1===r&&t&&t.length?t.length-1:r}},{key:"nextAutoLevel",get:function e(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function e(t){var r=this;r.abrController.nextAutoLevel=Math.max(r.minAutoLevel,t)}},{key:"audioTracks",get:function e(){var t=this.audioTrackController;return t?t.audioTracks:[]}},{key:"audioTrack",get:function e(){var t=this.audioTrackController;return t?t.audioTrack:-1},set:function e(t){var r=this.audioTrackController;r&&(r.audioTrack=t)}},{key:"liveSyncPosition",get:function e(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function e(){var t=this.subtitleTrackController;return t?t.subtitleTracks:[]}},{key:"subtitleTrack",get:function e(){var t=this.subtitleTrackController;return t?t.subtitleTrack:-1},set:function e(t){var r=this.subtitleTrackController;r&&(r.subtitleTrack=t)}}]),e}();r.default=R},{1:1,11:11,12:12,13:13,2:2,31:31,33:33,39:39,4:4,40:40,41:41,51:51}],38:[function(e,t,r){"use strict";t.exports=e(37).default},{37:37}],39:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=e(33),n=d(a),s=e(32),o=d(s),l=e(31),u=e(51);function d(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(e){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var r=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n.default.FRAG_LOADING));return r.loaders={},r}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),i(t,[{key:"destroy",value:function e(){var t=this.loaders;for(var r in t){var i=t[r];i&&i.destroy()}this.loaders={},o.default.prototype.destroy.call(this)}},{key:"onFragLoading",value:function e(t){var r=t.frag,i=r.type,a=this.loaders[i],n=this.hls.config;r.loaded=0,a&&(u.logger.warn("abort previous fragment loader for type:"+i),a.abort()),a=this.loaders[i]=r.loader=void 0!==n.fLoader?new n.fLoader(n):new n.loader(n);var s=void 0,o=void 0,l=void 0;s={url:r.url,frag:r,responseType:"arraybuffer",progressData:!1};var d=r.byteRangeStartOffset,f=r.byteRangeEndOffset;isNaN(d)||isNaN(f)||(s.rangeStart=d,s.rangeEnd=f),o={timeout:n.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:n.fragLoadingMaxRetryTimeout},l={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},a.load(s,o,l)}},{key:"loadsuccess",value:function e(t,r,i){var a=t.data,s=i.frag;s.loader=void 0,this.loaders[s.type]=void 0,this.hls.trigger(n.default.FRAG_LOADED,{payload:a,frag:s,stats:r})}},{key:"loaderror",value:function e(t,r){var i=r.loader;i&&i.abort(),this.loaders[r.type]=void 0,this.hls.trigger(n.default.ERROR,{type:l.ErrorTypes.NETWORK_ERROR,details:l.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:r.frag,response:t})}},{key:"loadtimeout",value:function e(t,r){var i=r.loader;i&&i.abort(),this.loaders[r.type]=void 0,this.hls.trigger(n.default.ERROR,{type:l.ErrorTypes.NETWORK_ERROR,details:l.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:r.frag})}},{key:"loadprogress",value:function e(t,r,i){var a=r.frag;a.loaded=t.loaded,this.hls.trigger(n.default.FRAG_LOAD_PROGRESS,{frag:a,stats:t})}}]),t}(o.default);r.default=f},{31:31,32:32,33:33,51:51}],40:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=e(33),n=d(a),s=e(32),o=d(s),l=e(31),u=e(51);function d(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(e){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var r=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n.default.KEY_LOADING));return r.loaders={},r.decryptkey=null,r.decrypturl=null,r}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),i(t,[{key:"destroy",value:function e(){for(var t in this.loaders){var r=this.loaders[t];r&&r.destroy()}this.loaders={},o.default.prototype.destroy.call(this)}},{key:"onKeyLoading",value:function e(t){var r=t.frag,i=r.type,a=this.loaders[i],s=r.decryptdata,o=s.uri;if(o!==this.decrypturl||null===this.decryptkey){var l=this.hls.config;a&&(u.logger.warn("abort previous key loader for type:"+i),a.abort()),r.loader=this.loaders[i]=new l.loader(l),this.decrypturl=o,this.decryptkey=null;var d=void 0,f=void 0,$=void 0;d={url:o,frag:r,responseType:"arraybuffer"},f={timeout:l.fragLoadingTimeOut,maxRetry:l.fragLoadingMaxRetry,retryDelay:l.fragLoadingRetryDelay,maxRetryDelay:l.fragLoadingMaxRetryTimeout},$={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},r.loader.load(d,f,$)}else this.decryptkey&&(s.key=this.decryptkey,this.hls.trigger(n.default.KEY_LOADED,{frag:r}))}},{key:"loadsuccess",value:function e(t,r,i){var a=i.frag;this.decryptkey=a.decryptdata.key=new Uint8Array(t.data),a.loader=void 0,this.loaders[a.type]=void 0,this.hls.trigger(n.default.KEY_LOADED,{frag:a})}},{key:"loaderror",value:function e(t,r){var i=r.frag,a=i.loader;a&&a.abort(),this.loaders[r.type]=void 0,this.hls.trigger(n.default.ERROR,{type:l.ErrorTypes.NETWORK_ERROR,details:l.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:i,response:t})}},{key:"loadtimeout",value:function e(t,r){var i=r.frag,a=i.loader;a&&a.abort(),this.loaders[r.type]=void 0,this.hls.trigger(n.default.ERROR,{type:l.ErrorTypes.NETWORK_ERROR,details:l.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:i})}}]),t}(o.default);r.default=f},{31:31,32:32,33:33,51:51}],41:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=e(2),n=h(a),s=e(33),o=h(s),l=e(32),u=h(l),d=e(31),f=e(45),$=h(f),c=e(51);function h(e){return e&&e.__esModule?e:{default:e}}function g(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}var v=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,p=/#EXT-X-MEDIA:(.*)/g,x=/#EXTINF:(\d*(?:\.\d+)?)(?:,(.*))?|(?!#)(\S.+)|#EXT-X-BYTERANGE: *(.+)|#EXT-X-PROGRAM-DATE-TIME:(.+)|#.*/g,y=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)(.*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,m=function(){function e(){g(this,e),this.method=null,this.key=null,this.iv=null,this._uri=null}return i(e,[{key:"uri",get:function e(){return!this._uri&&this.reluri&&(this._uri=n.default.buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}]),e}(),_=function(){function e(){g(this,e),this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[]}return i(e,[{key:"createInitializationVector",value:function e(t){for(var r=new Uint8Array(16),i=12;i<16;i++)r[i]=t>>8*(15-i)&255;return r}},{key:"fragmentDecryptdataFromLevelkey",value:function e(t,r){var i=t;return t&&t.method&&t.uri&&!t.iv&&((i=new m).method=t.method,i.baseuri=t.baseuri,i.reluri=t.reluri,i.iv=this.createInitializationVector(r)),i}},{key:"cloneObj",value:function e(t){return JSON.parse(JSON.stringify(t))}},{key:"url",get:function e(){return!this._url&&this.relurl&&(this._url=n.default.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function e(t){this._url=t}},{key:"programDateTime",get:function e(){return!this._programDateTime&&this.rawProgramDateTime&&(this._programDateTime=new Date(Date.parse(this.rawProgramDateTime))),this._programDateTime}},{key:"byteRange",get:function e(){if(!this._byteRange){var t=this._byteRange=[];if(this.rawByteRange){var r=this.rawByteRange.split("@",2);if(1===r.length){var i=this.lastByteRangeEndOffset;t[0]=i||0}else t[0]=parseInt(r[1]);t[1]=parseInt(r[0])+t[0]}}return this._byteRange}},{key:"byteRangeStartOffset",get:function e(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function e(){return this.byteRange[1]}},{key:"decryptdata",get:function e(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata}}]),e}(),E=function(e){function t(e){g(this,t);var r=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o.default.MANIFEST_LOADING,o.default.LEVEL_LOADING,o.default.AUDIO_TRACK_LOADING,o.default.SUBTITLE_TRACK_LOADING));return r.loaders={},r}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),i(t,[{key:"destroy",value:function e(){for(var t in this.loaders){var r=this.loaders[t];r&&r.destroy()}this.loaders={},u.default.prototype.destroy.call(this)}},{key:"onManifestLoading",value:function e(t){this.load(t.url,{type:"manifest"})}},{key:"onLevelLoading",value:function e(t){this.load(t.url,{type:"level",level:t.level,id:t.id})}},{key:"onAudioTrackLoading",value:function e(t){this.load(t.url,{type:"audioTrack",id:t.id})}},{key:"onSubtitleTrackLoading",value:function e(t){this.load(t.url,{type:"subtitleTrack",id:t.id})}},{key:"load",value:function e(t,r){var i=this.loaders[r.type];if(i){var a=i.context;if(a&&a.url===t){c.logger.trace("playlist request ongoing");return}c.logger.warn("abort previous loader for type:"+r.type),i.abort()}var n=this.hls.config,s=void 0,o=void 0,l=void 0,u=void 0;"manifest"===r.type?(s=n.manifestLoadingMaxRetry,o=n.manifestLoadingTimeOut,l=n.manifestLoadingRetryDelay,u=n.manifestLoadingMaxRetryTimeout):(s=n.levelLoadingMaxRetry,o=n.levelLoadingTimeOut,l=n.levelLoadingRetryDelay,u=n.levelLoadingMaxRetryTimeout,c.logger.log("loading playlist for "+r.type+" "+(r.level||r.id))),i=this.loaders[r.type]=r.loader=void 0!==n.pLoader?new n.pLoader(n):new n.loader(n),r.url=t,r.responseType="";var d=void 0,f=void 0;d={timeout:o,maxRetry:s,retryDelay:l,maxRetryDelay:u},f={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},i.load(r,d,f)}},{key:"resolve",value:function e(t,r){return n.default.buildAbsoluteURL(r,t,{alwaysNormalize:!0})}},{key:"parseMasterPlaylist",value:function e(t,r){var i=[],a=void 0;for(v.lastIndex=0;null!=(a=v.exec(t));){var n={},s=n.attrs=new $.default(a[1]);n.url=this.resolve(a[2],r);var o=s.decimalResolution("RESOLUTION");o&&(n.width=o.width,n.height=o.height),n.bitrate=s.decimalInteger("AVERAGE-BANDWIDTH")||s.decimalInteger("BANDWIDTH"),n.name=s.NAME;var l=s.CODECS;if(l){l=l.split(/[ ,]+/);for(var u=0;u<l.length;u++){var d=l[u];-1!==d.indexOf("avc1")?n.videoCodec=this.avc1toavcoti(d):n.audioCodec=d}}i.push(n)}return i}},{key:"parseMasterPlaylistMedia",value:function e(t,r,i){var a=void 0,n=[],s=0;for(p.lastIndex=0;null!=(a=p.exec(t));){var o={},l=new $.default(a[1]);l.TYPE===i&&(o.groupId=l["GROUP-ID"],o.name=l.NAME,o.type=i,o.default="YES"===l.DEFAULT,o.autoselect="YES"===l.AUTOSELECT,o.forced="YES"===l.FORCED,l.URI&&(o.url=this.resolve(l.URI,r)),o.lang=l.LANGUAGE,o.name||(o.name=o.lang),o.id=s++,n.push(o))}return n}},{key:"avc1toavcoti",value:function e(t){var r,i=t.split(".");return i.length>2?(r=i.shift()+".",r+=parseInt(i.shift()).toString(16),r+=("000"+parseInt(i.shift()).toString(16)).substr(-4)):r=t,r}},{key:"parseLevelPlaylist",value:function e(t,r,i,a){var n,s,o=0,l=0,u={type:null,version:null,url:r,fragments:[],live:!0,startSN:0},d=new m,f=0,h=null,g=new _;for(x.lastIndex=0;null!==(n=x.exec(t));){var v=n[1];if(v){g.duration=parseFloat(v);var p=(" "+n[2]).slice(1);g.title=p||null,g.tagList.push(p?["INF",v,p]:["INF",v])}else if(n[3]){if(!isNaN(g.duration)){var E=o++;g.type=a,g.start=l,g.levelkey=d,g.sn=E,g.level=i,g.cc=f,g.baseurl=r,g.relurl=(" "+n[3]).slice(1),u.fragments.push(g),h=g,l+=g.duration,g=new _}}else if(n[4]){if(g.rawByteRange=(" "+n[4]).slice(1),h){var T=h.byteRangeEndOffset;T&&(g.lastByteRangeEndOffset=T)}}else if(n[5])g.rawProgramDateTime=(" "+n[5]).slice(1),g.tagList.push(["PROGRAM-DATE-TIME",g.rawProgramDateTime]);else{for(s=1,n=n[0].match(y);s<n.length&&void 0===n[s];s++);var b=(" "+n[s+1]).slice(1),k=(" "+n[s+2]).slice(1);switch(n[s]){case"#":g.tagList.push(k?[b,k]:[b]);break;case"PLAYLIST-TYPE":u.type=b.toUpperCase();break;case"MEDIA-SEQUENCE":o=u.startSN=parseInt(b);break;case"TARGETDURATION":u.targetduration=parseFloat(b);break;case"VERSION":u.version=parseInt(b);break;case"EXTM3U":break;case"ENDLIST":u.live=!1;break;case"DIS":f++,g.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":f=parseInt(b);break;case"KEY":var R=b,S=new $.default(R),A=S.enumeratedString("METHOD"),L=S.URI,D=S.hexadecimalInteger("IV");A&&(d=new m,L&&["AES-128","SAMPLE-AES"].indexOf(A)>=0&&(d.method=A,d.baseuri=r,d.reluri=L,d.key=null,d.iv=D));break;case"START":var F=b,w=new $.default(F).decimalFloatingPoint("TIME-OFFSET");isNaN(w)||(u.startTimeOffset=w);break;case"MAP":var I=new $.default(b);g.relurl=I.URI,g.rawByteRange=I.BYTERANGE,g.baseurl=r,g.level=i,g.type=a,g.sn="initSegment",u.initSegment=g,g=new _;break;default:c.logger.warn("line parsed but not handled: "+n)}}}return(g=h)&&!g.relurl&&(u.fragments.pop(),l-=g.duration),u.totalduration=l,u.averagetargetduration=l/u.fragments.length,u.endSN=o-1,u}},{key:"loadsuccess",value:function e(t,r,i){var a=t.data,n=t.url,s=i.type,l=i.id,u=i.level,f=this.hls;if(this.loaders[s]=void 0,(void 0===n||0===n.indexOf("data:"))&&(n=i.url),r.tload=performance.now(),0===a.indexOf("#EXTM3U")){if(a.indexOf("#EXTINF:")>0){var $=isNaN(u)?isNaN(l)?0:l:u,h=this.parseLevelPlaylist(a,n,$,"audioTrack"===s?"audio":"subtitleTrack"===s?"subtitle":"main");h.tload=r.tload,"manifest"===s&&f.trigger(o.default.MANIFEST_LOADED,{levels:[{url:n,details:h}],audioTracks:[],url:n,stats:r}),r.tparsed=performance.now(),h.targetduration?"audioTrack"!==s&&"subtitleTrack"!==s?f.trigger(o.default.LEVEL_LOADED,{details:h,level:u||0,id:l||0,stats:r}):"audioTrack"===s?f.trigger(o.default.AUDIO_TRACK_LOADED,{details:h,id:l,stats:r}):"subtitleTrack"===s&&f.trigger(o.default.SUBTITLE_TRACK_LOADED,{details:h,id:l,stats:r}):f.trigger(o.default.ERROR,{type:d.ErrorTypes.NETWORK_ERROR,details:d.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:n,reason:"invalid targetduration"})}else{var g=this.parseMasterPlaylist(a,n);if(g.length){var v=this.parseMasterPlaylistMedia(a,n,"AUDIO"),p=this.parseMasterPlaylistMedia(a,n,"SUBTITLES");if(v.length){var x=!1;v.forEach(function(e){e.url||(x=!0)}),!1===x&&g[0].audioCodec&&!g[0].attrs.AUDIO&&(c.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),v.unshift({type:"main",name:"main"}))}f.trigger(o.default.MANIFEST_LOADED,{levels:g,audioTracks:v,subtitles:p,url:n,stats:r})}else f.trigger(o.default.ERROR,{type:d.ErrorTypes.NETWORK_ERROR,details:d.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:n,reason:"no level found in manifest"})}}else f.trigger(o.default.ERROR,{type:d.ErrorTypes.NETWORK_ERROR,details:d.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:n,reason:"no EXTM3U delimiter"})}},{key:"loaderror",value:function e(t,r){var i,a,n=r.loader;switch(r.type){case"manifest":i=d.ErrorDetails.MANIFEST_LOAD_ERROR,a=!0;break;case"level":i=d.ErrorDetails.LEVEL_LOAD_ERROR,a=!1;break;case"audioTrack":i=d.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,a=!1}n&&(n.abort(),this.loaders[r.type]=void 0),this.hls.trigger(o.default.ERROR,{type:d.ErrorTypes.NETWORK_ERROR,details:i,fatal:a,url:n.url,loader:n,response:t,context:r})}},{key:"loadtimeout",value:function e(t,r){var i,a,n=r.loader;switch(r.type){case"manifest":i=d.ErrorDetails.MANIFEST_LOAD_TIMEOUT,a=!0;break;case"level":i=d.ErrorDetails.LEVEL_LOAD_TIMEOUT,a=!1;break;case"audioTrack":i=d.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT,a=!1}n&&(n.abort(),this.loaders[r.type]=void 0),this.hls.trigger(o.default.ERROR,{type:d.ErrorTypes.NETWORK_ERROR,details:i,fatal:a,url:n.url,loader:n,context:r})}}]),t}(u.default);r.default=E},{2:2,31:31,32:32,33:33,45:45,51:51}],42:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=function(){function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e)}return i(e,null,[{key:"init",value:function t(){for(r in e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},e.types)e.types.hasOwnProperty(r)&&(e.types[r]=[r.charCodeAt(0),r.charCodeAt(1),r.charCodeAt(2),r.charCodeAt(3)]);var r,i=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),a=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:i,audio:a};var n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=s,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var o=new Uint8Array([105,115,111,109]),l=new Uint8Array([97,118,99,49]),u=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,o,u,o,l),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,n))}},{key:"box",value:function e(t){for(var r,i=Array.prototype.slice.call(arguments,1),a=8,n=i.length,s=n;n--;)a+=i[n].byteLength;for((r=new Uint8Array(a))[0]=a>>24&255,r[1]=a>>16&255,r[2]=a>>8&255,r[3]=255&a,r.set(t,4),n=0,a=8;n<s;n++)r.set(i[n],a),a+=i[n].byteLength;return r}},{key:"hdlr",value:function t(r){return e.box(e.types.hdlr,e.HDLR_TYPES[r])}},{key:"mdat",value:function t(r){return e.box(e.types.mdat,r)}},{key:"mdhd",value:function t(r,i){var a=Math.floor((i*=r)/4294967296),n=Math.floor(i%4294967296);return e.box(e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,255&r,a>>24,a>>16&255,a>>8&255,255&a,n>>24,n>>16&255,n>>8&255,255&n,85,196,0,0]))}},{key:"mdia",value:function t(r){return e.box(e.types.mdia,e.mdhd(r.timescale,r.duration),e.hdlr(r.type),e.minf(r))}},{key:"mfhd",value:function t(r){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]))}},{key:"minf",value:function t(r){return"audio"===r.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(r)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(r))}},{key:"moof",value:function t(r,i,a){return e.box(e.types.moof,e.mfhd(r),e.traf(a,i))}},{key:"moov",value:function t(r){for(var i=r.length,a=[];i--;)a[i]=e.trak(r[i]);return e.box.apply(null,[e.types.moov,e.mvhd(r[0].timescale,r[0].duration)].concat(a).concat(e.mvex(r)))}},{key:"mvex",value:function t(r){for(var i=r.length,a=[];i--;)a[i]=e.trex(r[i]);return e.box.apply(null,[e.types.mvex].concat(a))}},{key:"mvhd",value:function t(r,i){var a=Math.floor((i*=r)/4294967296),n=Math.floor(i%4294967296),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,255&r,a>>24,a>>16&255,a>>8&255,255&a,n>>24,n>>16&255,n>>8&255,255&n,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,s)}},{key:"sdtp",value:function t(r){var i,a,n=r.samples||[],s=new Uint8Array(4+n.length);for(a=0;a<n.length;a++)i=n[a].flags,s[a+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return e.box(e.types.sdtp,s)}},{key:"stbl",value:function t(r){return e.box(e.types.stbl,e.stsd(r),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))}},{key:"avc1",value:function t(r){var i,a,n,s=[],o=[];for(i=0;i<r.sps.length;i++)n=(a=r.sps[i]).byteLength,s.push(n>>>8&255),s.push(255&n),s=s.concat(Array.prototype.slice.call(a));for(i=0;i<r.pps.length;i++)n=(a=r.pps[i]).byteLength,o.push(n>>>8&255),o.push(255&n),o=o.concat(Array.prototype.slice.call(a));var l=e.box(e.types.avcC,new Uint8Array([1,s[3],s[4],s[5],255,224|r.sps.length].concat(s).concat([r.pps.length]).concat(o))),u=r.width,d=r.height,f=r.pixelRatio[0],$=r.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,255&u,d>>8&255,255&d,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),l,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([f>>24,f>>16&255,f>>8&255,255&f,$>>24,$>>16&255,$>>8&255,255&$])))}},{key:"esds",value:function e(t){var r=t.config.length;return new Uint8Array([0,0,0,0,3,23+r,0,1,0,4,15+r,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([r]).concat(t.config).concat([6,1,2]))}},{key:"mp4a",value:function t(r){var i=r.samplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,r.channelCount,0,16,0,0,0,0,i>>8&255,255&i,0,0]),e.box(e.types.esds,e.esds(r)))}},{key:"mp3",value:function t(r){var i=r.samplerate;return e.box(e.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,r.channelCount,0,16,0,0,0,0,i>>8&255,255&i,0,0]))}},{key:"stsd",value:function t(r){return"audio"!==r.type?e.box(e.types.stsd,e.STSD,e.avc1(r)):r.isAAC||"mp3"!==r.codec?e.box(e.types.stsd,e.STSD,e.mp4a(r)):e.box(e.types.stsd,e.STSD,e.mp3(r))}},{key:"tkhd",value:function t(r){var i=r.id,a=r.duration*r.timescale,n=r.width,s=r.height,o=Math.floor(a/4294967296),l=Math.floor(a%4294967296);return e.box(e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,i>>24&255,i>>16&255,i>>8&255,255&i,0,0,0,0,o>>24,o>>16&255,o>>8&255,255&o,l>>24,l>>16&255,l>>8&255,255&l,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,255&n,0,0,s>>8&255,255&s,0,0]))}},{key:"traf",value:function t(r,i){var a=e.sdtp(r),n=r.id,s=Math.floor(i/4294967296),o=Math.floor(i%4294967296);return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n])),e.box(e.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,o>>24,o>>16&255,o>>8&255,255&o])),e.trun(r,a.length+16+20+8+16+8+8),a)}},{key:"trak",value:function t(r){return r.duration=r.duration||4294967295,e.box(e.types.trak,e.tkhd(r),e.mdia(r))}},{key:"trex",value:function t(r){var i=r.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function t(r,i){var a,n,s,o,l,u,d=r.samples||[],f=d.length,$=12+16*f,c=new Uint8Array($);for(i+=8+$,c.set([0,0,15,1,f>>>24&255,f>>>16&255,f>>>8&255,255&f,i>>>24&255,i>>>16&255,i>>>8&255,255&i],0),a=0;a<f;a++)s=(n=d[a]).duration,o=n.size,l=n.flags,u=n.cts,c.set([s>>>24&255,s>>>16&255,s>>>8&255,255&s,o>>>24&255,o>>>16&255,o>>>8&255,255&o,l.isLeading<<2|l.dependsOn,l.isDependedOn<<6|l.hasRedundancy<<4|l.paddingValue<<1|l.isNonSync,61440&l.degradPrio,15&l.degradPrio,u>>>24&255,u>>>16&255,u>>>8&255,255&u],12+16*a);return e.box(e.types.trun,c)}},{key:"initSegment",value:function t(r){e.types||e.init();var i,a=e.moov(r);return(i=new Uint8Array(e.FTYP.byteLength+a.byteLength)).set(e.FTYP),i.set(a,e.FTYP.byteLength),i}}]),e}();r.default=a},{}],43:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=e(34),n=$(a),s=e(33),o=$(s),l=e(51),u=e(42),d=$(u),f=e(31);function $(e){return e&&e.__esModule?e:{default:e}}var c=function(){function e(t,r,i,a){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.observer=t,this.config=r,this.typeSupported=i;var n=navigator.userAgent;this.isSafari=a&&a.indexOf("Apple")>-1&&n&&!n.match("CriOS"),this.ISGenerated=!1}return i(e,[{key:"destroy",value:function e(){}},{key:"resetTimeStamp",value:function e(t){this._initPTS=this._initDTS=t}},{key:"resetInitSegment",value:function e(){this.ISGenerated=!1}},{key:"remux",value:function e(t,r,i,a,n,s,u){if(this.ISGenerated||this.generateIS(t,r,n),this.ISGenerated){if(t.samples.length){t.timescale||(l.logger.warn("regenerate InitSegment as audio detected"),this.generateIS(t,r,n));var d=this.remuxAudio(t,n,s,u);if(r.samples.length){var f=void 0;d&&(f=d.endPTS-d.startPTS),r.timescale||(l.logger.warn("regenerate InitSegment as video detected"),this.generateIS(t,r,n)),this.remuxVideo(r,n,s,f)}}else{var $=void 0;r.samples.length&&($=this.remuxVideo(r,n,s)),$&&t.codec&&this.remuxEmptyAudio(t,n,s,$)}}i.samples.length&&this.remuxID3(i,n),a.samples.length&&this.remuxText(a,n),this.observer.trigger(o.default.FRAG_PARSED)}},{key:"generateIS",value:function e(t,r,i){var a,n,s=this.observer,u=t.samples,$=r.samples,c=this.typeSupported,h="audio/mp4",g={},v=void 0===this._initPTS;if(v&&(a=n=1/0),t.config&&u.length&&(t.timescale=t.samplerate,l.logger.log("audio sampling rate : "+t.samplerate),!t.isAAC&&(c.mpeg?(h="audio/mpeg",t.codec=""):c.mp3&&(t.codec="mp3")),g.audio={container:h,codec:t.codec,initSegment:!t.isAAC&&c.mpeg?new Uint8Array:d.default.initSegment([t]),metadata:{channelCount:t.channelCount}},v&&(a=n=u[0].pts-t.inputTimeScale*i)),r.sps&&r.pps&&$.length){var p=r.inputTimeScale;r.timescale=p,g.video={container:"video/mp4",codec:r.codec,initSegment:d.default.initSegment([r]),metadata:{width:r.width,height:r.height}},v&&(a=Math.min(a,$[0].pts-p*i),n=Math.min(n,$[0].dts-p*i),this.observer.trigger(o.default.INIT_PTS_FOUND,{initPTS:a}))}Object.keys(g).length?(s.trigger(o.default.FRAG_PARSING_INIT_SEGMENT,{tracks:g}),this.ISGenerated=!0,v&&(this._initPTS=a,this._initDTS=n)):s.trigger(o.default.ERROR,{type:f.ErrorTypes.MEDIA_ERROR,details:f.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})}},{key:"remuxVideo",value:function e(t,r,i,a){var n,s,u,$,c,h,g,v,p=8,x=t.timescale,y=t.samples,m=[],_=y.length,E=this._PTSNormalize,T=this._initDTS;y.sort(function(e,t){var r=e.dts-t.dts,i=e.pts-t.pts;return r||i||e.id-t.id});var b=y.reduce(function(e,t){return Math.max(Math.min(e,t.pts-t.dts),-18e3)},0);if(b<0){l.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(b/90)+" ms to overcome this issue");for(var k=0;k<y.length;k++)y[k].dts+=b}var R=void 0;R=i?this.nextAvcDts:r*x;var S=y[0];c=Math.max(E(S.dts-T,R),0),$=Math.max(E(S.pts-T,R),0);var A=Math.round((c-R)/90);i&&A&&(A>1?l.logger.log("AVC:"+A+" ms hole between fragments detected,filling it"):A<-1&&l.logger.log("AVC:"+-A+" ms overlapping between fragments detected"),c=R,y[0].dts=c+T,$=Math.max($-A,R),y[0].pts=$+T,l.logger.log("Video/PTS/DTS adjusted: "+Math.round($/90)+"/"+Math.round(c/90)+",delta:"+A+" ms")),h=c,v=Math.max(E((S=y[y.length-1]).dts-T,R),0),g=Math.max(g=Math.max(E(S.pts-T,R),0),v);var L=this.isSafari;L&&(n=Math.round((v-c)/(y.length-1)));for(var D=0,F=0,w=0;w<_;w++){for(var I=y[w],P=I.units,O=P.length,C=0,N=0;N<O;N++)C+=P[N].data.length;F+=C,D+=O,I.length=C,L?I.dts=c+w*n:I.dts=Math.max(E(I.dts-T,R),c),I.pts=Math.max(E(I.pts-T,R),I.dts)}var M=F+4*D+8;try{s=new Uint8Array(M)}catch(B){this.observer.trigger(o.default.ERROR,{type:f.ErrorTypes.MUX_ERROR,details:f.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:M,reason:"fail allocating video mdat "+M});return}var U=new DataView(s.buffer);U.setUint32(0,M),s.set(d.default.types.mdat,4);for(var G=0;G<_;G++){for(var K=y[G],W=K.units,H=0,V=void 0,Y=0,X=W.length;Y<X;Y++){var z=W[Y],j=z.data,q=z.data.byteLength;U.setUint32(p,q),p+=4,s.set(j,p),p+=q,H+=4+q}if(L)V=Math.max(0,n*Math.round((K.pts-K.dts)/n));else{if(G<_-1)n=y[G+1].dts-K.dts;else{var Q=this.config,Z=K.dts-y[G>0?G-1:G].dts;if(Q.stretchShortVideoTrack){var J,ee=Math.floor(Math.min(Q.maxBufferHole,Q.maxSeekHole)*x),et=(a?$+a*x:this.nextAudioPts)-K.pts;et>ee?((n=et-Z)<0&&(n=Z),l.logger.log("It is approximately "+et/90+" ms to the next segment; using duration "+n/90+" ms for the last video frame.")):n=Z}else n=Z}V=Math.round(K.pts-K.dts)}m.push({size:H,duration:n,cts:V,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:K.key?2:1,isNonSync:K.key?0:1}})}this.nextAvcDts=v+n;var er=t.dropped;if(t.len=0,t.nbNalu=0,t.dropped=0,m.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var ei=m[0].flags;ei.dependsOn=2,ei.isNonSync=0}t.samples=m,u=d.default.moof(t.sequenceNumber++,c,t),t.samples=[];var ea={data1:u,data2:s,startPTS:$/x,endPTS:(g+n)/x,startDTS:c/x,endDTS:this.nextAvcDts/x,type:"video",nb:m.length,dropped:er};return this.observer.trigger(o.default.FRAG_PARSING_DATA,ea),ea}},{key:"remuxAudio",value:function e(t,r,i,a){var s,u,$,c,h,g,v,p,x,y,m,_,E,T,b,k,R=t.inputTimeScale,S=R/t.timescale,A=(t.isAAC?1024:1152)*S,L=this._PTSNormalize,D=this._initDTS,F=!t.isAAC&&this.typeSupported.mpeg,w=F?0:8,I=[],P=[];if(t.samples.sort(function(e,t){return e.pts-t.pts}),P=t.samples,k=this.nextAudioPts,(i|=P.length&&k&&(a&&.1>Math.abs(r-k/R)||Math.abs(P[0].pts-k-D)<20*A))||(k=r*R),a&&t.isAAC)for(var O=0,C=k;O<P.length;){var N=P[O],M=L(N.pts-D,k)-C;if(M<=-A)l.logger.warn("Dropping 1 audio frame @ "+(C/R).toFixed(3)+"s due to "+Math.abs(1e3*M/R)+" ms overlap."),P.splice(O,1),t.len-=N.unit.length;else if(M>=A&&C){var B=Math.round(M/A);l.logger.warn("Injecting "+B+" audio frame @ "+(C/R).toFixed(3)+"s due to "+1e3*M/R+" ms gap.");for(var U=0;U<B;U++)b=Math.max(b=C+D,D),(T=n.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount))||(l.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),T=N.unit.subarray()),P.splice(O,0,{unit:T,pts:b,dts:b}),t.len+=T.length,C+=A,O+=1;N.pts=N.dts=C+D,C+=A,O+=1}else C+=A,0===O?N.pts=N.dts=D+k:N.pts=N.dts=P[O-1].pts+A,O+=1}for(var G=0,K=P.length;G<K;G++){if(c=(u=P[G]).unit,y=u.pts-D,m=u.dts-D,void 0!==x)_=L(y,x),E=L(m,x),$.duration=Math.round((E-x)/S);else{_=L(y,k),E=L(m,k);var W=Math.round(1e3*(_-k)/R),H=0;if(i&&t.isAAC&&W){if(W>0)H=Math.round((_-k)/A),l.logger.log(W+" ms hole between AAC samples detected,filling it"),H>0&&((T=n.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount))||(T=c.subarray()),t.len+=H*T.length);else if(W<-12){l.logger.log("drop overlapping AAC sample, expected/parsed/delta:"+(k/R).toFixed(3)+"s/"+(_/R).toFixed(3)+"s/"+-W+"ms"),t.len-=c.byteLength;continue}_=E=k}if(v=Math.max(0,_),p=Math.max(0,E),!(t.len>0))return;var V=F?t.len:t.len+8;try{h=new Uint8Array(V)}catch(Y){this.observer.trigger(o.default.ERROR,{type:f.ErrorTypes.MUX_ERROR,details:f.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:V,reason:"fail allocating audio mdat "+V});return}F||((s=new DataView(h.buffer)).setUint32(0,V),h.set(d.default.types.mdat,4));for(var X=0;X<H;X++)b=_-(H-X)*A,(T=n.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount))||(l.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),T=c.subarray()),h.set(T,w),w+=T.byteLength,$={size:T.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},I.push($)}h.set(c,w);var z=c.byteLength;w+=z,$={size:z,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},I.push($),x=E}var j=0,q=I.length;if(q>=2&&(j=I[q-2].duration,$.duration=j),q){this.nextAudioPts=_+S*j,t.len=0,t.samples=I,g=F?new Uint8Array:d.default.moof(t.sequenceNumber++,p/S,t),t.samples=[];var Q={data1:g,data2:h,startPTS:v/R,endPTS:this.nextAudioPts/R,startDTS:p/R,endDTS:(E+S*j)/R,type:"audio",nb:q};return this.observer.trigger(o.default.FRAG_PARSING_DATA,Q),Q}return null}},{key:"remuxEmptyAudio",value:function e(t,r,i,a){var s=t.inputTimeScale,o=t.samplerate?t.samplerate:s,u=this.nextAudioPts,d=(void 0!==u?u:a.startDTS*s)+this._initDTS,f=a.endDTS*s+this._initDTS,$=s/o*1024,c=Math.ceil((f-d)/$),h=n.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(l.logger.warn("remux empty Audio"),!h){l.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!");return}for(var g=[],v=0;v<c;v++){var p=d+v*$;g.push({unit:h,pts:p,dts:p}),t.len+=h.length}t.samples=g,this.remuxAudio(t,r,i)}},{key:"remuxID3",value:function e(t,r){var i,a=t.samples.length,n=t.inputTimeScale,s=this._initPTS,l=this._initDTS;if(a){for(var u=0;u<a;u++)(i=t.samples[u]).pts=(i.pts-s)/n,i.dts=(i.dts-l)/n;this.observer.trigger(o.default.FRAG_PARSING_METADATA,{samples:t.samples})}t.samples=[]}},{key:"remuxText",value:function e(t,r){t.samples.sort(function(e,t){return e.pts-t.pts});var i,a=t.samples.length,n=t.inputTimeScale,s=this._initPTS;if(a){for(var l=0;l<a;l++)(i=t.samples[l]).pts=(i.pts-s)/n;this.observer.trigger(o.default.FRAG_PARSING_USERDATA,{samples:t.samples})}t.samples=[]}},{key:"_PTSNormalize",value:function e(t,r){var i;if(void 0===r)return t;for(i=r<t?-8589934592:8589934592;Math.abs(t-r)>4294967296;)t+=i;return t}}]),e}();r.default=c},{31:31,33:33,34:34,42:42,51:51}],44:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i,a,n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=(i=e(33),i&&i.__esModule?i:{default:i}),o=function(){function e(t){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.observer=t}return n(e,[{key:"destroy",value:function e(){}},{key:"resetTimeStamp",value:function e(){}},{key:"resetInitSegment",value:function e(){}},{key:"remux",value:function e(t,r,i,a,n,o,l,u){var d=this.observer,f="";t&&(f+="audio"),r&&(f+="video"),d.trigger(s.default.FRAG_PARSING_DATA,{data1:u,startPTS:n,startDTS:n,type:f,nb:1,dropped:0}),d.trigger(s.default.FRAG_PARSED)}}]),e}();r.default=o},{33:33}],45:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=/^(\d+)x(\d+)$/,n=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,s=function(){function e(t){for(var r in!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),"string"==typeof t&&(t=e.parseAttrList(t)),t)t.hasOwnProperty(r)&&(this[r]=t[r])}return i(e,[{key:"decimalInteger",value:function e(t){var r=parseInt(this[t],10);return r>Number.MAX_SAFE_INTEGER?1/0:r}},{key:"hexadecimalInteger",value:function e(t){if(!this[t])return null;var r=(this[t]||"0x").slice(2);r=(1&r.length?"0":"")+r;for(var i=new Uint8Array(r.length/2),a=0;a<r.length/2;a++)i[a]=parseInt(r.slice(2*a,2*a+2),16);return i}},{key:"hexadecimalIntegerAsNumber",value:function e(t){var r=parseInt(this[t],16);return r>Number.MAX_SAFE_INTEGER?1/0:r}},{key:"decimalFloatingPoint",value:function e(t){return parseFloat(this[t])}},{key:"enumeratedString",value:function e(t){return this[t]}},{key:"decimalResolution",value:function e(t){var r=a.exec(this[t]);if(null!==r)return{width:parseInt(r[1],10),height:parseInt(r[2],10)}}}],[{key:"parseAttrList",value:function e(t){var r,i={};for(n.lastIndex=0;null!==(r=n.exec(t));){var a=r[2];0===a.indexOf('"')&&a.lastIndexOf('"')===a.length-1&&(a=a.slice(1,-1)),i[r[1]]=a}return i}}]),e}();r.default=s},{}],46:[function(e,t,r){"use strict";t.exports={search:function e(t,r){for(var i=0,a=t.length-1,n=null,s=null;i<=a;){var o=r(s=t[n=(i+a)/2|0]);if(o>0)i=n+1;else{if(!(o<0))return s;a=n-1}}return null}}},{}],47:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}();function a(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}var n={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},s=function e(t){var r=t;return n.hasOwnProperty(t)&&(r=n[t]),String.fromCharCode(r)},o={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},l={17:2,18:4,21:6,22:8,23:10,19:13,20:15},u={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},d={25:2,26:4,29:6,30:8,31:10,27:13,28:15},f=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],$={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function e(t){this.time=t},log:function e(t,r){var i=this.verboseFilter[t];this.verboseLevel>=i&&console.log(this.time+" ["+t+"] "+r)}},c=function e(t){for(var r=[],i=0;i<t.length;i++)r.push(t[i].toString(16));return r},h=function(){function e(t,r,i,n,s){a(this,e),this.foreground=t||"white",this.underline=r||!1,this.italics=i||!1,this.background=n||"black",this.flash=s||!1}return i(e,[{key:"reset",value:function e(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}},{key:"setStyles",value:function e(t){for(var r=["foreground","underline","italics","background","flash"],i=0;i<r.length;i++){var a=r[i];t.hasOwnProperty(a)&&(this[a]=t[a])}}},{key:"isDefault",value:function e(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}},{key:"equals",value:function e(t){return this.foreground===t.foreground&&this.underline===t.underline&&this.italics===t.italics&&this.background===t.background&&this.flash===t.flash}},{key:"copy",value:function e(t){this.foreground=t.foreground,this.underline=t.underline,this.italics=t.italics,this.background=t.background,this.flash=t.flash}},{key:"toString",value:function e(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}]),e}(),g=function(){function e(t,r,i,n,s,o){a(this,e),this.uchar=t||" ",this.penState=new h(r,i,n,s,o)}return i(e,[{key:"reset",value:function e(){this.uchar=" ",this.penState.reset()}},{key:"setChar",value:function e(t,r){this.uchar=t,this.penState.copy(r)}},{key:"setPenState",value:function e(t){this.penState.copy(t)}},{key:"equals",value:function e(t){return this.uchar===t.uchar&&this.penState.equals(t.penState)}},{key:"copy",value:function e(t){this.uchar=t.uchar,this.penState.copy(t.penState)}},{key:"isEmpty",value:function e(){return" "===this.uchar&&this.penState.isDefault()}}]),e}(),v=function(){function e(){a(this,e),this.chars=[];for(var t=0;t<100;t++)this.chars.push(new g);this.pos=0,this.currPenState=new h}return i(e,[{key:"equals",value:function e(t){for(var r=!0,i=0;i<100;i++)if(!this.chars[i].equals(t.chars[i])){r=!1;break}return r}},{key:"copy",value:function e(t){for(var r=0;r<100;r++)this.chars[r].copy(t.chars[r])}},{key:"isEmpty",value:function e(){for(var t=!0,r=0;r<100;r++)if(!this.chars[r].isEmpty()){t=!1;break}return t}},{key:"setCursor",value:function e(t){this.pos!==t&&(this.pos=t),this.pos<0?($.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>100&&($.log("ERROR","Too large cursor position "+this.pos),this.pos=100)}},{key:"moveCursor",value:function e(t){var r=this.pos+t;if(t>1)for(var i=this.pos+1;i<r+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(r)}},{key:"backSpace",value:function e(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}},{key:"insertChar",value:function e(t){t>=144&&this.backSpace();var r=s(t);if(this.pos>=100){$.log("ERROR","Cannot insert "+t.toString(16)+" ("+r+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(r,this.currPenState),this.moveCursor(1)}},{key:"clearFromPos",value:function e(t){var r;for(r=t;r<100;r++)this.chars[r].reset()}},{key:"clear",value:function e(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}},{key:"clearToEndOfRow",value:function e(){this.clearFromPos(this.pos)}},{key:"getTextString",value:function e(){for(var t=[],r=!0,i=0;i<100;i++){var a=this.chars[i].uchar;" "!==a&&(r=!1),t.push(a)}return r?"":t.join("")}},{key:"setPenStyles",value:function e(t){this.currPenState.setStyles(t),this.chars[this.pos].setPenState(this.currPenState)}}]),e}(),p=function(){function e(){a(this,e),this.rows=[];for(var t=0;t<15;t++)this.rows.push(new v);this.currRow=14,this.nrRollUpRows=null,this.reset()}return i(e,[{key:"reset",value:function e(){for(var t=0;t<15;t++)this.rows[t].clear();this.currRow=14}},{key:"equals",value:function e(t){for(var r=!0,i=0;i<15;i++)if(!this.rows[i].equals(t.rows[i])){r=!1;break}return r}},{key:"copy",value:function e(t){for(var r=0;r<15;r++)this.rows[r].copy(t.rows[r])}},{key:"isEmpty",value:function e(){for(var t=!0,r=0;r<15;r++)if(!this.rows[r].isEmpty()){t=!1;break}return t}},{key:"backSpace",value:function e(){this.rows[this.currRow].backSpace()}},{key:"clearToEndOfRow",value:function e(){this.rows[this.currRow].clearToEndOfRow()}},{key:"insertChar",value:function e(t){this.rows[this.currRow].insertChar(t)}},{key:"setPen",value:function e(t){this.rows[this.currRow].setPenStyles(t)}},{key:"moveCursor",value:function e(t){this.rows[this.currRow].moveCursor(t)}},{key:"setCursor",value:function e(t){$.log("INFO","setCursor: "+t),this.rows[this.currRow].setCursor(t)}},{key:"setPAC",value:function e(t){$.log("INFO","pacData = "+JSON.stringify(t));var r=t.row-1;if(this.nrRollUpRows&&r<this.nrRollUpRows-1&&(r=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==r){for(var i=0;i<15;i++)this.rows[i].clear();var a=this.currRow+1-this.nrRollUpRows,n=this.lastOutputScreen;if(n){var s=n.rows[a].cueStartTime;if(s&&s<$.time)for(var o=0;o<this.nrRollUpRows;o++)this.rows[r-this.nrRollUpRows+o+1].copy(n.rows[a+o])}}this.currRow=r;var l=this.rows[this.currRow];if(null!==t.indent){var u=t.indent;l.setCursor(t.indent),t.color=l.chars[Math.max(u-1,0)].penState.foreground}var d={foreground:t.color,underline:t.underline,italics:t.italics,background:"black",flash:!1};this.setPen(d)}},{key:"setBkgData",value:function e(t){$.log("INFO","bkgData = "+JSON.stringify(t)),this.backSpace(),this.setPen(t),this.insertChar(32)}},{key:"setRollUpRows",value:function e(t){this.nrRollUpRows=t}},{key:"rollUp",value:function e(){if(null===this.nrRollUpRows){$.log("DEBUG","roll_up but nrRollUpRows not set yet");return}$.log("TEXT",this.getDisplayText());var t=this.currRow+1-this.nrRollUpRows,r=this.rows.splice(t,1)[0];r.clear(),this.rows.splice(this.currRow,0,r),$.log("INFO","Rolling up")}},{key:"getDisplayText",value:function e(t){t=t||!1;for(var r=[],i="",a=-1,n=0;n<15;n++){var s=this.rows[n].getTextString();s&&(a=n+1,t?r.push("Row "+a+": '"+s+"'"):r.push(s.trim()))}return r.length>0&&(i=t?"["+r.join(" | ")+"]":r.join("\n")),i}},{key:"getTextAndFormat",value:function e(){return this.rows}}]),e}(),x=function(){function e(t,r){a(this,e),this.chNr=t,this.outputFilter=r,this.mode=null,this.verbose=0,this.displayedMemory=new p,this.nonDisplayedMemory=new p,this.lastOutputScreen=new p,this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}return i(e,[{key:"reset",value:function e(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null}},{key:"getHandler",value:function e(){return this.outputFilter}},{key:"setHandler",value:function e(t){this.outputFilter=t}},{key:"setPAC",value:function e(t){this.writeScreen.setPAC(t)}},{key:"setBkgData",value:function e(t){this.writeScreen.setBkgData(t)}},{key:"setMode",value:function e(t){t!==this.mode&&(this.mode=t,$.log("INFO","MODE="+t),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=t)}},{key:"insertChars",value:function e(t){for(var r=0;r<t.length;r++)this.writeScreen.insertChar(t[r]);var i=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";$.log("INFO",i+": "+this.writeScreen.getDisplayText(!0)),("MODE_PAINT-ON"===this.mode||"MODE_ROLL-UP"===this.mode)&&($.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}},{key:"ccRCL",value:function e(){$.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}},{key:"ccBS",value:function e(){$.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}},{key:"ccAOF",value:function e(){}},{key:"ccAON",value:function e(){}},{key:"ccDER",value:function e(){$.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}},{key:"ccRU",value:function e(t){$.log("INFO","RU("+t+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(t)}},{key:"ccFON",value:function e(){$.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})}},{key:"ccRDC",value:function e(){$.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}},{key:"ccTR",value:function e(){$.log("INFO","TR"),this.setMode("MODE_TEXT")}},{key:"ccRTD",value:function e(){$.log("INFO","RTD"),this.setMode("MODE_TEXT")}},{key:"ccEDM",value:function e(){$.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate()}},{key:"ccCR",value:function e(){$.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate()}},{key:"ccENM",value:function e(){$.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}},{key:"ccEOC",value:function e(){if($.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,$.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate()}},{key:"ccTO",value:function e(t){$.log("INFO","TO("+t+") - Tab Offset"),this.writeScreen.moveCursor(t)}},{key:"ccMIDROW",value:function e(t){var r={flash:!1};r.underline=t%2==1,r.italics=t>=46,r.italics?r.foreground="white":r.foreground=["white","green","blue","cyan","red","yellow","magenta"][Math.floor(t/2)-16],$.log("INFO","MIDROW: "+JSON.stringify(r)),this.writeScreen.setPen(r)}},{key:"outputDataUpdate",value:function e(){var t=$.time;null!==t&&this.outputFilter&&(this.outputFilter.updateData&&this.outputFilter.updateData(t,this.displayedMemory),null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))}},{key:"cueSplitAtTime",value:function e(t){this.outputFilter&&!this.displayedMemory.isEmpty()&&(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t)}}]),e}(),y=function(){function e(t,r,i){a(this,e),this.field=t||1,this.outputs=[r,i],this.channels=[new x(1,r),new x(2,i)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}}return i(e,[{key:"getHandler",value:function e(t){return this.channels[t].getHandler()}},{key:"setHandler",value:function e(t,r){this.channels[t].setHandler(r)}},{key:"addData",value:function e(t,r){var i,a,n,s=!1;this.lastTime=t,$.setTime(t);for(var o=0;o<r.length;o+=2){if(a=127&r[o],n=127&r[o+1],0===a&&0===n){this.dataCounters.padding+=2;continue}$.log("DATA","["+c([r[o],r[o+1]])+"] -> ("+c([a,n])+")"),(i=this.parseCmd(a,n))||(i=this.parseMidrow(a,n)),i||(i=this.parsePAC(a,n)),i||(i=this.parseBackgroundAttributes(a,n)),!i&&(s=this.parseChars(a,n))&&(this.currChNr&&this.currChNr>=0?this.channels[this.currChNr-1].insertChars(s):$.log("WARNING","No channel found yet. TEXT-MODE?")),i?this.dataCounters.cmd+=2:s?this.dataCounters.char+=2:(this.dataCounters.other+=2,$.log("WARNING","Couldn't parse cleaned data "+c([a,n])+" orig: "+c([r[o],r[o+1]])))}}},{key:"parseCmd",value:function e(t,r){var i=null;if(!((20===t||28===t)&&32<=r&&r<=47||(23===t||31===t)&&33<=r&&r<=35))return!1;if(t===this.lastCmdA&&r===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,$.log("DEBUG","Repeated command ("+c([t,r])+") is dropped"),!0;i=20===t||23===t?1:2;var a=this.channels[i-1];return 20===t||28===t?32===r?a.ccRCL():33===r?a.ccBS():34===r?a.ccAOF():35===r?a.ccAON():36===r?a.ccDER():37===r?a.ccRU(2):38===r?a.ccRU(3):39===r?a.ccRU(4):40===r?a.ccFON():41===r?a.ccRDC():42===r?a.ccTR():43===r?a.ccRTD():44===r?a.ccEDM():45===r?a.ccCR():46===r?a.ccENM():47===r&&a.ccEOC():a.ccTO(r-32),this.lastCmdA=t,this.lastCmdB=r,this.currChNr=i,!0}},{key:"parseMidrow",value:function e(t,r){var i=null;if((17===t||25===t)&&32<=r&&r<=47)return(i=17===t?1:2)!==this.currChNr?($.log("ERROR","Mismatch channel in midrow parsing"),!1):(this.channels[i-1].ccMIDROW(r),$.log("DEBUG","MIDROW ("+c([t,r])+")"),!0);return!1}},{key:"parsePAC",value:function e(t,r){var i=null,a=null;if(!((17<=t&&t<=23||25<=t&&t<=31)&&64<=r&&r<=127||(16===t||24===t)&&64<=r&&r<=95))return!1;if(t===this.lastCmdA&&r===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,!0;i=t<=23?1:2,a=64<=r&&r<=95?1===i?o[t]:u[t]:1===i?l[t]:d[t];var n=this.interpretPAC(a,r);return this.channels[i-1].setPAC(n),this.lastCmdA=t,this.lastCmdB=r,this.currChNr=i,!0}},{key:"interpretPAC",value:function e(t,r){var i=r,a={color:null,italics:!1,indent:null,underline:!1,row:t};return i=r>95?r-96:r-64,a.underline=(1&i)==1,i<=13?a.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(a.italics=!0,a.color="white"):a.indent=4*Math.floor((i-16)/2),a}},{key:"parseChars",value:function e(t,r){var i=null,a=null,n=null;if(t>=25?(i=2,n=t-8):(i=1,n=t),17<=n&&n<=19){var o=r;o=17===n?r+80:18===n?r+112:r+144,$.log("INFO","Special char '"+s(o)+"' in channel "+i),a=[o]}else 32<=t&&t<=127&&(a=0===r?[t]:[t,r]);if(a){var l=c(a);$.log("DEBUG","Char codes =  "+l.join(",")),this.lastCmdA=null,this.lastCmdB=null}return a}},{key:"parseBackgroundAttributes",value:function e(t,r){var i,a,n,s;return((16===t||24===t)&&32<=r&&r<=47||(23===t||31===t)&&45<=r&&r<=47)&&(i={},16===t||24===t?(a=Math.floor((r-32)/2),i.background=f[a],r%2==1&&(i.background=i.background+"_semi")):45===r?i.background="transparent":(i.foreground="black",47===r&&(i.underline=!0)),n=t<24?1:2,(s=this.channels[n-1]).setBkgData(i),this.lastCmdA=null,this.lastCmdB=null,!0)}},{key:"reset",value:function e(){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].reset();this.lastCmdA=null,this.lastCmdB=null}},{key:"cueSplitAtTime",value:function e(t){for(var r=0;r<this.channels.length;r++)this.channels[r]&&this.channels[r].cueSplitAtTime(t)}}]),e}();r.default=y},{}],48:[function(e,t,r){"use strict";var i=e(54);t.exports={newCue:function e(t,r,a,n){for(var s,o,l,u,d,f=window.VTTCue||window.TextTrackCue,$=0;$<n.rows.length;$++)if(s=n.rows[$],l=!0,u=0,d="",!s.isEmpty()){for(var c=0;c<s.chars.length;c++)s.chars[c].uchar.match(/\s/)&&l?u++:(d+=s.chars[c].uchar,l=!1);s.cueStartTime=r,r===a&&(a+=1e-4),o=new f(r,a,(0,i.fixLineBreaks)(d.trim())),u>=16?u--:u++,navigator.userAgent.match(/Firefox\//)?o.line=$+1:o.line=$>7?$-2:$+1,o.align="left",o.position=Math.max(0,Math.min(100,100*(u/32)+(navigator.userAgent.match(/Firefox\//)?50:0))),t.addCue(o)}}}},{54:54}],49:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i,a,n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=(i=e(50),i&&i.__esModule?i:{default:i}),o=function(){function e(t,r,i,a){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.hls=t,this.defaultEstimate_=a,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new s.default(r),this.fast_=new s.default(i)}return n(e,[{key:"sample",value:function e(t,r){var i=8e3*r/(t=Math.max(t,this.minDelayMs_)),a=t/1e3;this.fast_.sample(a,i),this.slow_.sample(a,i)}},{key:"canEstimate",value:function e(){var t=this.fast_;return t&&t.getTotalWeight()>=this.minWeight_}},{key:"getEstimate",value:function e(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}},{key:"destroy",value:function e(){}}]),e}();r.default=o},{50:50}],50:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=function(){function e(t){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=0,this.totalWeight_=0}return i(e,[{key:"sample",value:function e(t,r){var i=Math.pow(this.alpha_,t);this.estimate_=r*(1-i)+i*this.estimate_,this.totalWeight_+=t}},{key:"getTotalWeight",value:function e(){return this.totalWeight_}},{key:"getEstimate",value:function e(){if(!this.alpha_)return this.estimate_;var t=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/t}}]),e}();r.default=a},{}],51:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function a(){}var n={trace:a,debug:a,log:a,warn:a,info:a,error:a},s=n;r.enableLogs=function e(t){if(!0===t||(void 0===t?"undefined":i(t))==="object"){!function e(t){for(var r=arguments.length,i=Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];i.forEach(function(e){var r,i;s[e]=t[e]?t[e].bind(t):(r=e,(i=self.console[r])?function(){for(var e,t,a=arguments.length,n=Array(a),s=0;s<a;s++)n[s]=arguments[s];n[0]&&(n[0]=(e=r,t="["+e+"] > "+(t=n[0]))),i.apply(self.console,n)}:a)})}(t,"debug","log","info","warn","error");try{s.log()}catch(r){s=n}}else s=n},r.logger=s},{}],52:[function(e,t,r){"use strict";t.exports={toString:function e(t){for(var r="",i=t.length,a=0;a<i;a++)r+="["+t.start(a).toFixed(3)+","+t.end(a).toFixed(3)+"]";return r}}},{}],53:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(){if("undefined"!=typeof window&&window.VTTCue)return window.VTTCue;var e={"":!0,lr:!0,rl:!0},t={start:!0,middle:!0,end:!0,left:!0,right:!0};function r(e){return"string"==typeof e&&!!t[e.toLowerCase()]&&e.toLowerCase()}function i(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)e[i]=r[i]}return e}function a(t,a,n){var s=this,o=function(){if("undefined"!=typeof navigator)return/MSIE\s8\.0/.test(navigator.userAgent)}(),l={};o?s=document.createElement("custom"):l.enumerable=!0,s.hasBeenReset=!1;var u="",d=!1,f=t,$=a,c=n,h=null,g="",v=!0,p="auto",x="start",y=50,m="middle",_=50,E="middle";if(Object.defineProperty(s,"id",i({},l,{get:function e(){return u},set:function e(t){u=""+t}})),Object.defineProperty(s,"pauseOnExit",i({},l,{get:function e(){return d},set:function e(t){d=!!t}})),Object.defineProperty(s,"startTime",i({},l,{get:function e(){return f},set:function e(t){if("number"!=typeof t)throw TypeError("Start time must be set to a number.");f=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"endTime",i({},l,{get:function e(){return $},set:function e(t){if("number"!=typeof t)throw TypeError("End time must be set to a number.");$=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"text",i({},l,{get:function e(){return c},set:function e(t){c=""+t,this.hasBeenReset=!0}})),Object.defineProperty(s,"region",i({},l,{get:function e(){return h},set:function e(t){h=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"vertical",i({},l,{get:function e(){return g},set:function t(r){var i,a=(i=r,"string"==typeof i&&!!e[i.toLowerCase()]&&i.toLowerCase());if(!1===a)throw SyntaxError("An invalid or illegal string was specified.");g=a,this.hasBeenReset=!0}})),Object.defineProperty(s,"snapToLines",i({},l,{get:function e(){return v},set:function e(t){v=!!t,this.hasBeenReset=!0}})),Object.defineProperty(s,"line",i({},l,{get:function e(){return p},set:function e(t){if("number"!=typeof t&&"auto"!==t)throw SyntaxError("An invalid number or illegal string was specified.");p=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"lineAlign",i({},l,{get:function e(){return x},set:function e(t){var i=r(t);if(!i)throw SyntaxError("An invalid or illegal string was specified.");x=i,this.hasBeenReset=!0}})),Object.defineProperty(s,"position",i({},l,{get:function e(){return y},set:function e(t){if(t<0||t>100)throw Error("Position must be between 0 and 100.");y=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"positionAlign",i({},l,{get:function e(){return m},set:function e(t){var i=r(t);if(!i)throw SyntaxError("An invalid or illegal string was specified.");m=i,this.hasBeenReset=!0}})),Object.defineProperty(s,"size",i({},l,{get:function e(){return _},set:function e(t){if(t<0||t>100)throw Error("Size must be between 0 and 100.");_=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"align",i({},l,{get:function e(){return E},set:function e(t){var i=r(t);if(!i)throw SyntaxError("An invalid or illegal string was specified.");E=i,this.hasBeenReset=!0}})),s.displayState=void 0,o)return s}return a.prototype.getCueAsHTML=function(){return window.WebVTT.convertCueToDOMTree(window,this.text)},a}()},{}],54:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.fixLineBreaks=void 0;var i,a,n=(i=e(53),i&&i.__esModule?i:{default:i}),s=function e(){return{decode:function e(t){if(!t)return"";if("string"!=typeof t)throw Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(t))}}};function o(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new s,this.regionList=[]}function l(){this.values=Object.create(null)}function u(e,t,r,i){var a=i?e.split(i):[e];for(var n in a){if("string"==typeof a[n]){var s,o=a[n].split(r);if(2===o.length){t(o[0],o[1])}}}}l.prototype={set:function e(t,r){this.get(t)||""===r||(this.values[t]=r)},get:function e(t,r,i){return i?this.has(t)?this.values[t]:r[i]:this.has(t)?this.values[t]:r},has:function e(t){return t in this.values},alt:function e(t,r,i){for(var a=0;a<i.length;++a)if(r===i[a]){this.set(t,r);break}},integer:function e(t,r){/^-?\d+$/.test(r)&&this.set(t,parseInt(r,10))},percent:function e(t,r){var i;return!!((i=r.match(/^([\d]{1,3})(\.[\d]*)?%$/))&&(r=parseFloat(r))>=0&&r<=100)&&(this.set(t,r),!0)}};var d=new n.default(0,0,0),f="middle"===d.align?"middle":"center";function $(e,t,r){var i,a,n,s,o,$=e;function c(){var t=function e(t){function r(e,t,r,i){return(0|e)*3600+(0|t)*60+(0|r)+(0|i)/1e3}var i=t.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return i?i[3]?r(i[1],i[2],i[3].replace(":",""),i[4]):i[1]>59?r(i[1],i[2],0,i[4]):r(0,i[1],i[2],i[4]):null}(e);if(null===t)throw Error("Malformed timestamp: "+$);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function h(){e=e.replace(/^\s+/,"")}if(h(),t.startTime=c(),h(),"-->"!==e.substr(0,3))throw Error("Malformed time stamp (time stamps must be separated by '-->'): "+$);e=e.substr(3),h(),t.endTime=c(),h(),i=e,a=t,n=new l,u(i,function(e,t){switch(e){case"region":for(var i=r.length-1;i>=0;i--)if(r[i].id===t){n.set(e,r[i].region);break}break;case"vertical":n.alt(e,t,["rl","lr"]);break;case"line":var a=t.split(","),s=a[0];n.integer(e,s),n.percent(e,s)&&n.set("snapToLines",!1),n.alt(e,s,["auto"]),2===a.length&&n.alt("lineAlign",a[1],["start",f,"end"]);break;case"position":a=t.split(","),n.percent(e,a[0]),2===a.length&&n.alt("positionAlign",a[1],["start",f,"end","line-left","line-right","auto"]);break;case"size":n.percent(e,t);break;case"align":n.alt(e,t,["start",f,"end","left","right"])}},/:/,/\s/),a.region=n.get("region",null),a.vertical=n.get("vertical",""),"auto"===(s=n.get("line","auto"))&&-1===d.line&&(s=-1),a.line=s,a.lineAlign=n.get("lineAlign","start"),a.snapToLines=n.get("snapToLines",!0),a.size=n.get("size",100),a.align=n.get("align",f),"auto"===(o=n.get("position","auto"))&&50===d.position&&(o="start"===a.align||"left"===a.align?0:"end"===a.align||"right"===a.align?100:50),a.position=o}function c(e){return e.replace(/<br(?: \/)?>/gi,"\n")}o.prototype={parse:function e(t){var r=this;function i(){var e=r.buffer,t=0;for(e=c(e);t<e.length&&"\r"!==e[t]&&"\n"!==e[t];)++t;var i=e.substr(0,t);return"\r"===e[t]&&++t,"\n"===e[t]&&++t,r.buffer=e.substr(t),i}function a(e){u(e,function(e,t){"Region"===e&&console.log("parse region",t)},/:/)}t&&(r.buffer+=r.decoder.decode(t,{stream:!0}));try{if("INITIAL"===r.state){if(!/\r\n|\n/.test(r.buffer))return this;var s,o=(s=i()).match(/^WEBVTT([ \t].*)?$/);if(!o||!o[0])throw Error("Malformed WebVTT signature.");r.state="HEADER"}for(var l=!1;r.buffer&&/\r\n|\n/.test(r.buffer);)switch(l?l=!1:s=i(),r.state){case"HEADER":/:/.test(s)?a(s):s||(r.state="ID");continue;case"NOTE":s||(r.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(s)){r.state="NOTE";break}if(!s)continue;if(r.cue=new n.default(0,0,""),r.state="CUE",-1===s.indexOf("-->")){r.cue.id=s;continue}case"CUE":try{$(s,r.cue,r.regionList)}catch(d){r.cue=null,r.state="BADCUE";continue}r.state="CUETEXT";continue;case"CUETEXT":var f=-1!==s.indexOf("-->");if(!s||f&&(l=!0)){r.oncue&&r.oncue(r.cue),r.cue=null,r.state="ID";continue}r.cue.text&&(r.cue.text+="\n"),r.cue.text+=s;continue;case"BADCUE":s||(r.state="ID");continue}}catch(h){"CUETEXT"===r.state&&r.cue&&r.oncue&&r.oncue(r.cue),r.cue=null,r.state="INITIAL"===r.state?"BADWEBVTT":"BADCUE"}return this},flush:function e(){var t=this;try{if(t.buffer+=t.decoder.decode(),(t.cue||"HEADER"===t.state)&&(t.buffer+="\n\n",t.parse()),"INITIAL"===t.state)throw Error("Malformed WebVTT signature.")}catch(r){throw r}return t.onflush&&t.onflush(),this}},r.fixLineBreaks=c,r.default=o},{53:53}],55:[function(e,t,r){"use strict";var i,a,n=(i=e(54),i&&i.__esModule?i:{default:i}),s=function e(t){var r=parseInt(t.substr(-3)),i=parseInt(t.substr(-6,2)),a=parseInt(t.substr(-9,2)),n=t.length>9?parseInt(t.substr(0,t.indexOf(":"))):0;return isNaN(r)||isNaN(i)||isNaN(a)||isNaN(n)?-1:(r+=1e3*i,r+=6e4*a,r+=36e5*n)},o=function e(t,r,i){var a=t[r],n=t[a.prevCC];if(!n||!n.new&&a.new){t.ccOffset=t.presentationOffset=a.start,a.new=!1;return}for(;n&&n.new;)t.ccOffset+=a.start-n.start,a.new=!1,n=t[(a=n).prevCC];t.presentationOffset=i};t.exports={parse:function e(t,r,i,a,l,u){var d=String.fromCharCode.apply(null,new Uint8Array(t)).trim().replace(/\r\n|\n\r|\n|\r/g,"\n").split("\n"),f="00:00.000",$=0,c=0,h=0,g=[],v=void 0,p=!0,x=new n.default;x.oncue=function(e){var t=i[a],r=i.ccOffset;t&&t.new&&(c?r=i.ccOffset=t.start:o(i,a,h)),h&&!c&&(r=h+i.ccOffset-i.presentationOffset),e.startTime+=r-c,e.endTime+=r-c,e.text=decodeURIComponent(escape(e.text)),e.endTime>0&&g.push(e)},x.onparsingerror=function(e){v=e},x.onflush=function(){if(v&&u){u(v);return}l(g)},d.forEach(function(e){if(p){if(e.startsWith("X-TIMESTAMP-MAP=")){p=!1,e.substr(16).split(",").forEach(function(e){e.startsWith("LOCAL:")?f=e.substr(6):e.startsWith("MPEGTS:")&&($=parseInt(e.substr(7)))});try{r=r<0?r+8589934592:r,$-=r,c=s(f)/1e3,h=$/9e4,-1===c&&(v=Error("Malformed X-TIMESTAMP-MAP: "+e))}catch(t){v=Error("Malformed X-TIMESTAMP-MAP: "+e)}return}""===e&&(p=!1)}x.parse(e+"\n")}),x.flush()}}},{54:54}],56:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=e(51),n=function(){function e(t){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),t&&t.xhrSetup&&(this.xhrSetup=t.xhrSetup)}return i(e,[{key:"destroy",value:function e(){this.abort(),this.loader=null}},{key:"abort",value:function e(){var t=this.loader;t&&4!==t.readyState&&(this.stats.aborted=!0,t.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null}},{key:"load",value:function e(t,r,i){this.context=t,this.config=r,this.callbacks=i,this.stats={trequest:performance.now(),retry:0},this.retryDelay=r.retryDelay,this.loadInternal()}},{key:"loadInternal",value:function e(){var t,r=this.context;t="undefined"!=typeof XDomainRequest?this.loader=new XDomainRequest:this.loader=new XMLHttpRequest;var i=this.stats;i.tfirst=0,i.loaded=0;var a=this.xhrSetup;if(a)try{a(t,r.url)}catch(n){t.open("GET",r.url,!0),a(t,r.url)}t.readyState||t.open("GET",r.url,!0),r.rangeEnd&&t.setRequestHeader("Range","bytes="+r.rangeStart+"-"+(r.rangeEnd-1)),t.onreadystatechange=this.readystatechange.bind(this),t.onprogress=this.loadprogress.bind(this),t.responseType=r.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),t.send()}},{key:"readystatechange",value:function e(t){var r=t.currentTarget,i=r.readyState,n=this.stats,s=this.context,o=this.config;if(!n.aborted&&i>=2){if(window.clearTimeout(this.requestTimeout),0===n.tfirst&&(n.tfirst=Math.max(performance.now(),n.trequest)),4===i){var l=r.status;if(l>=200&&l<300){n.tload=Math.max(n.tfirst,performance.now());var u=void 0,d=void 0;d="arraybuffer"===s.responseType?(u=r.response).byteLength:(u=r.responseText).length,n.loaded=n.total=d;var f={url:r.responseURL,data:u};this.callbacks.onSuccess(f,n,s)}else n.retry>=o.maxRetry||l>=400&&l<499?(a.logger.error(l+" while loading "+s.url),this.callbacks.onError({code:l,text:r.statusText},s)):(a.logger.warn(l+" while loading "+s.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,o.maxRetryDelay),n.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),o.timeout)}}},{key:"loadtimeout",value:function e(){a.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context)}},{key:"loadprogress",value:function e(t){var r=this.stats;r.loaded=t.loaded,t.lengthComputable&&(r.total=t.total);var i=this.callbacks.onProgress;i&&i(r,this.context,null)}}]),e}();r.default=n},{51:51}]},{},[38])(38)});